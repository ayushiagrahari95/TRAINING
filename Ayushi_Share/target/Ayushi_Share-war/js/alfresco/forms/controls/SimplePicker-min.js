define(["alfresco/forms/controls/BaseFormControl","dojo/_base/declare","alfresco/core/CoreWidgetProcessing","alfresco/core/ObjectProcessingMixin","dojo/_base/lang","alfresco/pickers/Picker","alfresco/pickers/PropertyPicker","alfresco/pickers/PickedItems"],function(l,h,b,k,d,m,i,n){return h([l,b,k],{getWidgetConfig:function e(){return{id:this.generateUuid(),name:this.name,value:this.value}},createFormControl:function j(q,s){this.lastValue=this.value!=null?this.value:[];this.itemSelectionPubSubScope=this.generateUuid();var t=null;if(this.widgetsForControl==null){var r=d.clone(this.widgetsForAvailableItemsView);this.processObject(["processInstanceTokens"],r);var p=d.clone(this.widgetsForPickedItemsView);this.processObject(["processInstanceTokens"],p);if(this.reorderable===false||this.singleItemMode===true){p[0].config.widgets.shift()}t=[{name:"alfresco/pickers/Picker",config:{generatePubSubScope:false,pubSubScope:this.itemSelectionPubSubScope,subPickersLabel:this.availableItemsLabel,pickedItemsLabel:this.pickedItemsLabel,widgetsForRootPicker:[{name:"alfresco/pickers/PropertyPicker",config:{itemsProperty:this.itemsProperty,currentData:this.currentData,loadDataPublishTopic:this.loadDataPublishTopic,loadDataPublishPayload:this.loadDataPublishPayload,publishPickedItemsToParent:false,noDataMessage:this.noItemsMessage!=null?this.noItemsMessage:"alflist.no.data.message",widgets:r}}],widgetsForPickedItems:[{name:"alfresco/pickers/PickedItems",assignTo:"pickedItemsWidget",config:{itemKey:this.itemKey,widgets:p,singleItemMode:this.singleItemMode}}]}}]}else{t=d.clone(this.widgetsForControl);this.processObject(["processInstanceTokens"],t)}return this.processWidgets(t,this._controlNode)},widgetsForControl:null,availableItemsLabel:"",pickedItemsLabel:"",itemsProperty:"items",noItemsMessage:null,itemKey:"name",propertyToRender:"name",singleItemMode:false,loadDataPublishTopic:null,loadDataPublishPayload:null,currentData:null,reorderable:false,widgetsForAvailableItemsView:[{name:"alfresco/documentlibrary/views/AlfDocumentListView",config:{widgets:[{name:"alfresco/documentlibrary/views/layouts/Row",config:{visibilityConfig:{rules:[{topic:"ALF_ITEM_REMOVED",attribute:"{itemKey}",is:["{itemKey}"],useCurrentItem:true,strict:false}]},invisibilityConfig:{rules:[{topic:"ALF_ITEM_SELECTED",attribute:"{itemKey}",is:["{itemKey}"],useCurrentItem:true,strict:false}]},widgets:[{name:"alfresco/documentlibrary/views/layouts/Cell",config:{widgets:[{name:"alfresco/renderers/Property",config:{propertyToRender:"{propertyToRender}"}}]}},{name:"alfresco/documentlibrary/views/layouts/Cell",config:{width:"20px",widgets:[{name:"alfresco/renderers/PublishAction",config:{publishPayloadType:"CURRENT_ITEM",publishGlobal:false,publishToParent:false}}]}}]}}]}}],widgetsForPickedItemsView:[{name:"alfresco/documentlibrary/views/layouts/Row",config:{widgets:[{name:"alfresco/documentlibrary/views/layouts/Cell",config:{widgets:[{name:"alfresco/renderers/Reorder",config:{propertyToRender:"{propertyToRender}",moveUpPublishTopic:"ALF_ITEM_MOVED_UP",moveUpPublishPayloadType:"CURRENT_ITEM",moveDownPublishTopic:"ALF_ITEM_MOVED_DOWN",moveDownPublishPayloadType:"CURRENT_ITEM"}}]}},{name:"alfresco/documentlibrary/views/layouts/Cell",config:{widgets:[{name:"alfresco/renderers/Property",config:{propertyToRender:"{propertyToRender}"}}]}},{name:"alfresco/documentlibrary/views/layouts/Cell",config:{width:"20px",widgets:[{name:"alfresco/renderers/PublishAction",config:{iconClass:"delete-16",publishTopic:"ALF_ITEM_REMOVED",publishPayloadType:"CURRENT_ITEM"}}]}}]}}],setupChangeEvents:function c(){this.alfSubscribe(this.itemSelectionPubSubScope+"ALF_ITEMS_SELECTED",d.hitch(this,this.onItemsSelected),true)},onItemsSelected:function g(p){this.value=d.clone(p.pickedItems);this.onValueChangeEvent(this.name,this.lastValue,this.value);this.lastValue=this.value},processValidationRules:function o(){var p=true;if(this._required===true&&this.value.length===0){p=false}return p},getValue:function f(){return this.value},setValue:function a(p){this.alfPublish(this.itemSelectionPubSubScope+"ALF_SET_PICKED_ITEMS",{pickedItems:p},true)}})});