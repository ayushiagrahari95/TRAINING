define(["alfresco/forms/controls/BaseFormControl","dojo/_base/declare","alfresco/core/ResizeMixin","dojo/Deferred","dojo/dom-construct","dojo/dom-class","dojo/_base/lang","dojo/_base/array","cm/lib/codemirror","cm/mode/htmlmixed/htmlmixed"],function(p,g,o,l,f,m,d,i,n){return g([p,o],{cssRequirements:[{cssFile:"/js/lib/code-mirror/lib/codemirror.css"},{cssFile:"./css/CodeMirrorEditor.css"}],editMode:"xml",getWidgetConfig:function b(){return{id:this.generateUuid(),name:this.name,value:this.value}},isPromisedWidget:true,createFormControl:function q(r){this.alfSetupResizeSubscriptions(this.onResizeEvent,this);m.add(this.domNode,"alfresco-forms-controls-CodeMirrorEditor");this.editorElement=f.create("textarea",{style:"height:"+this.height+"px;width:"+this.width+"px;"},this._controlNode);this.wrappedWidget=new l();require(["cm/mode/"+this.editMode+"/"+this.editMode],d.hitch(this,this.setupEditor));return this.wrappedWidget},onResizeEvent:function e(){this.wrappedWidget.refresh()},width:600,height:300,setupEditor:function k(){var s=n.fromTextArea(this.editorElement,{lineNumbers:true,mode:this.editMode});s.setSize(this.width,this.height);var r=this.value!=null?this.value:"";this.lastValue=r;s.setValue(r);s.on("change",d.hitch(this,this.onEditorChange));this.wrappedWidget.resolve(s)},placeWidget:function j(){this.wrappedWidget.refresh()},onEditorChange:function a(s,r){var t=s.getValue();this.onValueChangeEvent(this.name,this.lastValue,t);this.lastValue=t},processValidationRules:function h(){var r=this.inherited(arguments);return r},getValue:function c(){if(this.wrappedWidget!=null&&typeof this.wrappedWidget.getValue==="function"){return this.wrappedWidget.getValue()}else{return this.value!=null?this.value:""}}})});