define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/MultipleEntryElement.html","alfresco/core/Core","alfresco/core/ValueDisplayMapMixin","alfresco/forms/PublishForm","dojo/dom-class","alfresco/forms/controls/DojoValidationTextBox"],function(q,k,h,r,l,a,p,j,g){return q([k,h,l,a],{cssRequirements:[{cssFile:"./css/MultipleEntryElement.css"}],i18nRequirements:[{i18nFile:"./i18n/MultipleEntryElement.properties"}],templateString:r,elementConfig:null,constructor:function e(t){q.safeMixin(this,t);this.determineKeyAndValue()},determineKeyAndValue:function m(){this.alfLog("log","DetermineKeyAndValue",this);if(this.elementConfig!=null){if(this.elementConfig.fieldId==null||this.elementConfig.fieldId==""){this.elementConfig.fieldId=this.generateUuid()}this.fieldId=this.elementConfig.fieldId;this.elementValue=this.elementConfig}else{this.fieldId=this.generateUuid();this.elementValue={};this.elementValue.fieldId=this.fieldId}},postCreate:function s(){this.elementValue=this.getValue();this.createReadDisplay()},readDisplayAttribute:"value",createReadDisplay:function f(){var u=this.readDisplayAttribute!=null?this.readDisplayAttribute:"value";var t=this.encodeHTML(this.elementValue[u]);t=this.mapValueToDisplayValue(t);this.readDisplay.innerHTML=t},form:null,createEditDisplay:function i(){if(this.form==null){var t=this.generateUuid();this.form=new p({pubSubScope:t,dataScope:this.dataScope,widgets:this.getFormWidgets()});this.setFormValue(this.elementValue);this.alfLog("log","Created new form for MEE",this.form);this.form.placeAt(this.editDisplay)}this.form.validate()},setFormValue:function o(t){this.form.setValue(this.elementValue)},getFormWidgets:function b(){if(this.widgets!=null){return this.widgets}else{return[{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"fieldId",label:"fieldId",value:this.elementValue.fieldId,visibilityConfig:{initialValue:false}}},{name:"alfresco/forms/controls/DojoValidationTextBox",config:{name:"value",label:"multi.element.value.label",description:"multi.element.value.description",value:this.elementValue.value,requirementConfig:{initialValue:true}}}]}},editMode:function d(t,u){if(t){this.createEditDisplay();j.remove(this.editDisplay,"hide");j.add(this.readDisplay,"hide")}else{var v;if(u){this.elementValue=this.getValue()}this.createReadDisplay();j.add(this.editDisplay,"hide");j.remove(this.readDisplay,"hide")}},getValue:function c(){var t={};if(this.form!=null){t=this.form.getValue()}else{t=this.elementValue}return t},validate:function n(){var t=true;if(this.form){t=this.form.validate()}return t}})});