define(["alfresco/forms/controls/BaseFormControl","dojo/_base/declare","alfresco/creation/DropZone","dojo/json","dojo/on","dojo/_base/lang","dojo/_base/array"],function(j,f,k,m,h,c,g){return f([j],{cssRequirements:[{cssFile:"./css/DropZoneControl.css"}],getWidgetConfig:function a(){return{id:this.generateUuid(),name:this.name,value:this.value,pubSubScope:this.pubSubScope,parentPubSubScope:this.pubSubScope,acceptTypes:this.acceptTypes}},createFormControl:function i(n,o){this.alfSetData(n.id,(n.value!=null)?n.value:{});return new k(n)},setupChangeEvents:function b(){this.onUpdateValue();h(this.domNode,"onWidgetUpdate",c.hitch(this,"onUpdateValue"))},onUpdateValue:function d(){this.alfLog("log","Updating DropZoneControl value...");var q={editorConfig:"",widgetsConfig:""};var p=[];var o=this.alfGetData(this.wrappedWidget.id);if(o!=null){if(o.widgetsForDisplay!=null){var n=c.getObject("widgetsForDisplay.0.config.initialItems",false,o);if(n!=null){q.editorConfig=n}}if(o.children!=null){g.forEach(o.children,c.hitch(this,"processChildren",p));q.widgetsConfig=p}}this.value=q;this.validate()},getValue:function l(){return this.value},processChildren:function e(q,t,p){var o=this.alfGetData(t);var n=[];g.forEach(o.children,c.hitch(this,"processChildren",n));if(o.widgetConfig!=null){var s=(o.itemConfigKey!=null)?o.itemConfigKey:"config";if(o.mixDroppedItemsIntoConfig===true){g.forEach(n,function(u){c.mixin(o.widgetConfig[s],u)},this)}else{var r=c.getObject("widgetsForDisplay.0.config.attributeKey",false,o);if(r!=null&&c.trim(r)!==""){}else{r=o.droppedItemsConfigAttribute;if(r==null||c.trim(r)===""){r="widgets"}}o.widgetConfig[s][r]=n}q.push(o.widgetConfig)}}})});