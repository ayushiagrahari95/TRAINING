define(["alfresco/forms/controls/BaseFormControl","alfresco/core/CoreWidgetProcessing","alfresco/core/ObjectProcessingMixin","dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(o,a,l,e,b,j){return e([o,a,l],{i18nRequirements:[{i18nFile:"./i18n/Picker.properties"}],itemKey:"name",getWidgetConfig:function g(){return{id:this.id+"_CONTROL",name:this.name,value:(this.value!=null)?this.value:[]}},createFormControl:function m(q){this.itemSelectionPubSubScope=this.generateUuid();this.alfSubscribe(this.itemSelectionPubSubScope+"ALF_ITEMS_SELECTED",b.hitch(this,"onItemsSelected"),true);var r=b.clone(this.widgetsForControl);this.processObject(["processInstanceTokens"],r);if(this.configForPickedItems!=null){this.setModelPickedItemsConfig(b.clone(this.configForPickedItems),q.value,r)}if(this.configForPicker!=null){this.setModelPickerConfig(b.clone(this.configForPicker),r)}this.setModelPickerWidgetValue(q.value,r);return this.processWidgets(r,this._controlNode)},setModelPickedItemsConfig:function k(q,r,s){q.pubSubScope=this.itemSelectionPubSubScope;b.setObject("0.config.widgets.0.config",q,s);b.setObject("0.config.widgets.0.config.value",r,s)},setModelPickerConfig:function p(q,r){b.setObject("0.config.widgets.1.config.publishPayload.widgetsContent.0.config",q,r)},getValue:function f(){var r=[];var q=this.getPickedItemsWidget().currentData.items;j.forEach(q,function(t,s){r.push(t[this.itemKey])},this);return r},setValue:function d(q){this.setModelPickerWidgetValue(q)},setModelPickerWidgetValue:function n(q,r){b.setObject("0.config.widgets.1.config.widgets.0.config.value",q,r)},updateFormDialogButton:function i(r){var q=b.getObject("verticalWidgets.formDialogButton",false,this);if(q!=null){b.setObject("publishPayload.widgetsContent.0.config.value",r,q)}else{this.alfLog("warn","The button to request a form does not exist",this)}},dialogPickedItemsProperty:"dialogContent.0.pickedItemsWidget.currentData.items",onItemsSelected:function c(s){var q=this.getPickedItemsWidget();if(q!=null&&s!=null){var r=s.pickedItems;if(r==null){r=b.getObject(this.dialogPickedItemsProperty,false,s)}if(r!=null){q.currentData.items=r;q.renderView(false);this.updateFormDialogButton(r)}else{this.alfLog("warn","No items provided to assign to PickedItems widget, nothing will be set",s,this)}this.validate()}else{this.alfLog("warn","PickedItems widget is not created, it is not possible to set items",this)}},getPickedItemsWidget:function h(){var q=b.getObject("verticalWidgets.pickedItemsWidget",false,this);return q},configForPickedItems:null,configForPicker:null,widgetsForControl:[{name:"alfresco/layout/VerticalWidgets",assignTo:"verticalWidgets",config:{widgets:[{name:"alfresco/pickers/PickedItems",assignTo:"pickedItemsWidget",config:{pubSubScope:"{itemSelectionPubSubScope}"}},{name:"alfresco/buttons/AlfButton",assignTo:"formDialogButton",config:{label:"picker.add.label",publishTopic:"ALF_CREATE_DIALOG_REQUEST",publishPayload:{dialogTitle:"picker.select.title",handleOverflow:false,widgetsContent:[{name:"alfresco/pickers/Picker",config:{}}],widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:"picker.ok.label",publishTopic:"ALF_ITEMS_SELECTED",pubSubScope:"{itemSelectionPubSubScope}"}},{name:"alfresco/buttons/AlfButton",config:{label:"picker.cancel.label",publishTopic:"NO_OP"}}]},publishGlobal:true}},{name:"alfresco/buttons/AlfButton",config:{label:"picker.removeAll.label",additionalCssClasses:"cancelButton",publishTopic:"ALF_ITEMS_SELECTED",publishPayload:{pickedItems:[]},pubSubScope:"{itemSelectionPubSubScope}"}}]}}]})});