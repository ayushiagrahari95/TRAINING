define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AlfUploadDisplay.html","alfresco/core/Core","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-construct","dojo/json"],function(p,b,k,q,g,s,d,f,c,n){return p([b,k,g],{i18nRequirements:[{i18nFile:"./i18n/AlfUploadDisplay.properties"}],cssRequirements:[{cssFile:"./css/AlfUploadDisplay.css"}],templateString:q,title:"title.label",description:"description.label",successfulUploadsLabel:"completed.label",uploadsInProgressLabel:"inprogress.label",aggregateProgressLabel:"aggregate-progress.label",failedUploadsLabel:"failed.label",reset:function o(){this.inProgressFiles={};this.uploadedFiles={};c.empty(this.successfulItemsNode);c.empty(this.inprogressItemsNode);c.empty(this.failedItemsNode)},postMixInProperties:function h(){this.title=this.message(this.title);this.description=this.message(this.description);this.successfulUploadsLabel=this.message(this.successfulUploadsLabel);this.uploadsInProgressLabel=this.message(this.uploadsInProgressLabel);this.aggregateProgressLabel=this.message(this.aggregateProgressLabel);this.failedUploadsLabel=this.message(this.failedUploadsLabel)},postCreate:function j(){this.reset()},inProgressFiles:null,uploadedFiles:null,addInProgressFile:function i(u,v){var w=c.create("tr",{className:"file"},this.inprogressItemsNode);var x=c.create("td",{innerHTML:v.name,className:"filename"},w);var t=c.create("td",{innerHTML:"0%",className:"percentage"},w);this.inProgressFiles[u]={node:w,fileName:v.name,fileNameNode:x,percentageNode:t}},addFailedFile:function r(w,t){var u=c.create("tr",{className:"file"},this.failedItemsNode);var w=c.create("td",{innerHTML:w,className:"filename"},u);var v=c.create("td",{innerHTML:(t!=null&&t.reason!=null)?t.reason:message.get("unknown.failure.reason"),className:"reason"},u)},updateUploadProgress:function a(t,w,u){var v=this.inProgressFiles[t];v.percentageNode.innerHTML=w+"%"},updateAggregateProgress:function m(t){this.aggregateProgressNode.innerHTML=Math.floor(t*100)+"%"},handleCompletedUpload:function l(u,t,w){var x=this.inProgressFiles[u];x.percentageNode.innerHTML="100%";c.place(x.node,this.successfulItemsNode,"last");if(w!=null&&w.responseText!=null){var v=n.parse(w.responseText);this.uploadedFiles[u]={nodeRef:v.nodeRef,fileName:v.fileName}}},handleFailedUpload:function e(t,w,u){var v=this.inProgressFiles[t];c.destroy(v.node);var x=this.message("upload.failure.reason.unknown");if(u!=null&&u.statusText!=null){x=u.statusText}this.addFailedFile(v.fileName,{reason:x})}})});