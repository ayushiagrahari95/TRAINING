define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Chart.html","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","alfresco/core/DomElementUtils","dojo/_base/lang","dojo/on","dojo/dom-geometry","dojo/dom-style"],function(e,h,n,m,c,a,j,b,d,l,f){return e([h,n,c,a,j],{baseClass:"alfresco-charts-ccc-Chart",pvcChartType:null,chartConfig:null,chartNode:null,dataTopic:null,dataTopicPayload:{},clickTopic:null,title:null,titlePosition:"bottom",width:null,height:400,legend:false,selectable:false,hoverable:false,tooltip:{enabled:true},readers:null,dimensions:null,extensionPoints:null,_currentData:null,_currentDataDescriptor:null,nonAmdDependencies:["/ctools/jquery.js","/ctools/protovis.js","/ctools/protovis-msie.js","/ctools/jquery.tipsy.js","/ctools/tipsy.js","/ctools/def.js","/ctools/pvc.js"],cssRequirements:[{cssFile:"./css/Chart.css"},{cssFile:"/ctools/tipsy.css"}],templateString:m,postMixInProperties:function g(){if(this.dataTopic){this.alfSubscribe(this.dataTopic+"_SUCCESS",b.hitch(this,this.onDataLoadSuccess));this.alfSubscribe(this.dataTopic+"_FAILURE",b.hitch(this,this.onDataLoadFailure))}},createChartConfig:function(){var o={};o.canvas=this.chartNode;o.width=this._getWidth();o.height=this.height;o.title=this.title;o.titlePosition=this.titlePosition;o.legend=this.legend;o.selectable=this.selectable;o.hoverable=this.hoverable;if(this.readers){o.readers=this.readers}if(this.dimensions){o.dimensions=this.dimensions}if(this.extensionPoints){o.extensionPoints=this.extensionPoints}if(this.clickTopic){o.clickable=true;o.clickAction=b.hitch(this,this.onItemClick)}o.tooltip=this.tooltip;var q=this.resolveCssStyles(this.baseClass+"--color",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],{backgroundColor:["rgba(0, 0, 0, 0)","transparent"]});o.colors=q.backgroundColor;if(typeof this.chartConfig=="object"){for(var r in this.chartConfig){o[r]=this.chartConfig[r]}}return o},createChart:function k(){this.chart=new pvc[this.pvcChartType](this.createChartConfig())},onItemClick:function(o){this.alfPublish(this.clickTopic,o.atoms.category.rawValue)},postCreate:function i(){if(this.dataTopic){var q=this.dataTopicPayload||{};q.alfResponseTopic=this.dataTopic;this.alfPublish(this.dataTopic,q)}var t=this;var p;var s=0;function o(){if(t.chart){t._renderChart()}}function r(){if(p){clearTimeout(p);s++;if(s>1){s=0;t._renderChart();return}}p=window.setTimeout(o,100)}d(window,"resize",r)},showData:function(p,o){this._currentData=p;this._currentDataDescriptor=o;this._renderChart()},_renderChart:function(){if(this._getWidth()){this._performRenderChart();return}var p=this;var q;function o(){if(p._getWidth()){clearTimeout(q);p._performRenderChart()}}q=window.setInterval(o,100)},_performRenderChart:function(){this.createChart();this.chart.setData(this._currentData,this._currentDataDescriptor);this.chart.render(true,true,false)},_getWidth:function(){try{var q=f.getComputedStyle(this.domNode);var p=l.getContentBox(this.domNode,q);var o=(p.w+"").split(".")[0];o=o.split("px")[0];o=parseInt(o);return o}catch(r){return null}},onDataLoadSuccess:function(o){this.showData(o.response.data,o.response.dataDescriptor)},onDataLoadFailure:function(o){this.showData({},{})}})});