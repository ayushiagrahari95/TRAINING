define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","alfresco/dialogs/AlfDialog","alfresco/forms/Form","dojo/_base/array","jquery"],function(i,c,b,n,a,k,h){return i([c],{constructor:function d(o){b.mixin(this,o);this.publishTopic="ALF_CREATE_FORM_DIALOG_REQUEST";this.alfSubscribe(this.publishTopic,b.hitch(this,"onCreateFormDialogRequest"));this.alfSubscribe("ALF_CREATE_DIALOG_REQUEST",b.hitch(this,this.onCreateDialogRequest))},_formConfirmationTopic:"ALF_CREATE_FORM_DIALOG_MIXIN_CONFIRMATION_TOPIC",widgets:null,defaultFormDialogConfig:{dialogTitle:"",dialogConfirmationButtonTitle:"OK",dialogCancellationButtonTitle:"Cancel"},onCreateDialogRequest:function e(p){if(this.dialog!=null){this.dialog.destroyRecursive()}var o={title:this.message(p.dialogTitle),textContent:p.textContent,widgetsContent:p.widgetsContent,widgetsButtons:p.widgetsButtons,additionalCssClasses:p.additionalCssClasses?p.additionalCssClasses:"",contentWidth:p.contentWidth?p.contentWidth:null,contentHeight:p.contentHeight?p.contentHeight:null,handleOverflow:(p.handleOverflow!=null)?p.handleOverflow:true,fixedWidth:(p.fixedWidth!=null)?p.fixedWidth:false};this.dialog=new n(o);if(p.publishOnShow){k.forEach(p.publishOnShow,b.hitch(this,this.publishOnShow))}this.dialog.show();if(p.hideTopic){this.alfSubscribe(p.hideTopic,b.hitch(this.dialog,this.dialog.hide))}},publishOnShow:function g(o){if(o.publishTopic&&o.publishPayload){this.alfPublish(o.publishTopic,o.publishPayload)}else{this.alfLog("warn","A request was made to publish data when a dialog is loaded, but either the topic or payload was missing",o,this)}},onCreateFormDialogRequest:function l(u){if(this.dialog!=null){this.dialog.destroyRecursive()}if(u.widgets==null){this.alfLog("warn","A request was made to display a dialog but no 'widgets' attribute has been defined",u,this)}else{if(u.formSubmissionTopic==null){this.alfLog("warn","A request was made to display a dialog but no 'formSubmissionTopic' attribute has been defined",u,this)}else{try{var r=this.generateUuid();var o=r+this._formConfirmationTopic;this.alfSubscribe(o,b.hitch(this,this.onFormDialogConfirmation));var p=b.clone(this.defaultFormDialogConfig);var s=b.clone(u);b.mixin(p,s);p.pubSubScope=r;p.parentPubSubScope=this.parentPubSubScope;p.subcriptionTopic=o;var w=(p.formValue!=null)?p.formValue:{};var v=this.createFormConfig(p.widgets,w);var t=this.createDialogConfig(p,v);this.dialog=new n(t);this.dialog.show()}catch(q){this.alfLog("error","The following error occurred creating a dialog for defined configuration",q,this.dialogConfig,this)}}}},createDialogConfig:function m(o,q){var p={title:this.message(o.dialogTitle),pubSubScope:o.pubSubScope,handleOverflow:(o.handleOverflow!=null)?o.handleOverflow:true,fixedWidth:(o.fixedWidth!=null)?o.fixedWidth:false,parentPubSubScope:o.parentPubSubScope,additionalCssClasses:o.additionalCssClasses?o.additionalCssClasses:"",widgetsContent:[q],widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:o.dialogConfirmationButtonTitle,disableOnInvalidControls:true,publishTopic:this._formConfirmationTopic,publishPayload:{formSubmissionTopic:o.formSubmissionTopic,formSubmissionPayloadMixin:o.formSubmissionPayloadMixin}}},{name:"alfresco/buttons/AlfButton",config:{label:o.dialogCancellationButtonTitle,publishTopic:"ALF_CLOSE_DIALOG"}}]};return p},createFormConfig:function f(o,p){var q={name:"alfresco/forms/Form",config:{displayButtons:false,widgets:o,value:p}};return q},formSubmissionTopic:null,onFormDialogConfirmation:function j(q){if(q!=null&&q.dialogContent!=null&&q.dialogContent.length==1&&typeof q.dialogContent[0].getValue==="function"){var o={};var p=q.dialogContent[0].getValue();if(q.subcriptionTopic){this.alfUnsubscribe(q.subcriptionTopic)}if(q.dialogReference!=null){q.dialogReference.destroyRecursive()}if(q.formSubmissionPayloadMixin!=null){b.mixin(o,q.formSubmissionPayloadMixin)}h.extend(true,o,p);this.alfPublish(q.formSubmissionTopic,o,true)}else{this.alfLog("error","The format of the dialog content was not as expected, the 'formSubmissionTopic' will not be published",q,this)}}})});