define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/ObjectProcessingMixin","dojo/_base/lang","alfresco/core/ObjectTypeUtils"],function(d,f,c,h,b){return d([c],{_generatedPayload:null,getGeneratedPayload:function a(j,i){if(this._generatedPayload==null||j===true||i!=null){this._generatedPayload=this.generatePayload(this.publishPayload,this.currentItem,i,this.publishPayloadType,this.publishPayloadItemMixin,this.publishPayloadModifiers)}return this._generatedPayload},generatePayload:function a(m,k,j,l,o,i){var n=null;if(l==null||l=="CONFIGURED"){n=m}else{if(l=="CURRENT_ITEM"){n=k}else{if(l=="PROCESS"){n=h.clone(m);this.processObject(i,n)}else{if(l=="BUILD"){n=h.clone(m);n=this.buildPayload(n,k,j)}}}}if(o==true){if(this.currentItem!=null){h.mixin(n,k)}else{this.alfLog("warn","A request was made to mix the 'currentItem' into the publish payload, but no 'currentItem' has been defined",this)}}return n},buildPayload:function e(l,k,i){if(l!=null){for(var j in l){l[j]=this.processValue(l[j],l,k,i)}return l}},processValue:function g(n,m,j,i){if(n!==null&&b.isObject(n)){if(n.alfType!==undefined&&n.alfProperty!==undefined){var k=n.alfType;var l=n.alfProperty;if(k=="item"&&j){n=h.getObject(l,null,j)}else{if(k=="payload"&&i){n=h.getObject(l,null,i)}else{this.alfLog("warn","A payload was defined with 'alfType' and 'alfProperty' attributes but the 'alfType' attribute was neither 'item' nor 'payload' (which are the only supported types), or the target object was null",this)}}delete n.alfType;delete n.alfProperty}else{for(var o in n){n[o]=this.processValue(n[o],m,j,i)}}}return n}})});