define(["dojo/_base/declare","alfresco/renderers/_ActionsMixin","alfresco/menus/AlfMenuGroup","dojo/_base/array","dojo/_base/lang","service/constants/Default","dijit/popup"],function(g,i,k,j,c,d,b){return g([i],{widgetsForLoading:[{name:"alfresco/header/AlfMenuItem",config:{iconClass:"alf-loading-icon",label:"loading.label"}}],addActions:function e(){this.actionsGroup.processWidgets(this.widgetsForLoading);if(this.actionsMenu.popup){this.actionsMenu.popup.onOpen=dojo.hitch(this,this.loadActions)}else{this.alfLog("log","No Sites Menu popup - something has gone wrong!")}},_actionsLoaded:false,loadActions:function f(){if(this._actionsLoaded){this.alfLog("log","Actions already loaded")}else{this.alfLog("log","Loading actions");this.getXhrData()}},getXhrData:function a(){var o=c.getObject("nodeRef",false,this.currentItem);if(o!=null){var n=this.generateUuid();this._xhrDataRequestHandle=this.alfSubscribe(n+"_SUCCESS",c.hitch(this,"onXhrData"),true);this.alfPublish("ALF_RETRIEVE_SINGLE_DOCUMENT_REQUEST",{alfResponseTopic:n,nodeRef:o},true)}else{this.alfLog("warn","No nodeRef attribute available to use to retrieve all data.",this)}},onXhrData:function l(n){this.alfUnsubscribeSaveHandles([this._xhrDataRequestHandle]);if(c.exists("response.item",n)){this._actionsLoaded=true;this.currentItem=n.response.item;this.clearLoadingItem();this.addXhrItems()}else{this.alfLog("warn","Document data was provided but the 'response.item' attribute was not found",n,this)}},clearLoadingItem:function h(){j.forEach(this.actionsMenu.popup.getChildren(),function(o,n){this.actionsMenu.popup.removeChild(o)},this)},addXhrItems:function m(){this.actionsGroup=new k({});this.actionsMenu.popup.addChild(this.actionsGroup);j.forEach(this.currentItem.actions,c.hitch(this,"addAction"))}})});