define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/renderers/_PublishPayloadMixin","dojo/text!./templates/PublishingDropDownMenu.html","alfresco/core/Core","alfresco/core/ObjectTypeUtils","alfresco/forms/controls/DojoSelect","dojo/_base/lang","dojo/dom-class"],function(f,i,n,e,k,c,l,a,b,j){return f([i,n,c,e],{cssRequirements:[{cssFile:"./css/PublishingDropDownMenu.css"}],templateString:k,publishTopic:null,_dropDownWidget:null,optionsConfig:null,postCreate:function d(){if(l.isString(this.propertyToRender)&&l.isObject(this.currentItem)&&b.exists(this.propertyToRender,this.currentItem)){var r=b.getObject(this.propertyToRender,false,this.currentItem);var q=this.generateUuid();var p="DROPDOWN";var o=q+"_valueChangeOf_"+p;this._dropDownWidget=new a({pubSubScope:q,fieldId:p,value:r,optionsConfig:this.optionsConfig},this.dropDownNode);this.alfSubscribe(o,b.hitch(this,"onPublishChange"),true);if(this.additionalCssClasses){j.add(this.domNode,this.additionalCssClasses)}}else{this.alfLog("warn","Property for PublishingDropDown renderer does not exist:",this)}},onPublishChange:function h(q){this.alfLog("log","Drop down property changed",q);if(this.publishTopic!=null){var p=this.generatePayload(this.publishPayload,this.currentItem,q,this.publishPayloadType,this.publishPayloadItemMixin);j.remove(this.processingNode,"hidden");j.add(this.warningNode,"hidden");j.add(this.successNode,"hidden");var o=this.generateUuid();this._updateSuccessHandle=this.alfSubscribe(o+"_SUCCESS",b.hitch(this,"onChangeSuccess"),false);this._updateFailureHandle=this.alfSubscribe(o+"_FAILURE",b.hitch(this,"onChangeFailure"),false);p.responseTopic=o;this.alfPublish(this.publishTopic,p,false)}else{this.alfLog("warn","A drop-down property was changed but there is no 'publishTopic' defined to publish on",this)}},onChangeSuccess:function m(o){this.alfUnsubscribeSaveHandles([this._updateSuccessHandle,this._updateFailureHandle]);j.add(this.processingNode,"hidden");j.remove(this.successNode,"hidden");this.alfLog("log","Update request success",o)},onChangeFailure:function g(o){this.alfUnsubscribeSaveHandles([this._updateSuccessHandle,this._updateFailureHandle]);j.add(this.processingNode,"hidden");j.remove(this.warningNode,"hidden");this.alfLog("log","Update request success",o)}})});