define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","alfresco/renderers/_PublishPayloadMixin","dojo/text!./templates/EditableComment.html","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-class","service/constants/Default"],function(h,k,q,d,b,g,p,i,c,f,o,e){return h([k,q,d,b,g],{cssRequirements:[{cssFile:"./css/EditableComment.css"}],templateString:p,readMode:true,propertyToRender:null,subscriptionTopic:"ALF_EDIT_COMMENT",postMixInProperties:function n(){if(this.readMode===true){this._mode="read"}else{this._mode="edit"}this.renderedValue=c.getObject(this.propertyToRender,false,this.currentItem);if(this.renderedValue==null){this.renderedValue=""}},postCreate:function j(){this._formCreated=false;this.publishPayload=c.clone(this.publishPayload);this.alfSubscribe(this.subscriptionTopic,c.hitch(this,this.onEditRequest));this.alfSubscribe("ALF_CANCEL_EDIT_COMMENT",c.hitch(this,this.onCancelEdit));this.alfSubscribe("ALF_EDIT_COMMENT_SAVE",c.hitch(this,this.onEditSave))},onEditRequest:function m(s){if(this._formCreated===false){var r=c.clone(this.widgetsForForm);this.processObject(["processInstanceTokens","processCurrentItemTokens","convertNodeRefToUrl"],r);this.processWidgets(r,this.formNode);this._formCreated=true}o.remove(this.domNode,"read");o.add(this.domNode,"edit");this._mode="edit"},onCancelEdit:function a(r){o.remove(this.domNode,"edit");o.add(this.domNode,"read");this._mode="read"},publishTopic:"ALF_CRUD_UPDATE",publishPayload:{url:"api/comment/node/{nodeRef}",pubSubScope:"{parentPubSubScope}"},publishPayloadType:"PROCESS",publishPayloadModifiers:["processCurrentItemTokens","convertNodeRefToUrl","processInstanceTokens"],publishGlobal:true,onEditSave:function l(t){this.onCancelEdit();var r=c.clone(t);var s=this.getGeneratedPayload(true);c.mixin(s,r);this.alfPublish(this.publishTopic,s,this.publishGlobal)},postParam:"content",okButtonLabel:"Save",widgetsForForm:[{name:"alfresco/forms/Form",config:{okButtonPublishTopic:"ALF_EDIT_COMMENT_SAVE",okButtonLabel:"{okButtonLabel}",okButtonPublishPayload:{url:"api/comment/node/{nodeRef}"},cancelButtonPublishTopic:"ALF_CANCEL_EDIT_COMMENT",widgets:[{name:"alfresco/forms/controls/TinyMCE",config:{name:"{postParam}",value:"{renderedValue}"}}]}}]})});