define(["dojo/_base/declare","alfresco/renderers/Toggle","alfresco/services/_QuickShareServiceTopicMixin","alfresco/core/CoreWidgetProcessing","dojo/text!./templates/QuickShare.html","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dijit/registry","alfresco/menus/AlfMenuBar","alfresco/menus/AlfMenuBarPopup","alfresco/menus/AlfCascadingMenu","alfresco/menus/AlfMenuGroup","alfresco/menus/AlfMenuItem","alfresco/menus/AlfMenuTextForClipboard","service/constants/Default"],function(s,n,e,o,w,x,f,j,g,d,b,v,c,q,u,k){return s([n,e,o],{i18nRequirements:[{i18nFile:"./i18n/QuickShare.properties"}],cssRequirements:[{cssFile:"./css/QuickShare.css"}],templateString:w,onLabel:"quick-share.enabled.label",offLabel:"quick-share.disabled.label",onTooltip:"quick-share.enabled.description",offTooltip:"quick-share.disabled.description",toggleClass:"quick-share",postMixInProperties:function t(){this.toggleOnTopic=(this.toggleOnTopic!=null)?this.toggleOnTopic:this.addQuickShareTopic;this.toggleOnSuccessTopic=(this.toggleOnSuccessTopic!=null)?this.toggleOnSuccessTopic:this.addQuickShareSuccessTopic;this.toggleOnFailureTopic=(this.toggleOnFailureTopic!=null)?this.toggleOnFailureTopic:this.addQuickShareFailureTopic;this.toggleOffTopic=(this.toggleOffTopic!=null)?this.toggleOffTopic:this.removeQuickShareTopic;this.toggleOffSuccessTopic=(this.toggleOffSuccessTopic!=null)?this.toggleOffSuccessTopic:this.removeQuickShareSuccessTopic;this.toggleOffFailureTopic=(this.toggleOffFailureTopic!=null)?this.toggleOffFailureTopic:this.removeQuickShareFailureTopic;this.simulateToggleOff=this.generateUuid();this.alfSubscribe(this.simulateToggleOff,x.hitch(this,this.onClick));this.inherited(arguments)},propertyToRender:"jsNode.properties.qshare:sharedId",getInitialState:function h(){return(x.getObject(this.propertyToRender,false,this.currentItem)!=null)},postCreate:function l(){this.inherited(arguments);var y=x.getObject("node.isContainer",false,this.currentItem);if(y){j.add(this.domNode,"hidden")}else{this.quickShareLink=k.QUICKSHARE_URL;if(this.isToggleOn){var z=x.getObject(this.propertyToRender,false,this.currentItem);this.widgets=this.defineWidgets(z);this.processWidgets(this.widgets,this.onNode)}}},quickShareLink:"",setQuickShareLink:function i(y){this.quickShareLink=y},setSocialLinks:function r(y){this.socialLinks=y},onToggleOnSuccess:function a(y){this.inherited(arguments);this.widgets=this.defineWidgets(y.response.sharedId);x.setObject(this.propertyToRender,y.response.sharedId,this.currentItem);this.processWidgets(this.widgets,this.onNode)},onToggleOffSuccess:function m(z){this.inherited(arguments);if(this.onNode.children!=null&&this.onNode.children.length>0){var y=g.byNode(this.onNode.children[0]);y.destroy()}},defineWidgets:function p(z){var A="http://"+window.location.host+this.quickShareLink.replace("{sharedId}",z);var y=[{name:"alfresco/menus/AlfMenuBar",config:{widgets:[{name:"alfresco/menus/AlfMenuBarPopup",config:{label:this.message("quick-share.enabled.label"),iconClass:"alf-quick-share-enabled-icon",widgets:[{name:"alfresco/menus/AlfMenuGroup",config:{widgets:[{name:"alfresco/menus/AlfCascadingMenu",config:{label:this.message("quick-share.public-url.label"),widgets:[{name:"alfresco/menus/AlfMenuGroup",config:{widgets:[{name:"alfresco/menus/AlfMenuTextForClipboard",config:{textForClipboard:A}}]}}]}},{name:"alfresco/menus/AlfMenuItem",config:{label:this.message("quick-share.view.label"),publishTopic:"ALF_NAVIGATE_TO_PAGE",publishPayload:{url:A,type:"FULL_PATH",target:"NEW"}}},{name:"alfresco/menus/AlfMenuItem",config:{label:this.message("quick-share.unshare.label"),publishTopic:this.simulateToggleOff,publishPayload:{node:this.currentItem,sharedId:z}}}]}}]}}]}}];return y}})});