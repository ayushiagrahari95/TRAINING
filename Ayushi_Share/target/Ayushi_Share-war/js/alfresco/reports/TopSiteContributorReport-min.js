define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/I18nUtils","alfresco/reports/Report","alfresco/services/_NavigationServiceTopicMixin","dojo/_base/lang","dojo/date","dojo/date/stamp"],function(j,e,i,n,m,d,h,a){var g="30D";var c=a.toISOString(h.add(new Date(),"month",-1),{selector:"date"});var k=a.toISOString(new Date(),{selector:"date"});var b=a.toISOString(new Date(),{selector:"date"});var o=function(){switch(g){case"TODAY":return b;case"7D":return a.toISOString(h.add(new Date(),"day",-7),{selector:"date"});case"30D":return a.toISOString(h.add(new Date(),"day",-30),{selector:"date"});case"YEAR":return a.toISOString(h.add(new Date(),"year",-1),{selector:"date"});case"CUSTOM":return c;default:break}return c};var f=function(){if(g=="CUSTOM"){return k}else{return b}};var l="alfresco.reports.TopSiteContributorReport";return j([n,m],{i18nRequirements:[{i18nFile:"./i18n/TopSiteContributorReport.properties"}],cssRequirements:[{cssFile:"./css/TopSiteContributorReport.css"}],baseClass:"alfresco-reports-TopSiteContributorReport",postMixInProperties:function p(){this.inherited(arguments);this.alfSubscribe("REPORT_ITEM_CLICKED",d.hitch(this,this.onReportItemClick))},onReportItemClick:function(q){this.alfPublish(this.navigateToPageTopic,{type:this.contextRelativePath,url:"page/user/"+encodeURIComponent(q)+"/profile"},true)},widgets:[{name:"alfresco/layout/VerticalWidgets",config:{additionalCssClasses:"bottom-border",widgets:[{name:"alfresco/forms/Form",config:{displayButtons:false,validFormValuesPublishTopic:"SHOW_CONTRIBUTORS_BY_DATE",validFormValuesPublishOnInit:false,widgets:[{name:"alfresco/forms/controls/DojoSelect",config:{fieldId:"TIME_PERIOD",name:"timePeriod",value:g,label:"",description:i.msg(l,"timePeriod"),optionsConfig:{fixed:[{label:i.msg(l,"timePeriod-today"),value:"TODAY"},{label:i.msg(l,"timePeriod-7d"),value:"7D"},{label:i.msg(l,"timePeriod-30d"),value:"30D"},{label:i.msg(l,"timePeriod-year"),value:"YEAR"},{label:i.msg(l,"timePeriod-custom"),value:"CUSTOM"}]}}},{name:"alfresco/forms/controls/DojoDateTextBox",config:{name:"startDate",value:c,label:"",description:i.msg(l,"startDate"),visibilityConfig:{initialValue:false,rules:[{targetId:"TIME_PERIOD",is:["CUSTOM"]}]}}},{name:"alfresco/forms/controls/DojoDateTextBox",config:{name:"endDate",value:k,label:"-",description:i.msg(l,"endDate"),visibilityConfig:{initialValue:false,rules:[{targetId:"TIME_PERIOD",is:["CUSTOM"]}]}}}]}}]}},{name:"alfresco/charts/ccc/ChartsView",config:{dataRequestTopic:"ALF_RETRIEVE_TOP_SITE_CONTRIBUTOR_REPORT",dataRequestPayload:{site:Alfresco.constants.SITE,startDate:o(),endDate:f()},subscriptionTopic:"SHOW_CONTRIBUTORS_BY_DATE",widgets:[{name:"alfresco/charts/ccc/PieChart",config:{readers:[{names:"category",indexes:0},{names:"value",indexes:2}],explodedSliceRadius:null,selectable:false,hoverable:true,extensionPoints:{slice_innerRadiusEx:"55%",slice_strokeStyle:"white"},clickTopic:"REPORT_ITEM_CLICKED",tooltip:{format:function(s){var q=Alfresco.constants.PROXY_URI+"slingshot/profile/avatar/"+encodeURIComponent(s.datum.atoms.category.value)+"/thumbnail/avatar32";var r="";r+="<table><tr><td>";r+='<img class="avatar" src="'+q+'" alt="avatar"><br>';r+="</td><td>";r+='<div style="text-align: left;">';r+="<strong>"+Alfresco.util.encodeHTML(s.datum.atoms.category.value)+"</strong><br/>";r+=i.msg(l,"count",Alfresco.util.encodeHTML(s.datum.atoms.value.value),Alfresco.util.encodeHTML(s.vars.value.percent.label))+"<br/>";r+=i.msg(l,"sum",Alfresco.util.encodeHTML(Alfresco.util.formatFileSize(s.datum.atoms.value2.value)));r+="</div>";r+="</td></tr></table>";return r}}}}]}}]})});