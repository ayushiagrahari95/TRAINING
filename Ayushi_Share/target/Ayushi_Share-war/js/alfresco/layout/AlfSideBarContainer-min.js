define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/core/ResizeMixin","alfresco/services/_PreferenceServiceTopicMixin","dojo/text!./templates/AlfSideBarContainer.html","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","dijit/layout/BorderContainer","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/dom-class","dojo/on","dojo/dom-geometry","dojo/window"],function(v,c,s,x,f,w,n,o,r,z,j,q,l,m,t,h){return v([c,s,x,f,n,o],{cssRequirements:[{cssFile:"/themes/lightTheme/yui/assets/skin.css"},{cssFile:"/css/yui-fonts-grids.css"},{cssFile:"./css/AlfSideBarContainer.css"}],templateString:w,nonAmdDependencies:["/yui/yahoo-dom-event/yahoo-dom-event.js","/yui/dragdrop/dragdrop.js","/yui/element/element.js","/yui/animation/animation.js","/yui/resize/resize.js"],showSidebar:true,minSidebarWidth:150,initialSidebarWidth:150,lastSidebarWidth:null,resizer:null,resizeHandlerNode:null,footerHeight:0,customResizeTopics:null,sidebarWidthPreferenceId:"org.alfresco.share.sideBarWidth",postMixInProperties:function g(){this.alfPublish(this.getPreferenceTopic,{preference:this.sidebarWidthPreferenceId,callback:this.setSideBarWidth,callbackScope:this})},setSideBarWidth:function k(A){if(A!=null){this.initialSidebarWidth=A}},postCreate:function b(){if(this.widgets){j.forEach(this.widgets,z.hitch(this,"addWidget"))}var C=parseInt(q.get(this.domNode,"width"),10);var A=(C-this.minSidebarWidth);this.resizer=new YAHOO.util.Resize(this.sidebarNode,{handles:["r"],minWidth:this.minSidebarWidth,maxWidth:A});var B=dojo.query(".yui-resize-handle-inner-r",this.domNode);if(B!=null&B.length==1){this.resizeHandlerNode=B[0];m(this.resizeHandlerNode,"click",z.hitch(this,"onResizeHandlerClick"))}else{this.alfLog("warn","An expected number of resize handles were found",B)}this.alfSubscribe("ALF_DOCLIST_SHOW_SIDEBAR",z.hitch(this,"showEventListener"));if(this.customResizeTopics!=null&&this.customResizeTopics.length){var D=this;j.forEach(this.customResizeTopics,function(E,F){D.alfSubscribe(E,z.hitch(D,"resizeHandler"))})}this.resizer.on("resize",z.hitch(this,"resizeHandler"));this.resizer.on("endResize",z.hitch(this,"endResizing"));m(window,"resize",z.hitch(this,"resizeHandler"));this.lastSidebarWidth=this.initialSidebarWidth;this.resizeHandler({width:this.lastSidebarWidth});this.render(this.showSidebar)},addWidget:function p(C,A){var B=null;if(C.align=="sidebar"){B=this.createWidgetDomNode(C,this.sidebarNode)}else{B=this.createWidgetDomNode(C,this.mainNode)}this.createWidget(C,B)},resizeHandler:function u(H){var J=parseInt(q.get(this.domNode,"width"),10);var G=this.lastSidebarWidth;if(H&&H.width!=null){G=H.width;this.lastSidebarWidth=G}var E=t.getMarginBox(this.containerNode);var A=h.getBox();var B=A.h-E.t-this.footerHeight;var I=this.calculateHeight(this.sidebarNode,0,this.sidebarNode.children.length-1);var C=this.calculateHeight(this.mainNode,0,this.mainNode.children.length);this.alfLog("log","Sidebar height: "+I+"px");this.alfLog("log","Main content height: "+C+"px");this.alfLog("log","Viewport height: "+B+"px");var F=(I>C)?I:C;var D=(F>B)?F:B;this.alfLog("log","Setting height as (px): ",D);q.set(this.sidebarNode,"height",D+"px");q.set(this.mainNode,"width",(J-G)+"px");this.alfPublishResizeEvent(this.mainNode)},endResizing:function y(A){this.resizeHandler(A);this.alfPublish(this.setPreferenceTopic,{preference:this.sidebarWidthPreferenceId,value:A.width});this.hiddenSidebarWidth=A.width},calculateHeight:function i(D,E,A){var C=0;for(var B=E;B<A;B++){C=C+parseInt(q.get(D.children[B],"height"),10)}return C},showEventListener:function e(A){this.alfLog("log","Handle show request",A);if(A&&A.selected!=null){this.render(A.selected)}},onResizeHandlerClick:function d(A){if(this.resizeHandlerNode){this.alfPublish("ALF_DOCLIST_SHOW_SIDEBAR",{selected:l.contains(this.resizeHandlerNode,"pop-out")})}},hiddenSidebarWidth:null,render:function a(A){if(A){for(var B=0;B<this.sidebarNode.children.length-1;B++){l.remove(this.sidebarNode.children[B],"share-hidden")}this.resizer.unlock(true);var C=(this.hiddenSidebarWidth)?this.hiddenSidebarWidth:this.initialSidebarWidth;this.resizer.resize(null,200,C,0,0,true);if(this.resizeHandlerNode){l.remove(this.resizeHandlerNode,"pop-out");l.add(this.resizeHandlerNode,"pop-in")}}else{this.resizer.resize(null,200,9,0,0,true);this.resizer.lock(true);if(this.resizeHandlerNode){l.add(this.resizeHandlerNode,"pop-out");l.remove(this.resizeHandlerNode,"pop-in")}for(var B=0;B<this.sidebarNode.children.length-1;B++){l.add(this.sidebarNode.children[B],"share-hidden")}}}})});