define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","alfresco/core/ObjectProcessingMixin","dojo/text!./templates/SingleItemPicker.html","dojo/_base/lang","dojo/_base/array","alfresco/core/NodeUtils"],function(f,i,o,d,a,k,m,c,h,j){return f([i,o,d,a,k],{cssRequirements:[{cssFile:"./css/SingleItemPicker.css"}],templateString:m,postCreate:function b(){if(this.requestItemsTopic!=null){var p=this.generateUuid();var s=p+"ALF_SINGLE_PICKER_ITEMS_REQUEST";var q=s+"_SUCCESS";var r=s+"_FAILURE";this.alfSubscribe(q,c.hitch(this,"onItemsLoadSuccess"),true);this.alfSubscribe(r,c.hitch(this,"onItemsLoadFailure"),true);this.alfPublish(this.requestItemsTopic,{alfResponseTopic:s},true)}},onItemsLoadSuccess:function n(r){this.alfLog("log","Items loaded",r);if(r==null||r.response==null){this.alfLog("warn","The response for a request for SingleItemPicker items did not contain a 'response' attribute",r,this)}else{var q=[];h.forEach(r.response,c.hitch(this,this.addItemWidgetConfig,q));var p=[{name:"alfresco/menus/AlfVerticalMenuBar",config:{widgets:q}}];this.processWidgets(p,this.itemsNode)}},addItemWidgetConfig:function g(s,t,r){var q=j.processNodeRef(t.node.substring(t.node.indexOf("workspace"))).nodeRef;var u=c.clone(this.widgetsForSubPicker);this.currentItem={siteNodeRef:q};this.processObject(["processCurrentItemTokens"],u);var p={name:"alfresco/menus/AlfMenuBarItem",config:{label:t.title,title:t.title,iconClass:"alf-sites-icon",publishTopic:"ALF_ADD_PICKER",publishPayload:{currentPickerDepth:this.currentPickerDepth,picker:u}}};s.push(p)},widgetsForSubPicker:[{name:"alfresco/pickers/DocumentListPicker",config:{siteMode:true,libraryRoot:"{siteNodeRef}",nodeRef:"{siteNodeRef}",path:"/"}}],onItemsLoadFailure:function e(p){this.alfLog("error","An error occurred trying to retrieve the items to display",p,this)},onItemSelected:function l(){}})});