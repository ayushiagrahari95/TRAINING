define(["dojo/_base/declare","alfresco/documentlibrary/views/AlfDocumentListView","dojo/_base/lang","dojo/_base/array"],function(e,l,c,i){return e([l],{i18nScope:"alfresco.pickers.PickedItems",i18nRequirements:[{i18nFile:"./i18n/PickedItems.properties"}],singleItemMode:false,allowNone:false,validTopic:"ALF_PICKER_VALID",invalidTopic:"ALF_PICKER_INVALID",publishValidityGlobally:true,postCreate:function g(){this.removeUploadDragAndDrop(this.domNode);this.alfSubscribe("ALF_ITEM_SELECTED",c.hitch(this,"addPickedItem"));this.alfSubscribe("ALF_ITEM_REMOVED",c.hitch(this,"removePickedItem"));this.alfSubscribe("ALF_SET_PICKED_ITEMS",c.hitch(this,this.onSetPickedItems));this.alfSubscribe("ALF_ITEM_MOVED_DOWN",c.hitch(this,this.onReorder,1));this.alfSubscribe("ALF_ITEM_MOVED_UP",c.hitch(this,this.onReorder,-1));this.currentData={items:(this.value!=null)?this.value:[]};this.renderView();this.isValid()},clearData:function j(){},itemKey:"nodeRef",addPickedItem:function f(o){var n=c.getObject(this.itemKey,false,o);if(n==null){this.alfLog("warn","The supplied item does not have a key attribute as expected",o,this)}else{var m=this.findPickedItem(n);if(m==null){if(this.singleItemMode){this.alfLog("info","Removing all other selected items",o,this);i.forEach(this.currentData.items,function(q,p){this.alfPublish("ALF_ITEM_REMOVED",q)},this);this.setPickedItems([o]);this.renderView(false)}else{this.currentData.items.push(o);i.forEach(this.currentData.items,function(q,p){q.index=p});this.renderView(false)}this.alfPublish("ALF_ITEMS_SELECTED",{pickedItems:this.currentData.items})}else{this.alfLog("log","Item is already picked - it will not be added a second time",o,this)}this.isValid()}},removePickedItem:function b(m){var n=c.getObject(this.itemKey,false,m);if(n==null){this.alfLog("warn","The supplied item does not have a key attribute as expected",m,this)}else{this.currentData.items=i.filter(this.currentData.items,function(q,o){var p=c.getObject(this.itemKey,false,q);return p!=n},this);i.forEach(this.currentData.items,function(p,o){p.index=o});this.renderView(false);this.alfPublish("ALF_ITEMS_SELECTED",{pickedItems:this.currentData.items});this.isValid()}},findPickedItem:function d(m){var o=null;var n=i.filter(this.currentData.items,function(r,p){var q=c.getObject(this.itemKey,false,r);return q==m},this);if(n.length>0){o=n[0]}return o},onSetPickedItems:function k(n){var m=c.getObject("pickedItems",false,n);if(m!=null){this.setPickedItems(m)}},setPickedItems:function k(m){if(m!=null){this.currentData.items=m;i.forEach(this.currentData.items,function(o,n){o.index=n})}else{this.alfLog("warn","No items supplied to 'setPickedItems' function",m,this)}this.renderView();this.isValid()},onReorder:function h(o,r){var m=c.getObject(this.itemKey,false,r);if(m!=null){var n=null;var s=i.some(this.currentData.items,function(u,w){var v=c.getObject(this.itemKey,false,u);if(v===m){n=w}return v===m},this);if(s===true){var t=n+o;if(t>=0&&t<=this.currentData.items.length){this.currentData.items[t].index=n;this.currentData.items[n].index=t;var q=this.currentData.items[t];var p=this.currentData.items[n];this.currentData.items[n]=q;this.currentData.items[t]=p;this.renderView(false);this.alfPublish("ALF_ITEMS_SELECTED",{pickedItems:this.currentData.items})}}}},isValid:function a(){if(this.allowNone||this.currentData.items.length>0){this.alfPublish(this.validTopic,{name:this.id},this.publishValidityGlobally)}else{this.alfPublish(this.invalidTopic,{name:this.id},this.publishValidityGlobally)}},widgets:[{name:"alfresco/documentlibrary/views/layouts/Row",config:{widgets:[{name:"alfresco/documentlibrary/views/layouts/Cell",config:{width:"20px",widgets:[{name:"alfresco/renderers/FileType",config:{size:"small",renderAsLink:false}}]}},{name:"alfresco/documentlibrary/views/layouts/Cell",config:{widgets:[{name:"alfresco/renderers/Property",config:{propertyToRender:"node.properties.cm:name",renderAsLink:false}}]}},{name:"alfresco/documentlibrary/views/layouts/Cell",config:{width:"20px",widgets:[{name:"alfresco/renderers/PublishAction",config:{iconClass:"delete-16",publishTopic:"ALF_ITEM_REMOVED",publishPayloadType:"CURRENT_ITEM"}}]}}]}}]})});