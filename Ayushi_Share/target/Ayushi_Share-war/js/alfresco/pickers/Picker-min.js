define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Picker.html","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","dojo/_base/lang"],function(e,g,k,i,c,a,b){return e([g,k,c,a],{i18nRequirements:[{i18nFile:"./i18n/Picker.properties"}],cssRequirements:[{cssFile:"./css/Picker.css"}],templateString:i,currentPickerDepth:0,currentPickers:null,showPickedItems:true,_processsingPickedItems:false,generatePubSubScope:true,postCreate:function d(){this.currentPickers=[];this.alfSubscribe("ALF_ADD_PICKER",b.hitch(this,this.addPicker));if(this.showPickedItems===true){this._processsingPickedItems=true;this.processWidgets(b.clone(this.widgetsForPickedItems),this.pickedItemsNode);if(this.pickedItemsLabel){this.pickedItemsLabelNode.innerHTML=this.message(this.pickedItemsLabel)}}if(this.widgetsForRootPicker!=null){this.processWidgets(b.clone(this.widgetsForRootPicker),this.subPickersNode);if(this.subPickersLabel){this.subPickersLabelNode.innerHTML=this.message(this.subPickersLabel)}}},addPicker:function f(o){if(o.currentPickerDepth===undefined){this.alfLog("warn","No 'currentPickerDepth' was provided in a request to add a new picker, so the picker will be appended",o,this)}else{var l=o.currentPickerDepth+1;for(var n=l;n<this.currentPickers.length;n++){var m=this.currentPickers[n];if(m!=null&&typeof m.destroyRecursive==="function"){m.destroyRecursive()}}this.currentPickers.splice(l,this.currentPickers.length-l);this.currentPickerDepth=o.currentPickerDepth}if(o.picker!=null){if(o.picker.config==null){o.picker.config={}}o.picker.config.pickerDepth=this.currentPickerDepth;this.processWidgets(o.picker,this.subPickersNode);this.currentPickerDepth++}else{this.alfLog("error","Error creating a picker: the payload picker is missing a picker object: ",o)}},allWidgetsProcessed:function j(l){if(this._processsingPickedItems===true){this._processsingPickedItems=false;this.pickedItemsWidget.setPickedItems(this.value)}else{if(l==null||l.length!=1){this.alfLog("warn","A single picker widget was expected but "+l.length+" were created",l,this)}else{this.currentPickers.push(l[0])}}this.alfPublish("ALF_RESIZE_DIALOG",{})},name:"pickedItems",getValue:function h(){var l=[];if(this.showPickedItems===true){if(this.pickedItemsWidget!=null){l=this.pickedItemsWidget.currentData.items}}return l},widgetsForRootPicker:[{name:"alfresco/menus/AlfVerticalMenuBar",config:{widgets:[{name:"alfresco/menus/AlfMenuBarItem",config:{label:"picker.recentSites.label",publishTopic:"ALF_ADD_PICKER",publishPayload:{currentPickerDepth:0,picker:[{name:"alfresco/pickers/SingleItemPicker",config:{currentPickerDepth:1,requestItemsTopic:"ALF_GET_RECENT_SITES"}}]}}},{name:"alfresco/menus/AlfMenuBarItem",config:{label:"picker.favouriteSites.label",publishTopic:"ALF_ADD_PICKER",publishPayload:{currentPickerDepth:0,picker:[{name:"alfresco/pickers/SingleItemPicker",config:{currentPickerDepth:1,requestItemsTopic:"ALF_GET_FAVOURITE_SITES"}}]}}},{name:"alfresco/menus/AlfMenuBarItem",config:{label:"picker.allSites.label",publishTopic:"ALF_ADD_PICKER",publishPayload:{currentPickerDepth:0,picker:[{name:"alfresco/pickers/SingleItemPicker",config:{currentPickerDepth:1,requestItemsTopic:"ALF_GET_SITES"}}]}}},{name:"alfresco/menus/AlfMenuBarItem",config:{label:"picker.repository.label",publishTopic:"ALF_ADD_PICKER",publishPayload:{currentPickerDepth:0,picker:[{name:"alfresco/pickers/DocumentListPicker",config:{nodeRef:"alfresco://company/home",path:"/"}}]}}},{name:"alfresco/menus/AlfMenuBarItem",config:{label:"picker.sharedFiles.label",publishTopic:"ALF_ADD_PICKER",publishPayload:{currentPickerDepth:0,picker:[{name:"alfresco/pickers/DocumentListPicker",config:{nodeRef:"alfresco://company/shared",filter:{path:"/"}}}]}}},{name:"alfresco/menus/AlfMenuBarItem",config:{label:"picker.myFiles.label",publishOnRender:true,publishPayload:{currentPickerDepth:0,picker:[{name:"alfresco/pickers/DocumentListPicker",config:{nodeRef:"alfresco://user/home",path:"/"}}]}}}]}}],widgetsForPickedItems:[{name:"alfresco/pickers/PickedItems",assignTo:"pickedItemsWidget"}],subPickersLabel:"picker.subPickers.label",pickedItemsLabel:"picker.pickedItems.label"})});