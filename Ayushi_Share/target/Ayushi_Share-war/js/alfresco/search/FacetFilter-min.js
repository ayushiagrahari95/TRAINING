define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_OnDijitClickMixin","dojo/text!./templates/FacetFilter.html","alfresco/core/Core","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-class","dojo/on","dojo/hash","dojo/io-query","alfresco/core/ArrayUtils"],function(p,c,n,m,r,l,t,i,g,j,k,a,o,e){return p([c,n,l],{i18nRequirements:[{i18nFile:"./i18n/FacetFilter.properties"}],cssRequirements:[{cssFile:"./css/FacetFilter.css"}],templateString:r,hide:false,facet:null,filter:null,filterData:"",applied:false,appliedFilterImageSrc:"12x12-selected-icon.png",appliedFilterAltText:"facet.filter.applied.alt-text",useHash:false,postMixInProperties:function b(){if(this.label!=null&&this.facet!=null&&this.filter!=null&&this.hits!=null){this.label=this.encodeHTML(this.message(this.label));this.appliedFilterAltText=this.message(this.appliedFilterAltText,{0:this.label});this.appliedFilterImageSrc=require.toUrl("alfresco/search")+"/css/images/"+this.appliedFilterImageSrc}else{this.alfLog("warn","Not enough information provided for filter. It will not be displayed",this);this.hide=true}},postCreate:function q(){if(this.hide===true){j.add(this.domNode,"hidden")}if(this.applied){j.remove(this.removeNode,"hidden");j.add(this.labelNode,"applied")}},onToggleFilter:function s(u){if(this.applied){this.onClearFilter()}else{this.onApplyFilter()}},onApplyFilter:function h(){var u=this.facet+"|"+this.filter;if(this.useHash){this._updateHash(u,"add")}else{this.alfPublish("ALF_APPLY_FACET_FILTER",{filter:u})}j.remove(this.removeNode,"hidden");j.add(this.labelNode,"applied");this.applied=true},onClearFilter:function d(){var u=this.facet+"|"+this.filter;if(this.useHash){this._updateHash(u,"remove")}else{this.alfPublish("ALF_REMOVE_FACET_FILTER",{filter:u})}j.add(this.removeNode,"hidden");j.remove(this.labelNode,"applied");this.applied=false},_updateHash:function f(x,y){var w=o.queryToObject(a()),u=((w.facetFilters)?w.facetFilters:""),v=(u==="")?[]:u.split(",");if(y==="add"&&!e.arrayContains(v,x)){v.push(x)}else{if(y==="remove"&&e.arrayContains(v,x)){v.splice(v.indexOf(x),1)}}if(v.length<1){delete w.facetFilters}else{w.facetFilters=v.join()}this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:o.objectToQuery(w),type:"HASH"},true)}})});