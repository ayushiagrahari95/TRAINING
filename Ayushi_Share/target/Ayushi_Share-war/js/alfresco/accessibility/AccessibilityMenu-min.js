define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AccessibilityMenu.html","dojo/_base/lang","alfresco/core/Core","dojo/dom","dojo/dom-construct","dojo/on","dojo/dom-attr"],function(f,i,n,m,b,c,e,d,g,l){return f([i,n,c],{i18nRequirements:[{i18nFile:"./i18n/AccessibilityMenu.properties"}],cssRequirements:[{cssFile:"./css/AccessibilityMenu.css"}],templateString:m,titleMsgKey:"access.key.links.message",titleMsg:null,menu:[],targets:[],_createdLinks:[],postCreate:function k(){d.create("p",{innerHTML:this.titleMsg?this.titleMsg:this.message(this.titleMsgKey)},this.accessKeys,"first");var p=d.create("ul",null,this.accessKeys,"last");for(var o=0,q;q=this.menu[o];o++){this.writeMenuItem(p,q)}this.alfSubscribe("ALF_WIDGETS_READY",b.hitch(this,"generateTargets"));this.alfSubscribe("ALF_WIDGETS_READY",b.hitch(this,"addEvents"))},writeMenuItem:function j(q,p){if(p.msg||p.msgKey){if(q){var o=d.create("li",null,q,"last");this._createdLinks.push(d.create("a",{href:p.url,accessKey:p.key,innerHTML:p.msg?p.msg:this.message(p.msgKey)},o));this.alfLog("log","Created accessibility menu item '"+p.url+"'",this)}else{this.alfLog("error","List specified as container for 'writeMenuItem' does not exist",this)}}else{this.alfLog("error","An accessibility menu item was provided with neither a 'msgKey' nor a 'msg'",this)}},generateTargets:function h(){for(var o=0,p;p=this.targets[o];o++){if(e.byId(p.domid)){var q=p.after?"after":"before";d.create("a",{id:p.targetid,innerHTML:" "},p.domid,q);this.alfLog("log","Created accessibility anchor '"+p.targetid+"'",this)}else{this.alfLog("error","Dom element '"+p.domid+"', specified as location for accessibility anchor, does not exist",this)}}},addEvents:function a(){for(var o=0;o<this._createdLinks.length;o++){var p=this._createdLinks[o];if(p.href.indexOf("#")!=-1){var q=e.byId(p.href.split("#")[1]);if(q){g(p,"click",function(){l.set(q,"tabindex",-1);g(p,"blur, focusout",function(){l.remove(q,"tabindex")});q.focus()})}}}}})});