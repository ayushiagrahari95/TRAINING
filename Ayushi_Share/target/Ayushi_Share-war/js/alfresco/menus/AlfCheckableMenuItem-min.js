define(["dojo/_base/declare","alfresco/menus/AlfMenuItem","dojo/_base/lang","dojo/_base/event","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/hash","dojo/io-query"],function(j,e,d,a,f,n,l,i,h){return j([e],{cssRequirements:[{cssFile:"./css/AlfCheckableMenuItem.css"}],checkCell:null,checked:false,checkedIconClass:"alf-selected-icon",group:null,publishPayload:null,subscriptionHandle:null,hashName:null,postCreate:function c(){if(this.publishPayload==null){this.publishPayload={}}if(this.hashName){var p=h.queryToObject(i());this.checked=(p[this.hashName]&&p[this.hashName]===this.value)}this.alfLog("log","Create checkable cell");this.checkCell=f.create("td",{className:"alf-checkable-menu-item",innerHTML:"&nbsp;"},this.focusNode,"first");if(this.checked){n.add(this.checkCell,this.checkedIconClass)}if(this.group){this.alfSubscribe("ALF_CHECKABLE_MENU_ITEM__"+this.group,d.hitch(this,"onGroupSelection"))}this.inherited(arguments);if(this.checked){this.publishSelection()}if(this.publishTopic){this.subscriptionHandle=this.alfSubscribe(this.publishTopic,d.hitch(this,"onPublishTopicEvent"))}},onPublishTopicEvent:function k(p){if(p&&p.selected!=null&&p.value==this.value){if(this.group){this.alfPublish("ALF_CHECKABLE_MENU_ITEM__"+this.group,{});this.checked=p.selected}else{this.checked=p.selected}this.render()}},closeOnClick:true,onClick:function m(p){this.emitClosePopupEvent();this.toggleSelection(p)},toggleSelection:function g(p){this.alfLog("log","Toggle selection");a.stop(p);if(this.group){if(!this.checked){this.alfPublish("ALF_CHECKABLE_MENU_ITEM__"+this.group,{});this.checked=true;this.render();this.publishSelection()}}else{this.checked=!this.checked;this.render();this.publishSelection()}n.remove(this.checkCell.parentNode,"dijitMenuItemSelected")},render:function b(){if(this.checked){n.add(this.checkCell,this.checkedIconClass)}else{n.remove(this.checkCell,this.checkedIconClass)}},publishSelection:function o(){this.alfLog("log","Publishing selection",this.publishTopic,this.value,this.checked);if(this.publishTopic){this.publishPayload.selected=this.checked;this.publishPayload.value=this.value;this.alfPublish(this.publishTopic,this.publishPayload)}},onGroupSelection:function g(p){this.checked=false;this.render()}})});