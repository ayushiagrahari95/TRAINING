define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/CoreXhr","alfresco/services/_TagServiceTopics","dojo/_base/lang","service/constants/Default"],function(g,b,j,i,a,d){return g([b,j],{siteId:null,containerId:null,rootNode:null,constructor:function e(k){a.mixin(this,k);this.alfSubscribe("ALF_RETRIEVE_CURRENT_TAGS",a.hitch(this,this.onTagListRequest));this.alfSubscribe(i.tagQueryTopic,a.hitch(this,this.onTagQuery));this.alfSubscribe("ALF_CREATE_TAG",a.hitch(this,this.createTag))},onTagListRequest:function h(m){var l=d.PROXY_URI+"api/forms/picker/category/workspace/SpacesStore/tag:tag-root/children";var k={selectableType:"cm:category",size:"100",aspect:"cm:taggable"};if(m.query!=null){k.searchTerm=m.query}if(l!==null){this.serviceXhr({url:l,query:k,alfTopic:(m.alfResponseTopic?m.alfResponseTopic:null),method:"GET"})}},onTagQuery:function f(m){if(m==null||typeof m.callback!=="function"||m.callbackScope==null){this.alfLog("warn","A request was made for site tag data, but one or more of the following attributes was not provided: 'callback', 'callbackScope':",m)}else{var o=(m.maxTags!=null)?m.maxTags:100;var n=new Date().getTime();var l=null;if(m.siteId!=null&&m.containerId!=null){l=d.PROXY_URI+"api/tagscopes/site/"+m.siteId+"/"+m.containerId+"/tags?d="+n+"&topN="+o}else{if(m.rootNode!=null){l=d.PROXY_URI+"collaboration/tagQuery?d="+n+"&m="+o+"&s=count&n="+encodeURIComponent(m.rootNode)}else{this.alfLog("warn","It is not possible to retrieve tags without a 'siteId' and 'containerId' or a 'rootNode' attribute provided in payload",this)}}if(l!=null){var k={url:l,method:"GET",successCallback:m.callback,callbackScope:m.callbackScope};this.serviceXhr(k)}}},createTag:function c(m){var l=a.getObject("tagName",false,m);if(l!=null&&a.trim(l)!==""){var k={url:d.PROXY_URI+"api/tag/workspace/SpacesStore",method:"POST",alfTopic:(m.alfResponseTopic?m.alfResponseTopic:null),data:{name:l}};this.serviceXhr(k)}else{this.alfLog("warn","A request was made to create a tag but no 'tagName' attribute was provided",this,m)}}})});