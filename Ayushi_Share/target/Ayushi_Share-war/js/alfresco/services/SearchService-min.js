define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/CoreXhr","service/constants/Default","alfresco/core/PathUtils","alfresco/core/NodeUtils","dojo/_base/lang","dojo/json","dojo/hash"],function(h,b,d,e,k,l,a,i,g){return h([b,d,k],{constructor:function c(m){a.mixin(this,m);this.alfSubscribe("ALF_SEARCH_REQUEST",a.hitch(this,this.onSearchRequest));this.alfSubscribe("ALF_STOP_SEARCH_REQUEST",a.hitch(this,this.onStopRequest));this.alfSubscribe("ALF_AUTO_SUGGEST_SEARCH",a.hitch(this,this.onAutoSuggest))},pageSize:25,query:"",repo:true,rootNode:"alfresco://company/home",site:"",sort:"",sortAscending:true,startIndex:0,tag:"",onSearchRequest:function f(t){if(t==null||t.term==null){this.alfLog("warn","A request was made to perform a search but no 'term' attribute was provided",t,this)}else{var q=(t.alfResponseTopic!=null)?t.alfResponseTopic:"ALF_SEARCH_REQUEST";var m=e.PROXY_URI+"slingshot/search/";var r=this.query;if(t.query==null){var s={};for(var u in t){switch(u){case"alfTopic":case"alfResponseTopic":case"term":case"tag":case"startIndex":case"sort":case"site":case"rootNode":case"repo":case"pageSize":case"facetFields":case"filters":case"sortAscending":case"sortField":case"requestId":case"spellcheck":break;default:s[u]=t[u]}}r=i.stringify(s);if(r=="{}"){r=""}}else{r=t.query}var p="";if(t.sortField!=null&&(t.sortField==="null"||t.sortField==="")){}else{if(t.sortField==="Relevance"){p=""}else{p=((t.sortField!=null)?t.sortField:this.sort)+"|"+((t.sortAscending!=null)?t.sortAscending:this.sortAscending)}}var o={facetFields:(t.facetFields!=null)?t.facetFields:"{http://www.alfresco.org/model/content/1.0}content.mimetype,{http://www.alfresco.org/model/content/1.0}modifier.__,{http://www.alfresco.org/model/content/1.0}creator.__,{http://www.alfresco.org/model/content/1.0}description.__",filters:(t.filters!=null)?t.filters:"",term:t.term,tag:(t.tag!=null)?t.tag:this.tag,startIndex:(t.startIndex!=null)?t.startIndex:this.startIndex,sort:p,site:(t.site!=null)?t.site:this.site,rootNode:(t.rootNode!=null)?t.rootNode:this.rootNode,repo:(t.repo!=null)?t.repo:this.repo,query:r,pageSize:(t.pageSize!=null)?t.pageSize:this.pageSize,noCache:new Date().getTime(),spellcheck:(t.spellcheck!=null)?t.spellcheck:false};var n={requestId:t.requestId,alfTopic:q,url:m,query:o,method:"GET",callbackScope:this};this.serviceXhr(n)}},onAutoSuggest:function j(o){var n=e.PROXY_URI+"slingshot/auto-suggest";var m={t:""};if(o.query!=null){m.t=o.query}if(n!==null){this.serviceXhr({url:n,query:m,alfTopic:(o.alfResponseTopic?o.alfResponseTopic:null),method:"GET"})}}})});