define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/TinyMCE.html","alfresco/core/Core","service/constants/Default","dojo/_base/lang"],function(f,i,n,l,b,d,a){return f([i,n,b],{nonAmdDependencies:["/js/yui-common.js","/js/alfresco.js","/modules/editors/tiny_mce.js"],templateString:l,supportedLocales:"en,de,es,fr,it,ja,nl,zh_CN,ru,nb,pt_BR",defaultEditorConfig:{height:250,width:538,menu:{},toolbar:"bold italic underline | bullist numlist | forecolor backcolor | undo redo removeformat",language:d.JS_LOCALE,statusbar:false,theme_advanced_resize_horizontal:false},editorConfig:null,intialContent:"",immediateInit:true,postCreate:function m(){var r=a.clone(this.defaultEditorConfig);if(this.editorConfig!=null){a.mixin(r,this.editorConfig)}if(r.language){var p=this.supportedLocales.split(",");var o="en";for(var s=0,q=p.length;s<q;s++){if(p[s]==r.language){o=r.language;break}}r.language=o}if(this.immediateInit===true){this.init(r)}else{this._delayedInitConfig=r}},init:function k(p){if(p==null){p=this._delayedInitConfig}p.theme="modern";if(!p.toolbar){p.toolbar="styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview fullscreen"}if(!p.menu){p.menu={file:{title:"File",items:"newdocument | print"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},insert:{title:"Insert",items:"link image | charmap hr anchor pagebreak inserttime nonbreaking"},view:{title:"View",items:"fullscreen preview visualblocks code"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"}}}p.plugins=["advlist autolink link image lists charmap print preview hr anchor pagebreak","searchreplace code fullscreen insertdatetime nonbreaking","table contextmenu paste textcolor visualblocks"];p.relative_urls=true;p.convert_urls=false;p.init_instance_callback=a.hitch(this,this.editorInitialized);this.editor=new tinymce.Editor(this.editorNode,p,tinymce.EditorManager);var o=p.extended_valid_elements;o=(o&&o!=="")?(o=o+","):"";p.extended_valid_elements=o+"embed[src|type|width|height|flashvars|wmode]";this.editor.render();this.editor.save();return this},_editorInitialized:false,contentChangeScope:null,contentChangeHandler:null,editorInitialized:function g(o){this.alfLog("log","TinyMCE Editor intialized!",o);if(this.contentChangeScope&&this.contentChangeHandler){o.on("change",a.hitch(this.contentChangeScope,this.contentChangeHandler))}o.setContent(this.initialContent);this._editorInitialized=true;this.setDisabled(this.initiallyDisabled)},destroy:function h(o){this.inherited(arguments)},initiallyDisabled:false,setDisabled:function c(o){if(this._editorInitialized){this.editor.getBody().setAttribute("contenteditable",!o)}else{this.initiallyDisabled=o}},getValue:function j(){if(this._editorInitialized){return this.editor.getContent()}else{return""}},setValue:function e(o){if(this._editorInitialized){this.editor.setContent(o)}else{this.initialContent=o}}})});