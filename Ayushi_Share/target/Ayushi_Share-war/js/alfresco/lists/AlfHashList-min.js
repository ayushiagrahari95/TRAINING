define(["dojo/_base/declare","alfresco/lists/AlfList","alfresco/documentlibrary/_AlfHashMixin","dojo/_base/lang","dojo/hash","dojo/io-query"],function(e,f,i,a,d,c){return e([f,i],{useHash:false,hashVarsForUpdate:[],useLocalStorageHashFallback:false,useLocalStorageHashFallbackKey:"ALF_LOCAL_STORAGE_HASH",onPageWidgetsReady:function h(m){this.alfUnsubscribe(this.pageWidgetsReadySubcription);this._readyToLoad=true;if(this.useHash){this.alfSubscribe(this.hashChangeTopic,a.hitch(this,this.onHashChanged));var l=d();if(l===""&&this.useLocalStorageHashFallback===true&&("localStorage" in window&&window.localStorage!==null)){var j=localStorage.getItem(this.useLocalStorageHashFallbackKey);l=(j!==null)?j:"";this.alfSubscribe(this.hashChangeTopic,a.hitch(this,this.updateLocallyStoredHash))}else{if(l!==""&&this.useLocalStorageHashFallback===true&&("localStorage" in window&&window.localStorage!==null)){localStorage.setItem(this.useLocalStorageHashFallbackKey,d())}}var k=c.queryToObject(l);if(!this._payloadContainsUpdateableVar(k)){this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:c.objectToQuery(this.currentFilter),type:"HASH"},true)}else{this.initialiseFilter(l)}}else{this.alfSubscribe(this.linkClickTopic,a.hitch(this,this.onItemLinkClick));if(this.currentData!=null){this.processLoadedData(this.currentData);this.renderView()}else{this.loadData()}}},_payloadContainsUpdateableVar:function b(k){if(this.hashVarsForUpdate==null||this.hashVarsForUpdate.length===0){return true}for(var j=0;j<this.hashVarsForUpdate.length;j++){if(this.hashVarsForUpdate[j] in k){return true}}return false},updateLocallyStoredHash:function g(j){if(this.useLocalStorageHashFallback===true&&("localStorage" in window&&window.localStorage!==null)){localStorage.setItem(this.useLocalStorageHashFallbackKey,d())}},onHashChanged:function g(j){if(this._payloadContainsUpdateableVar(j)){if(this._readyToLoad){this.loadData()}}}})});