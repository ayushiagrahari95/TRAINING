define(["dojo/_base/declare","alfresco/lists/AlfHashList","alfresco/services/_PreferenceServiceTopicMixin","dojo/_base/lang","dojo/hash","dojo/io-query"],function(j,d,h,c,i,g){return j([d,h],{usePagination:true,currentPage:1,currentPageSize:25,sortAscending:true,sortField:"cm:name",postMixInProperties:function e(){this.inherited(arguments);this.alfPublish(this.getPreferenceTopic,{preference:"org.alfresco.share.documentList.documentsPerPage",callback:this.setPageSize,callbackScope:this})},setPageSize:function p(q){if(q==null){q=25}this.currentPageSize=q},setupSubscriptions:function b(){this.inherited(arguments);this.alfSubscribe(this.sortRequestTopic,c.hitch(this,this.onSortRequest));this.alfSubscribe(this.sortFieldSelectionTopic,c.hitch(this,this.onSortFieldSelection));this.alfSubscribe(this.pageSelectionTopic,c.hitch(this,this.onPageChange));this.alfSubscribe(this.docsPerpageSelectionTopic,c.hitch(this,this.onItemsPerPageChange))},onSortRequest:function f(r){this.alfLog("log","Sort requested: ",r);if(r&&(r.direction!=null||r.value!=null)){if(r.direction){this.sortAscending=(r.direction=="ascending")}if(r.value){this.sortField=r.value}if(this._readyToLoad==true){if(this.useHash==true){var q=g.queryToObject(i());if(this.sortField!=null){q.sortField=this.sortField}if(this.sortAscending!=null){q.sortAscending=this.sortAscending}this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:g.objectToQuery(q),type:"HASH"},true)}else{this.loadData()}}}},onSortFieldSelection:function k(r){this.alfLog("log","Sort field selected: ",r);if(r&&r.value!=null){this.sortField=r.value;if(r.direction){this.sortAscending=(r.direction=="ascending")}if(this._readyToLoad==true){if(this.useHash==true){var q=g.queryToObject(i());if(this.sortField!=null){q.sortField=this.sortField}if(this.sortAscending!=null){q.sortAscending=this.sortAscending}this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:g.objectToQuery(q),type:"HASH"},true)}else{this.loadData()}}}},onPageChange:function o(q){if(q&&q.value!=null&&q.value!=this.currentPage){this.currentPage=q.value;if(this._readyToLoad){this.loadData()}}},onItemsPerPageChange:function a(q){if(q&&q.value!=null&&q.value!=this.currentPageSize){if(this.currentPage==1){}else{if((this.currentData.totalRecords-q.value)<((this.currentPage-1)*q.value)){this.currentPage=Math.ceil(this.currentData.totalRecords/q.value)}else{}}this.currentPageSize=q.value;if(this._readyToLoad){this.loadData()}}},onScrollNearBottom:function n(q){if(this.useInfiniteScroll&&this.currentData.totalRecords<this.currentData.numberFound){this.currentPage++;this.loadData()}},updateLoadDataPayload:function l(q){this.inherited(arguments);q.sortAscending=this.sortAscending;q.sortField=this.sortField;if(this.usePagination||this.useInfiniteScroll){q.page=this.currentPage;q.pageSize=this.currentPageSize}},resetPaginationData:function m(){this.alfLog("info","Resetting currentPage to 1");this.currentPage=1}})});