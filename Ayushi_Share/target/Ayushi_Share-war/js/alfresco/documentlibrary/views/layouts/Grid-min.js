define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","alfresco/core/ResizeMixin","dijit/_KeyNavContainer","dojo/text!./templates/Grid.html","alfresco/documentlibrary/views/layouts/_MultiItemRendererMixin","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","dojo/keys","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-geometry","dojo/query","dojo/dom-style","dijit/registry","dojo/dom","dojo/on"],function(z,b,v,C,c,B,D,n,s,q,E,k,j,y,g,u,l,x,m){return z([b,v,C,c,D,n,s],{cssRequirements:[{cssFile:"./css/Grid.css"}],templateString:B,columns:4,postCreate:function f(){this.inherited(arguments);if(this.currentItem){if(this.widgets){this.processWidgets(this.widgets,this.containerNode)}}this.setupKeyboardNavigation();this.alfSetupResizeSubscriptions(this.resizeCells,this)},setupKeyboardNavigation:function d(){this._keyNavCodes[q.UP_ARROW]=E.hitch(this,"focusOnCellAbove");this._keyNavCodes[q.RIGHT_ARROW]=E.hitch(this,"focusOnCellRight");this._keyNavCodes[q.DOWN_ARROW]=E.hitch(this,"focusOnCellBelow");this._keyNavCodes[q.LEFT_ARROW]=E.hitch(this,"focusOnCellLeft")},_onChildBlur:function a(F){if(typeof F.blur==="function"){F.blur()}},focusOnCellLeft:function o(){var H=null,I=this.getIndexOfChild(this.focusedChild),F=this.getChildren(),G=this.getChildren().length;if(I>0){H=F[I-1]}else{H=F[G-1]}this.focusChild(H)},focusOnCellRight:function o(){var H=null,I=this.getIndexOfChild(this.focusedChild),F=this.getChildren(),G=this.getChildren().length;if(I<G-1){H=F[I+1]}else{H=F[0]}this.focusChild(H)},focusOnCellAbove:function i(){var I=null,K=this.getIndexOfChild(this.focusedChild),H=(K%this.columns)+1,F=this.getChildren(),G=this.getChildren().length;if(K-this.columns<0){var J=G%this.columns;if(J===0||J>=H){I=F[G-(this.columns-H)+1]}else{I=F[G-1]}}else{I=F[K-this.columns]}this.focusChild(I)},focusOnCellBelow:function A(){var I=null,J=this.getIndexOfChild(this.focusedChild),H=(J%this.columns),F=this.getChildren(),G=this.getChildren().length;if((J+this.columns)>=G){I=F[H]}else{I=F[J+this.columns]}this.focusChild(I)},resizeCells:function w(){this.alfLog("info","Resizing");var H=E.getObject("containerNode.parentNode",false,this);if(H){var F=y.getContentBox(H);var G=(Math.floor(F.w/this.columns)-4)+"px";g("tr > td",H).forEach(E.hitch(this,"resizeCell",F,G))}},resizeCell:function t(J,I,H,F){u.set(H,{width:I});var G={w:I,h:null};k.forEach(H.children,E.hitch(this,"resizeWidget",G))},resizeWidget:function e(G,I,F){var H=l.byNode(I);if(H!=null&&typeof H.resize==="function"){H.resize(G)}},createWidgetDomNode:function r(K,H,G){var F=H;if(this.currentIndex%this.columns===0){var I=j.create("TR",{},H);F=j.create("TD",{},I)}else{var J=H.children[H.children.length-1];F=j.create("TD",{},J)}return j.create("DIV",{},F)},renderNextItem:function p(){if(this.nextLinkDisplay){var F=this.nextLinkDisplay.domNode.parentNode;var G=F.parentNode;G.removeChild(F);this.nextLinkDisplay.destroy();this.nextLinkDisplay=null}this.inherited(arguments)},showNextLink:false,nextLinkLabel:null,nextLinkPublishTopic:null,allItemsRendered:function h(){if(this.showNextLink&&this.currentData.totalRecords<this.currentData.numberFound){this.processWidgets([{name:"alfresco/layout/VerticalWidgets",assignTo:"nextLinkDisplay",config:{widgets:[{name:"alfresco/renderers/PropertyLink",config:{currentItem:{label:this.nextLinkLabel},propertyToRender:"label",renderSize:"small",useCurrentItemAsPayload:false,publishTopic:this.nextLinkPublishTopic,publishPayloadType:"CONFIGURED",publishPayload:{}}}]}}],this.containerNode)}}})});