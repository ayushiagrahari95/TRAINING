define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_OnDijitClickMixin","alfresco/core/Core","alfresco/core/ResizeMixin","alfresco/documentlibrary/views/layouts/_MultiItemRendererMixin","dojo/text!./templates/Carousel.html","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/window"],function(u,c,q,l,k,x,y,w,z,h,j,f,n,s,e){return u([c,q,l,x,y,k],{cssRequirements:[{cssFile:"./css/Carousel.css"}],templateString:w,postMixInProperties:function t(){this.contentNavNextArrowImgSrc=require.toUrl("alfresco/documentlibrary/views/layouts")+"/css/images/filmstrip-content-nav-next.png";this.contentNavPrevArrowImgSrc=require.toUrl("alfresco/documentlibrary/views/layouts")+"/css/images/filmstrip-content-nav-prev.png"},postCreate:function r(){if(this.currentItem){if(this.widgets){this.processWidgets(this.widgets,this.containerNode)}}if(this.itemSelectionTopics){h.forEach(this.itemSelectionTopics,function(B,A){this.alfSubscribe(B,z.hitch(this,this.selectItem))},this)}this.alfSubscribe("ALF_WIDGETS_READY",z.hitch(this,this.resize),true);this.alfSetupResizeSubscriptions(this.resize,this)},itemWidth:100,navigationMargin:40,resize:function o(){this.calculateSizes();n.set(this.itemsNode,"width",this.itemsNodeWidth+"px");n.set(this.itemsNode,"height",this.height);this.resizeContainer();this.lastDisplayedIndex=this.firstDisplayedIndex+(this.numberOfItemsShown-1);this.renderDisplayedItems()},resizeContainer:function m(){var B=z.getObject("currentData.items.length",false,this);if(B!==null){var A=(B*this.itemsNodeWidth)+"px";n.set(this.containerNode,"width",A)}},height:null,calculateSizes:function i(){if(this.domNode){var C=n.getComputedStyle(this.domNode);var B=s.getMarginBox(this.domNode,C);var D=B.w-(2*this.navigationMargin);this.numberOfItemsShown=Math.floor(D/this.itemWidth);this.itemsNodeWidth=this.numberOfItemsShown*this.itemWidth;if(this.fixedHeight!=null){this.height=this.fixedHeight}else{var A=s.position(this.domNode);var E=e.getBox();this.height=E.h-A.y;this.height+="px"}}},processWidgets:function g(C,B){var A=A=f.create("li",{},B);this.inherited(arguments,[C,A])},currentLeftPosition:0,firstDisplayedIndex:0,lastDisplayedIndex:null,onPrevClick:function v(A){if(this.currentLeftPosition>0){this.currentLeftPosition-=this.itemsNodeWidth;this.firstDisplayedIndex-=this.numberOfItemsShown;this.lastDisplayedIndex-=this.numberOfItemsShown;this.renderDisplayedItems()}},onNextClick:function a(A){this.currentLeftPosition+=this.itemsNodeWidth;this.firstDisplayedIndex+=this.numberOfItemsShown;this.lastDisplayedIndex+=this.numberOfItemsShown;this.renderDisplayedItems()},renderDisplayedItems:function b(){for(var B=this.firstDisplayedIndex;B<=this.lastDisplayedIndex;B++){if(this._renderedItemWidgets){var C=this._renderedItemWidgets[B];h.forEach(C,z.hitch(this,this.renderDisplayedItem))}}this.currentLeftPosition=(this.firstDisplayedIndex/this.numberOfItemsShown)*this.itemsNodeWidth;var D="-"+this.currentLeftPosition+"px";n.set(this.containerNode,"left",D);var A=z.getObject("currentData.items.length",false,this);n.set(this.prevNode,"visibility",(this.firstDisplayedIndex==0)?"hidden":"visible");n.set(this.nextNode,"visibility",(this.firstDisplayedIndex<=A-1&&this.lastDisplayedIndex>=A-1)?"hidden":"visible")},renderDisplayedItem:function p(B,A){if(B&&typeof B.render==="function"){B.render()}},selectItem:function d(B){if(B.index!=null&&!isNaN(parseInt(B.index))){var A=parseInt(B.index);if(A>=this.firstDisplayedIndex&&A<=this.lastDisplayedIndex){}else{if(A>this.lastDisplayedIndex){while(A>this.lastDisplayedIndex){this.firstDisplayedIndex+=this.numberOfItemsShown;this.lastDisplayedIndex+=this.numberOfItemsShown}this.renderDisplayedItems()}else{while(A<this.firstDisplayedIndex){this.firstDisplayedIndex-=this.numberOfItemsShown;this.lastDisplayedIndex-=this.numberOfItemsShown}this.renderDisplayedItems()}}}}})});