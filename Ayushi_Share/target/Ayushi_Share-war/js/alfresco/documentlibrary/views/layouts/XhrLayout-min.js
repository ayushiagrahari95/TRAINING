define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_OnDijitClickMixin","dojo/text!./templates/XhrLayout.html","alfresco/documentlibrary/views/layouts/_MultiItemRendererMixin","alfresco/core/Core","alfresco/core/CoreWidgetProcessing","dojo/_base/lang","dojo/_base/array","dijit/registry","dojo/dom-construct","dojo/dom-class"],function(j,l,p,g,n,b,f,c,e,k,a,h,m){return j([l,p,g,b,f,c],{cssRequirements:[{cssFile:"./css/XhrLayout.css"}],templateString:n,postCreate:function d(){var q=e.getObject("currentItem.node",false,this);if(q==null&&this.widgets!=null){this.processWidgets(this.widgets,this.containerNode)}else{if(this.widgetsForXhrData!=null){this.processWidgets(this.widgetsForXhrData,this.containerNode)}}},getXhrData:function o(){var r=e.getObject("nodeRef",false,this.currentItem);if(r!=null){var q=this.generateUuid();this._xhrDataRequestHandle=this.alfSubscribe(q+"_SUCCESS",e.hitch(this,"onXhrData"),true);this.alfPublish("ALF_RETRIEVE_SINGLE_DOCUMENT_REQUEST",{alfResponseTopic:q,nodeRef:r},true)}else{this.alfLog("warn","No nodeRef attribute available to use to retrieve all data.",this)}},onXhrData:function i(r){this.alfUnsubscribeSaveHandles([this._xhrDataRequestHandle]);if(e.exists("response.item",r)){this.currentItem=r.response.item;if(this.containerNode!=null){try{k.forEach(a.findWidgets(this.containerNode),e.hitch(this,"destroyWidget"))}catch(q){this.alfLog("error","Couldn't destroy widgets",q)}h.empty(this.containerNode)}try{this.processWidgets(this.widgetsForXhrData,this.containerNode)}catch(q){this.alfLog("error","Couldn't create XHR layout",q)}}else{this.alfLog("warn","Document data was provided but the 'response.item' attribute was not found",r,this)}}})});