define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AlfDocumentListView.html","alfresco/documentlibrary/views/layouts/_MultiItemRendererMixin","alfresco/documentlibrary/_AlfDndDocumentUploadMixin","alfresco/documentlibrary/views/DocumentListRenderer","alfresco/core/Core","alfresco/core/JsNode","alfresco/core/WidgetsCreator","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-class","dojo/query","dijit/registry"],function(B,c,w,D,E,p,v,q,z,A,G,k,i,n,g,l){return B([c,w,E,q,p],{i18nRequirements:[{i18nFile:"./i18n/AlfDocumentListView.properties"}],cssRequirements:[{cssFile:"./css/AlfDocumentListView.css"}],templateString:D,widgets:null,noItemsMessage:null,subscribeToDocRequests:false,documentSubscriptionTopic:"ALF_RETRIEVE_DOCUMENTS_REQUEST_SUCCESS",postCreate:function h(){this.inherited(arguments);n.add(this.domNode,(this.additionalCssClasses!=null?this.additionalCssClasses:""));if(this.noItemsMessage==null){this.noItemsMessage=this.message("doclistview.no.data.message")}else{this.noItemsMessage=this.message(this.noItemsMessage)}this.subscribeToCurrentNodeChanges(this.domNode);this.addUploadDragAndDrop(this.domNode);if(this.subscribeToDocRequests){this.alfSubscribe(this.documentSubscriptionTopic,G.hitch(this,this.onDocumentsLoaded))}if(this.currentData!=null){this.renderView(false)}this._renderOptionalElements()},itemsProperty:"response.items",onDocumentsLoaded:function s(I){var H=G.getObject(this.itemsProperty,false,I);if(H!=null){k.forEach(H,G.hitch(this,this.processItem));this.setData({items:H});this.renderView(false)}else{this.alfLog("warn","Payload contained no 'response.items' attribute",I,this)}},processItem:function f(I,H){try{if(I.node){I.jsNode=new z(I.node)}}catch(J){this.alfLog("warn","Could not process item as Alfresco node",I,J)}},viewSelectionConfig:{label:"Abstract",value:"Abstract"},getViewName:function y(){return this.viewSelectionConfig.value},getViewSelectionConfig:function d(){return this.viewSelectionConfig},getAdditionalControls:function r(){return[]},augmentData:function C(H){this.inherited(arguments);if(this.docListRenderer!=null){this.docListRenderer.currentData=this.currentData}},renderView:function j(I){if(this.currentData&&this.currentData.items&&this.currentData.items.length>0){try{if(this.messageNode!=null){i.destroy(this.messageNode)}if(I===false&&this.docListRenderer!=null){this.docListRenderer.destroy();this.docListRenderer=null}if(this.docListRenderer==null){this.docListRenderer=this.createDocumentListRenderer();this.docListRenderer.placeAt(this.tableNode,"last")}this.docListRenderer.renderData();if(g(this.renderFilterSelectorQuery,this.tableNode).length===0){this.renderNoDataDisplay()}}catch(H){this.alfLog("error","The following error occurred rendering the data",H,this);this.renderErrorDisplay()}}else{this.renderNoDataDisplay()}},renderFilterSelectorQuery:"tr",createDocumentListRenderer:function o(){var H=new v({id:this.id+"_ITEMS",widgets:this.widgets,currentData:this.currentData,pubSubScope:this.pubSubScope,parentPubSubScope:this.parentPubSubScope});return H},clearOldView:function F(){if(this.docListRenderer!=null){this.docListRenderer.destroy();this.docListRenderer=null}if(this.messageNode!=null){i.destroy(this.messageNode)}g("tbody",this.tableNode).forEach(i.destroy);this.clearData()},destroyWidget:function b(I,H){if(typeof I.destroyRecursive==="function"){I.destroyRecursive()}},onViewShown:function t(){},widgetsForNoDataDisplay:null,renderNoDataDisplay:function a(){this.clearOldView();if(this.noItemsMessage||this.widgetsForNoDataDisplay){this.messageNode=i.create("div",{innerHTML:this.noItemsMessage},this.domNode)}if(this.widgetsForNoDataDisplay!=null){var H=new A({widgets:this.widgetsForNoDataDisplay});i.empty(this.messageNode);H.buildWidgets(this.messageNode)}},renderErrorDisplay:function e(){this.clearOldView();this.messageNode=i.create("div",{innerHTML:this.message("doclistview.rendering.error.message")},this.domNode)},_renderOptionalElements:function x(){this._renderHeader();this._renderCaption()},_renderHeader:function u(){this.currentItem={};if(this.widgetsForHeader!=null){var H=i.create("thead",null,this.tableNode,"first");this.processWidgets(this.widgetsForHeader,H)}this.currentItem=null},_renderCaption:function m(){if(this.a11yCaption&&this.tableNode){var H=i.create("caption",{innerHTML:this.a11yCaption},this.tableNode,"first");if(this.a11yCaptionClass){n.add(H,this.a11yCaptionClass)}}}})});