define(["dojo/_base/declare","alfresco/lists/AlfSortablePaginatedList","alfresco/core/JsNode","dojo/_base/array","dojo/_base/lang","dojo/hash","dojo/io-query","alfresco/core/NodeUtils"],function(u,h,r,d,x,b,t,k){return u([h],{i18nRequirements:[{i18nFile:"./i18n/AlfDocumentList.properties"}],cssRequirements:[{cssFile:"./css/AlfDocumentList.css"}],showFolders:true,showDocuments:true,currentFilter:null,parentNavTopic:"ALF_DOCLIST_PARENT_NAV",postMixInProperties:function a(){this.inherited(arguments);this.currentFilter={path:"/"}},setupSubscriptions:function l(){this.inherited(arguments);this.alfSubscribe("ALF_DOCUMENTLIST_PATH_CHANGED",x.hitch(this,this.onPathChanged));this.alfSubscribe("ALF_DOCUMENTLIST_CATEGORY_CHANGED",x.hitch(this,this.onCategoryChanged));this.alfSubscribe("ALF_DOCUMENTLIST_TAG_CHANGED",x.hitch(this,this.onTagChanged));this.alfSubscribe(this.filterSelectionTopic,x.hitch(this,this.onFilterChanged));this.alfSubscribe(this.documentSelectionTopic,x.hitch(this,this.onDocumentSelection));this.alfSubscribe(this.showFoldersTopic,x.hitch(this,this.onShowFolders));this.alfSubscribe(this.parentNavTopic,x.hitch(this,this.onParentNav))},onPathChanged:function m(z){if(z.path){if(this.useHash===true){var y=t.queryToObject(b());y.path=z.path;delete y.filter;delete y.category;delete y.tag;this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:t.objectToQuery(y),type:"HASH"},true)}else{this.currentFilter={path:z.path};this.loadData()}}else{this.alfLog("warn","A request was made to change the displayed path of a Document List, but no 'path' attribute was provided",z,this)}},onCategoryChanged:function i(z){if(z.path){if(this.useHash===true){var y=t.queryToObject(b());y.category=z.path;delete y.filter;delete y.path;delete y.tag;this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:t.objectToQuery(y),type:"HASH"},true)}else{this.currentFilter={category:z.path};this.loadData()}}else{this.alfLog("warn","A request was made to change the displayed path of a Document List, but no 'path' attribute was provided",z,this)}},onFilterChanged:function v(z){if(z.value){if(this.useHash===true){var y=t.queryToObject(b());y.filter=z.value;delete y.category;delete y.path;delete y.tag;this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:t.objectToQuery(y),type:"HASH"},true)}else{this.currentFilter={filter:z.value}}}else{this.alfLog("warn","A request was made to change the filter for a Document List, but no 'value' attribute was provided",z,this)}},onTagChanged:function p(z){if(z.value){if(this.useHash===true){var y=t.queryToObject(b());y.tag=z.value;delete y.category;delete y.path;delete y.filter;this.alfPublish("ALF_NAVIGATE_TO_PAGE",{url:t.objectToQuery(y),type:"HASH"},true)}else{this.currentFilter={tag:z.value}}}else{this.alfLog("warn","A request was made to change the tag filter for a Document List, but no 'value' attribute was provided",z,this)}},linkClickTopic:"ALF_DOCLIST_NAV",onItemLinkClick:function o(z){var y=x.getObject("item.node",false,z)||z.node;if(y.isContainer===true||y.isLink===true){this.onFolderClick(z)}else{this.onDocumentClick(z)}},onFolderClick:function c(y){if(y.url!=null){this.currentFilter=this.processFilter(y.url);if(this._readyToLoad){this.loadData()}}else{this.alfLog("warn","A 'url' attribute was expected to be provided for an item click",y,this)}},onDocumentClick:function f(y){},onHashChanged:function q(y){if(this._payloadContainsUpdateableVar(y)){this.currentFilter=y;if(this._readyToLoad){this.loadData()}}},onParentNav:function s(B){var z=this.generateUuid()+"_parentNavSuccess",y=[this.alfSubscribe(z,x.hitch(this,this.onParentNavSuccess),true)];var A=x.getObject("currentData.metadata.parent.nodeRef",false,this);if(A){this.alfPublish("ALF_DOC_GET_PARENT_NODEREF",{nodeRef:A,originalResponseTopic:z,subscriptionHandles:y},true)}else{this.alfLog("error","Cannot retrieve parent nodeRef",this)}},onParentNavSuccess:function w(y){this.alfPublish(this.linkClickTopic,y)},updateLoadDataPayload:function j(z){this.inherited(arguments);var y="all";if(this.showFolders===false&&this.showDocuments===false){this.alfLog("warn","An AlfDocumentList has been configured to neither show folders nor documents, so showing both",this)}else{if(this.showFolders===false){y="documents"}else{if(this.showDocuments===false){y="folders"}}}z.type=y;z.site=this.siteId;z.container=this.containerId;z.filter=this.currentFilter;z.libraryRoot=this.rootNode;if((this.siteId==null||this.siteId==="")&&this.nodeRef!=null){z.nodeRef=this.nodeRef.toString()}},processLoadedData:function g(y){d.forEach(this.currentData,function(A,z){A.jsNode=new r(A.node)},this);if(y.metadata){this.alfPublish(this.metadataChangeTopic,{node:y.metadata});if(y.metadata.parent&&y.metadata.parent.permissions&&y.metadata.parent.permissions.user){this.alfPublish(this.userAccessChangeTopic,{userAccess:y.metadata.parent.permissions.user})}}this.inherited(arguments)},onDocumentSelection:function e(y){this.alfLog("log","Documents Selected: ",y)},onShowFolders:function n(y){this.alfLog("log","Show Folders Request: ",y);if(y&&y.selected!=null){this.showFolders=y.selected;if(this._readyToLoad){this.loadData()}}}})});