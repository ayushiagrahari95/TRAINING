define(["dojo/_base/declare","alfresco/menus/AlfMenuBar","alfresco/documentlibrary/_AlfDocumentListTopicMixin","dojo/_base/lang","dojo/_base/array","alfresco/menus/AlfMenuBarSelect","alfresco/menus/AlfMenuGroups","alfresco/menus/AlfMenuGroup","alfresco/menus/AlfCheckableMenuItem","dijit/registry","dojo/dom-class"],function(o,c,a,s,f,k,j,b,h,g,i){return o([c,a],{i18nRequirements:[{i18nFile:"./i18n/AlfDocumentListPaginator.properties"}],cssRequirements:[{cssFile:"./css/AlfDocumentListPaginator.css"}],documentsPerPage:25,totalDocuments:null,totalPages:null,currentPage:null,pageBackTopic:"ALF_PAGE_BACK",pageForwardTopic:"ALF_PAGE_FORWARD",postMixInProperties:function m(){this.alfSubscribe(this.documentsLoadedTopic,s.hitch(this,"onDocumentsLoaded"));this.alfSubscribe(this.docsPerpageSelectionTopic,s.hitch(this,"onDocumentsPerPageChange"));this.alfSubscribe(this.pageBackTopic,s.hitch(this,"onPageBack"));this.alfSubscribe(this.pageForwardTopic,s.hitch(this,"onPageForward"))},onDocumentsPerPageChange:function p(t){if(t&&t.value&&t.value!=this.documentsPerPage){this.documentsPerPage=t.value}},onPageBack:function n(t){this.currentPage--;this.alfPublish(this.pageSelectionTopic,{value:this.currentPage})},onPageForward:function d(t){this.currentPage++;this.alfPublish(this.pageSelectionTopic,{value:this.currentPage})},onDocumentsLoaded:function r(t){this.alfLog("log","New Documents Loaded",t);if(t!=null){if(this.__paginationControlsAvailable===true){this.processLoadedDocuments(t)}else{this.__deferredLoadedDocumentData=t}}},processLoadedDocuments:function l(z){if(z.totalDocuments!=null&&z.startIndex!=null){if(z.totalDocuments===0){i.add(this.domNode,"hidden")}else{i.remove(this.domNode,"hidden");this.totalDocuments=z.totalDocuments;this.totalPages=Math.ceil(z.totalDocuments/this.documentsPerPage);this.currentPage=((z.startIndex-(z.startIndex%this.documentsPerPage))/this.documentsPerPage)+1;if(this.pageBack){this.pageBack.set("disabled",(this.currentPage==1))}if(this.pageForward){this.pageForward.set("disabled",(this.currentPage==this.totalPages))}if(this.pageMarker){this.pageMarker.set("label",this.currentPage.toString());i.remove(this.pageMarker.domNode,"dijitDisabled dijitMenuItemDisabled")}if(this.pageSelectorGroup!=null){var A=this;f.forEach(this.pageSelectorGroup.getChildren(),function(C,B){A.pageSelectorGroup.removeChild(C);C.destroy()})}if(this.compactMode===false){var x=[];var y=1;for(var u=0;u<this.totalPages;u++){var w;if(u+1!=this.totalPages){w=y+this.documentsPerPage-1}else{w=this.totalDocuments}var t=this.message("alf-documentlist-paginator.page.label",{0:y,1:w,2:this.totalDocuments});var v=new h({label:t,value:(u+1),group:"PAGE_SELECTION_GROUP",checked:(this.currentPage==u+1),publishTopic:this.pubSubScope+this.pageSelectionTopic,publishPayload:{label:t,value:(u+1)}});if(this.pageSelectorGroup!=null){this.pageSelectorGroup.addChild(v)}else{if(this.__initialPageSelectorItems==null){this.__initialPageSelectorItems=[]}this.__initialPageSelectorItems.push(v)}x.push();y=w+1}}}}},pageSelector:null,pageSelectorGroup:null,hidePageSizeOnWidth:1024,compactMode:false,postCreate:function q(){var w=this.message("alf-documentlist-paginator.perPage.label",{0:25}),v=this.message("alf-documentlist-paginator.perPage.label",{0:50}),u=this.message("alf-documentlist-paginator.perPage.label",{0:75}),t=this.message("alf-documentlist-paginator.perPage.label",{0:100});this.widgets=[{name:"alfresco/menus/AlfMenuBarItem",config:{id:this.id+"_PAGE_BACK",label:this.message("alf-documentlist-paginator.back.label"),publishTopic:this.pageBackTopic}},{name:"alfresco/menus/AlfMenuBarItem",config:{id:this.id+"_PAGE_MARKER",label:"1",disabled:true}},{name:"alfresco/menus/AlfMenuBarItem",config:{id:this.id+"_PAGE_FORWARD",label:this.message("alf-documentlist-paginator.next.label"),publishTopic:this.pageForwardTopic}}];if(this.compactMode===false){this.widgets.splice(0,0,{name:"alfresco/menus/AlfMenuBarSelect",config:{id:this.id+"_PAGE_SELECTOR",label:this.message("alf-documentlist-paginator.pageSelect.label"),selectionTopic:this.pageSelectionTopic,widgets:[{name:"alfresco/menus/AlfMenuGroup"}]}});this.widgets.splice(4,0,{name:"alfresco/menus/AlfMenuBarSelect",config:{id:this.id+"_RESULTS_PER_PAGE_SELECTOR",label:this.message("alf-documentlist-paginator.docsPerPageSelect.label"),selectionTopic:this.docsPerpageSelectionTopic,minRwdWidth:this.hidePageSizeOnWidth,widgets:[{name:"alfresco/menus/AlfMenuGroup",config:{widgets:[{name:"alfresco/menus/AlfCheckableMenuItem",config:{label:w,value:25,group:"DOCUMENTS_PER_PAGE_GROUP",checked:(this.documentsPerPage==25),publishTopic:this.docsPerpageSelectionTopic,publishPayload:{label:w,value:25}}},{name:"alfresco/menus/AlfCheckableMenuItem",config:{label:v,value:50,group:"DOCUMENTS_PER_PAGE_GROUP",checked:(this.documentsPerPage==50),publishTopic:this.docsPerpageSelectionTopic,publishPayload:{label:v,value:50}}},{name:"alfresco/menus/AlfCheckableMenuItem",config:{label:u,value:75,group:"DOCUMENTS_PER_PAGE_GROUP",checked:(this.documentsPerPage==75),publishTopic:this.docsPerpageSelectionTopic,publishPayload:{label:u,value:75}}},{name:"alfresco/menus/AlfCheckableMenuItem",config:{label:t,value:100,group:"DOCUMENTS_PER_PAGE_GROUP",checked:(this.documentsPerPage==100),publishTopic:this.docsPerpageSelectionTopic,publishPayload:{label:t,value:100}}}]}}]}})}this.inherited(arguments)},allWidgetsProcessed:function e(){this.inherited(arguments);this.__paginationControlsAvailable=true;if(this.compactMode===false){var t=this._menuBar.getChildren()[0].popup.getChildren();this.pageSelectorGroup=t[t.length-1]}this.pageBack=g.byId(this.id+"_PAGE_BACK");this.pageForward=g.byId(this.id+"_PAGE_FORWARD");this.pageMarker=g.byId(this.id+"_PAGE_MARKER");if(this.__deferredLoadedDocumentData!=null){this.processLoadedDocuments(this.__deferredLoadedDocumentData)}delete this.__deferredLoadedDocumentData}})});