define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/SubscriptionLog.html","alfresco/core/Core","alfresco/core/PubSubLog","dojo/aspect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-attr","alfresco/core/ObjectTypeUtils"],function(o,h,f,q,b,i,j,s,e,c,n,k){return o([h,f,b],{cssRequirements:[{cssFile:"./css/SubscriptionLog.css"}],templateString:q,pubSubLog:null,postCreate:function m(){this.pubSubLog=i.getSingleton();e.forEach(this.pubSubLog._log,s.hitch(this,"updateLog"));j.after(this.pubSubLog,"addEntry",s.hitch(this,"logUpdated"),true)},logUpdated:function g(t){this.updateLog(t)},topicsToIgnore:null,updateLog:function d(u){var x=true;if(this.topicsToIgnore!=null){x=!e.some(this.topicsToIgnore,function(A,z){return A===u.topic})}if(x===true){var v=c.create("tr",{className:"sl-row"},this.logNode);c.create("td",{className:"sl-type",innerHTML:u.type},v);var y=c.create("td",{className:"sl-topic",innerHTML:u.topic},v);n.set(y,"data-"+u.type+"-topic",u.topic);var w=c.create("td",{className:"sl-data"},v);this.addValueToLog(u.data,w,0);var t=c.create("td",{className:"sl-object",innerHTML:u.object},v);n.set(t,"data-pubsub-object-id",u.object);n.set(v,"data-pubsub-log-entry-by",u.object)}},addValueToLog:function r(u,t,v){if(v<6){if(u==null){this.addStringToLog("null",t)}else{if(typeof u==="number"){this.addStringToLog(u,t)}else{if(typeof u==="boolean"){this.addStringToLog(u.toString(),t)}else{if(typeof u==="function"){this.addStringToLog(u.name,t)}else{if(typeof u.addEventListener==="function"){this.addStringToLog("HTML Element",t)}else{if(k.isString(u)){this.addStringToLog(u,t)}else{if(k.isArray(u)){this.addArrayToLog(u,t,v+1)}else{if(k.isObject(u)){if(u.excludeFromPubSubLog===true){this.addStringToLog(u.id,t)}else{this.addObjectToLog(u,t,v+1)}}else{}}}}}}}}}},addStringToLog:function l(u,t){t.innerHTML=u;n.set(t,"data-pubsub-object-value",u)},addArrayToLog:function p(t,v,w){var u=c.create("table",{},v);e.forEach(t,function(y,x){var z=c.create("tr",{},u);var A=c.create("td",{},z);this.addValueToLog(y,A,w)},this)},addObjectToLog:function a(u,v,w){var B=c.create("table",{},v);for(var A in u){var t=c.create("tr",{className:"sl-object-row"},B);var z=c.create("td",{innerHTML:A},t);n.set(z,"data-pubsub-object-key",A);var x=c.create("td",{},t);var y=u[A];this.addValueToLog(y,x,w)}}})});