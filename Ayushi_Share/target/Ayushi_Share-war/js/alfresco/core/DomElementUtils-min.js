define(["dojo/_base/declare","dojo/dom-style","dojo/_base/lang","dojo/_base/array","dojo/dom-geometry","dojo/json"],function(e,d,f,g,b,c){var a={};return e(null,{getInputSelection:function(l){var o=0,j=0,n,k,i,h,m;if(typeof l.selectionStart=="number"&&typeof l.selectionEnd=="number"){o=l.selectionStart;j=l.selectionEnd}else{k=document.selection.createRange();if(k&&k.parentElement()==l){h=l.value.length;n=l.value.replace(/\r\n/g,"\n");i=l.createTextRange();i.moveToBookmark(k.getBookmark());m=l.createTextRange();m.collapse(false);if(i.compareEndPoints("StartToEnd",m)>-1){o=j=h}else{o=-i.moveStart("character",-h);o+=n.slice(0,o).split("\n").length-1;if(i.compareEndPoints("EndToEnd",m)>-1){j=h}else{j=-i.moveEnd("character",-h);j+=n.slice(0,j).split("\n").length-1}}}}return{start:o,end:j}},setCaretPosition:function(j,h){if(j.setSelectionRange){j.focus();j.setSelectionRange(h,h)}else{if(j.createTextRange){var i=j.createTextRange();i.moveStart("character",h);i.select()}}},getDocumentHeight:function(){var i=document.documentElement,h=document.body;return Math.max(h.scrollHeight,h.offsetHeight,i.scrollHeight,i.offsetHeight,i.clientHeight)},resolveDomCalculation:function(k){var h=k.initialValue;if(k.domCalculation){var n,m;for(var l=0,j=k.domCalculation.length;l<j;l++){n=k.domCalculation[l];m=document.querySelector(n.selector);if(this.domCalculationFunctions[n["function"]]){m=this.domCalculationFunctions[n["function"]].call(this,m)}else{throw new Error("Failed calculation due to missing function "+n["function"])}if(n.property){m=m[n.property]}if(this.domCalculationOperators[n.operator]){h=this.domCalculationOperators[n.operator].call(this,h,m)}else{throw new Error("Failed calculation due to missing operator "+n.operator)}}}return h},domCalculationFunctions:{marginBox:function(h){return b.getMarginBox(h)}},domCalculationOperators:{"+":function(h,i){return h+i},"-":function(h,i){return h-i}},resolveCssStyles:function(l,p,u,h){h=typeof h=="boolean"?h:true;var v;if(h){var n=c.stringify([l,p,u]);v=a[n];if(v){return v}}v={byName:[]};var j=document.createElement("div");document.body.appendChild(j);var q;var m;var o;for(var k=0,r=p.length;k<r;k++){j.className=(l||"")+p[k];q=d.getComputedStyle(j);o={};for(var t in u){m=q[t];if(!v[t]){v[t]=[]}if(f.isArray(u[t])){if(g.indexOf(u[t],m)==-1){v[t].push(m)}}else{if(m!=u){v[t].push(m)}}o[t]=m}v.byName.push({name:p[k],style:o})}if(h){a[n]=v}return v}})});