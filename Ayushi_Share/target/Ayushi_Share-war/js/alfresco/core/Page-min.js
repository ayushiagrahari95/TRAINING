define(["alfresco/core/ProcessWidgets","service/constants/Default","dojo/string","dojo/_base/declare","dojo/dom-construct","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dojo/_base/window","alfresco/core/PubQueue"],function(m,b,i,h,d,k,a,p,j,g){return h([m],{baseClass:"alfresco-core-Page",postCreate:function q(){try{if(b.DEBUG&&this.domNode!=null&&this.webScriptId!=null){this.webScriptLabel="WebScript ID:";this.extensionDownloadUrl=b.URL_PAGECONTEXT+"generator/extension?webscriptId="+this.webScriptId;this.extensionDownloadLabel="(Click to generate extension JAR)";var t='<div class="alfresco-debug-PageInfo"><span class="label">${webScriptLabel}</span><span class="value">${webScriptId}</span><a href="${extensionDownloadUrl}">${extensionDownloadLabel}</a></div>';var s=i.substitute(t,this);var r=d.toDom(s);d.place(r,this.domNode,"first")}if(this.services!=null&&this.services.length!==0){this.processServices(this.services)}else{if(this.widgets!=null&&this.widgets.length!==0){this.processWidgets(this.widgets,this.containerNode)}}}catch(u){console.error("BOOM!",u);this.alfLog("error","The following error occurred building the page",u);g.getSingleton().release()}},onReadyPublish:function l(r){if(r!=null&&r.publishTopic!=null&&r.publishTopic!==""){this.alfLog("log","Onload publication",r);this.alfPublish(r.publishTopic,r.publishPayload)}else{this.alfLog("warn","The page was configured with an onload publication but no 'publishTopic' was provided",r,this)}},processServices:function f(t,u,r,s){if(t){if(this.servicesToDestroy==null){this.servicesToDestroy=[]}this.serviceProcessingComplete=false;this._processedServiceCountdown=t.length;this._processedServices=[];k.forEach(t,function(w,v){this.createService(w,this._registerProcessedService,this,s)},this)}},createService:function o(t,y,r,s){var w=null,v={};if(typeof t==="string"){w=t}else{if(typeof t==="object"&&t.name!=null){w=t.name;if(typeof t.config==="object"){v=t.config}}}if(v.pubSubScope===undefined){v.pubSubScope=this.pubSubScope}var x=this;var u=[w];require(u,function(A){var z=new A(v);x.servicesToDestroy.push(z);if(y){y.call((r!=null?r:x),z,s)}})},_processedServices:null,_processedServiceCountdown:null,_registerProcessedService:function e(r,s){this._processedServiceCountdown--;if(s==null||isNaN(s)){this._processedServices.push(r)}else{this._processedServices[s]=r}if(this._processedServiceCountdown===0){this.allServicesProcessed(this._processedServices);this.serviceProcessingComplete=true}},serviceProcessingComplete:false,allServicesProcessed:function n(r){this.alfLog("log","All services processed");if(this.widgets){this.processWidgets(this.widgets,this.containerNode)}},allWidgetsProcessed:function c(r){this.alfLog("log","All page widgets processed");if(this.publishOnReady!=null){k.forEach(this.publishOnReady,a.hitch(this,"onReadyPublish"))}g.getSingleton().release();this.alfPublish("ALF_WIDGETS_READY",{});p.add(this.domNode,"allWidgetsProcessed");p.add(j.body(),"aikau-reveal")}})});