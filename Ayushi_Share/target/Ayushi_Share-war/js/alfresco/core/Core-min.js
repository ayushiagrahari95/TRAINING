define(["dojo/_base/declare","alfresco/core/CoreData","alfresco/core/PubSubLog","service/constants/Default","dojo/topic","alfresco/core/PubQueue","dojo/_base/array","dojo/_base/lang","dojox/uuid/generateRandomUuid","dojox/html/entities"],function(v,g,k,h,c,t,f,y,r,e){return v(null,{cssRequirements:[{cssFile:"./css/Core.css"}],excludeFromPubSubLog:true,generateUuid:function l(){return r()},message:function s(z){var B;if(typeof z!="string"){throw new Error("Missing or invalid argument: messageId")}var E=z;if(typeof Alfresco.messages.global==="object"){var C=Alfresco.messages.global[z];if(typeof C=="string"){E=C}}if(typeof Alfresco.messages.pageScope==="object"){var A=Alfresco.messages.pageScope[z];if(typeof A=="string"){E=A}}if(typeof Alfresco.messages.scope[Alfresco.messages.defaultScope]==="object"){B=Alfresco.messages.scope[Alfresco.messages.defaultScope][z];if(typeof B=="string"){E=B}}if(this.constructor&&this.constructor._meta){f.forEach(this.constructor._meta.parents,function(G){if(G._meta&&G._meta.hidden&&G._meta.hidden.i18nScope&&Alfresco.messages.scope[G._meta.hidden.i18nScope]){var F=Alfresco.messages.scope[G._meta.hidden.i18nScope][z];if(typeof F=="string"){E=F}}})}if(typeof this.i18nScope!="undefined"&&typeof Alfresco.messages.scope[this.i18nScope]==="object"){B=Alfresco.messages.scope[this.i18nScope][z];if(typeof B=="string"){E=B}}var D=[];if((arguments.length==2)&&(typeof arguments[1]=="object")){D=arguments[1]}else{D=Array.prototype.slice.call(arguments).slice(1)}if(D instanceof Array&&D.length>0){E=E.replace(/''/g,"'")}E=y.replace(E,D);return E},encodeHTML:function a(z){return e.encode(z)},dataScope:null,dataBindingCallbacks:null,alfProcessDataDotNotation:function q(z){var A=/(\.|\[)/g;return z.replace(A,"._alfValue$1")},alfSetData:function o(z,F,B){this.alfLog("log","Setting data",z,F,B,this);var C={};if(this.dataScope==null){this.dataScope=g.getSingleton().root}if(B==null){B=this.dataScope}z=this.alfProcessDataDotNotation(z);var E=y.getObject(z,false,B);if(E==null){}E=y.getObject(z,true,B);var A=E._alfValue;y.setObject(z+"._alfValue",F,B);if(E._alfCallbacks!=null){for(var D in E._alfCallbacks){if(typeof E._alfCallbacks[D]==="function"){E._alfCallbacks[D](z,A,F)}}}return C},alfGetData:function w(z,A){if(this.dataScope==null){this.dataScope=g.getSingleton().root}if(A==null){A=this.dataScope}z=this.alfProcessDataDotNotation(z);var B=y.getObject(z+"._alfValue",false,A);this.alfLog("log","Getting data",z,A,B,this);return B},alfBindDataListener:function u(z,A,E){if(z){this.alfLog("log","Binding data listener",z,A,E,this);if(this.dataScope==null){this.dataScope=g.getSingleton().root}if(A==null){A=this.dataScope}z=this.alfProcessDataDotNotation(z);var B=y.getObject(z+"._alfCallbacks",true,A);var C=this.generateUuid();B[C]=E;var D={scope:this.dataScope,dotNotation:z,callbackId:C};if(this.dataBindingCallbacks==null){this.dataBindingCallbacks=[]}this.dataBindingCallbacks.push(D);return D}},alfRemoveDataListener:function x(B){this.alfLog("log","Removing data binding",B);try{var z=y.getObject(B.dotNotation,false,B.scope);if(z!=null){delete z._alfCallbacks[B.callbackId]}}catch(A){this.alfLog("error","Could not delete data listener binding",B)}},pubSubScope:"",alfSubscriptions:null,alfPublish:function b(C,B,A,z){if(!y.isArray(C)){C=[C]}f.forEach(C,function(E){var D=E;if(A!=null&&A===true){}else{if(z!=null&&z===true){D=this.parentPubSubScope+E}else{D=this.pubSubScope+E}}if(B==null){B={}}B.alfTopic=D;t.getSingleton().publish(D,B,this)},this)},alfPublishDelayed:function j(A,B,z){this._delayedPublishPayload=B;window.setTimeout(y.hitch(this,function(){this.alfPublish(A,this._delayedPublishPayload)}),z)},alfSubscribe:function p(A,E,C,B){var z=A;if(C!=null&&C===true){}else{if(B!=null&&B===true){z=this.parentPubSubScope+A}else{z=this.pubSubScope+A}}if(h.DEBUG){k.getSingleton().sub(z,E,this)}var D=c.subscribe(z,E);if(this.alfSubscriptions==null){this.alfSubscriptions=[]}this.alfSubscriptions.push(D);return D},alfUnsubscribe:function i(z){if(!z){this.alfLog("warn","No subscription handles to unsubscribe from")}else{if(!y.isArray(z)){z=[z]}f.forEach(z,function(A){if(h.DEBUG===true){k.getSingleton().unsub(A,this)}A.remove()},this)}},alfUnsubscribeSaveHandles:function m(z){f.forEach(z,function(A){if(A!=null){this.alfUnsubscribe(A)}else{this.alfLog("warn","A subscription handle was not found - this could be a potential memory leak",this)}},this)},destroy:function d(z){if(this.alfSubscriptions!=null){f.forEach(this.alfSubscriptions,function(A){if(typeof A.remove==="function"){A.remove()}})}if(this.dataBindingCallbacks!=null){f.forEach(this.dataBindingCallbacks,function(A){this.alfRemoveDataListener(A)},this)}if(this.servicesToDestroy!=null){f.forEach(this.servicesToDestroy,function(A){if(A!=null&&typeof A.destroy==="function"){A.destroy()}},this)}if(this.widgetsToDestroy!=null){f.forEach(this.widgetsToDestroy,function(A){if(A!=null&&typeof A.destroy==="function"){A.destroy()}},this)}if(typeof this.inherited==="function"){this.inherited(arguments)}},servicesToDestroy:null,widgetsToDestroy:null,alfLoggingTopic:"ALF_LOG_REQUEST",alfLog:function n(z,A){this.alfPublish(this.alfLoggingTopic,{callerName:arguments.callee.caller.name,severity:z,messageArgs:Array.prototype.slice.call(arguments,1)},true)}})});