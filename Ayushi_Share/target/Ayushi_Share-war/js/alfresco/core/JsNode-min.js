define(["dojo/_base/declare","dojo/json","dojo/_base/lang","alfresco/core/NodeUtils","alfresco/core/ObjectTypeUtils"],function(h,i,b,l,o){var g=h(null,{constants:{PROP_NAME:"cm:name",PROP_TITLE:"cm:title",PROP_DESCRIPTION:"cm:description",PROP_CREATED:"cm:created",PROP_CREATOR:"cm:creator",PROP_MODIFIER:"cm:modifier",PROP_MODIFIED:"cm:modified",PROP_CATEGORIES:"cm:categories",PROP_TAGGABLE:"cm:taggable"},constructor:function j(r){if(o.isString(r)){try{this.nodeJson=r;this.node=i.parse(r)}catch(s){}}else{if(o.isObject(r)){this.node={};b.mixin(this.node,r);this.nodeJson=i.stringify(this.node)}}if(this.node!=null){this.nodeRef=l.processNodeRef(this.node.nodeRef);this.properties=this.node.properties||{};this.aspects=this.node.aspects||[];this.permissions=this.node.permissions||{};this.aspectsObj=null;this.tagsArray=null;this.tagsObj=null;this.categoriesArray=null;this.categoriesObj=null;this.isContainer=this.node.isContainer;this.isLink=this.node.isLink;this.isLocked=this.node.isLocked;this.type=this.node.type;this.contentURL=this.node.contentURL;this.mimetype=this.node.mimetype;this.size=this.node.size;for(var q in this.properties){if(this.properties.hasOwnProperty(q)){if(q.indexOf("cm:")===0){this.properties[q.substring(3)]=this.properties[q]}this.properties[q.replace(/:/g,"_")]=this.properties[q]}}}},getTags:function k(){if(this.tagsArray===null){this.tagsArray=[];var s=this.properties[this.constants.PROP_TAGGABLE]||[];for(var q=0,r=s.length;q<r;q++){this.tagsArray.push(s[q].name)}}return this.tagsArray},getCategories:function d(){if(this.categoriesArray===null){this.categoriesArray=[];var q=this.properties[this.constants.PROP_CATEGORIES]||[];for(var r=0,s=q.length;r<s;r++){this.categoriesArray.push([q[r].name,q[r].path])}}return this.categoriesArray},getNode:function p(){return this.node},toJson:function a(){return this.nodeJson},setNodeRef:function n(q){this.nodeRef=new l.processNodeRef(q)},hasProperty:function e(q){return this.properties.hasOwnProperty(q)},hasAspect:function c(q){if(this.aspectsObj===null){this.aspectsObj=Alfresco.util.arrayToObject(this.aspects)}return this.aspectsObj.hasOwnProperty(q)},hasPermission:function m(q){return this.permissions.user[q]},hasTag:function f(q){if(this.tagsObj===null){this.tagsObj=Alfresco.util.arrayToObject(this.tags)}return this.tagsObj.hasOwnProperty(q)}});return h(null,{constructor:function j(q){var r=new g(q);if(r.node!=null&&r.node.linkedNode!=null){r.linkedNode=new g(r.linkedNode)}b.mixin(this,r)}})});