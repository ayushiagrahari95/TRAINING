(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../../mode/sql/sql"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../../mode/sql/sql"],a)}else{a(CodeMirror)}}})(function(c){var j;var d;var l={QUERY_DIV:";",ALIAS_KEYWORD:"AS"};var h=c.Pos;function k(n){var o=n.doc.modeOption;if(o==="sql"){o="text/x-sql"}return c.resolveMode(o).keywords}function e(o,q){var n=o.length;var p=q.substr(0,n);return o.toUpperCase()===p.toUpperCase()}function b(n,p,q,o){for(var r in q){if(!q.hasOwnProperty(r)){continue}if(Array.isArray(q)){r=q[r]}if(e(p,r)){n.push(o(r))}}}function f(w,r){var u=r.getCursor();var p=r.getTokenAt(u);var s=(p.string.charAt(0)=="`");var q=p.string.substr(1);var n=r.getTokenAt(h(u.line,p.start));if(p.string.charAt(0)=="."||n.string=="."){if(n.string=="."){var n=r.getTokenAt(h(u.line,p.start-1))}var v=n.string;var t=false;if(v.match(/`/g)){t=true;v=v.replace(/`/g,"")}if(!j.hasOwnProperty(v)){v=m(v,r)}var o=j[v];if(!o){return}if(s){b(w,q,o,function(x){return"`"+x+"`"})}else{if(t){b(w,q,o,function(x){return".`"+x+"`"})}else{b(w,q,o,function(x){return"."+x})}}}else{while(p.start&&q.charAt(0)=="."){p=r.getTokenAt(h(u.line,p.start-1));q=p.string+q}if(s){b(w,q,j,function(x){return"`"+x+"`"})}else{b(w,q,j,function(x){return x})}}}function a(o,q){if(!o){return}var n=/[,;]/g;var r=o.split(" ");for(var p=0;p<r.length;p++){q(r[p]?r[p].replace(n,""):"")}}function g(n){return n.line+n.ch/Math.pow(10,6)}function i(n){return h(Math.floor(n),+n.toString().split(".").pop())}function m(s,t){var B=t.doc;var o=B.getValue();var n=s.toUpperCase();var u="";var C="";var r=[];var A={start:h(0,0),end:h(t.lastLine(),t.getLineHandle(t.lastLine()).length)};var q=o.indexOf(l.QUERY_DIV);while(q!=-1){r.push(B.posFromIndex(q));q=o.indexOf(l.QUERY_DIV,q+1)}r.unshift(h(0,0));r.push(h(t.lastLine(),t.getLineHandle(t.lastLine()).text.length));var y=0;var v=g(t.getCursor());for(var p=0;p<r.length;p++){var z=g(r[p]);if(v>y&&v<=z){A={start:i(y),end:i(z)};break}y=z}var w=B.getRange(A.start,A.end,false);for(var p=0;p<w.length;p++){var x=w[p];a(x,function(E){var D=E.toUpperCase();if(D===n&&j.hasOwnProperty(u)){C=u}if(D!==l.ALIAS_KEYWORD){u=E}});if(C){break}}return C}c.registerHelper("hint","sql",function(s,p){j=(p&&p.tables)||{};d=d||k(s);var t=s.getCursor();var n=[];var r=s.getTokenAt(t),u,o,q;if(r.string.match(/^[.`\w@]\w*$/)){q=r.string;u=r.start;o=r.end}else{u=o=t.ch;q=""}if(q.charAt(0)=="."||q.charAt(0)=="`"){f(n,s)}else{b(n,q,j,function(v){return v});b(n,q,d,function(v){return v.toUpperCase()})}return{list:n,from:h(t.line,u),to:h(t.line,o)}})});