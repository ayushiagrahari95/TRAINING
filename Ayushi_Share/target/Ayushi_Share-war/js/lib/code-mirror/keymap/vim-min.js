(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a)}else{a(CodeMirror)}}})(function(b){var a=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"xi",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"dcc",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"swapcase"},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},operatorMotionArgs:{visualLine:true}},{keys:"~",type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:true},motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"}},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"}},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"}},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"}},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true}},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false}},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo"},{keys:"u",type:"action",action:"changeCase",actionArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"action",action:"changeCase",actionArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var c=b.Pos;var g=[16,17,18,91];var d={Enter:"CR",Backspace:"BS",Delete:"Del"};var f=/Mac/.test(navigator.platform);var e=function(){b.defineOption("vimMode",false,function(bg,bk){function bi(bp){var bo=bp.keyCode;if(g.indexOf(bo)!=-1){return}var bn=bp.ctrlKey||bp.shiftKey||bp.metaKey||bp.ctrlKey;var bm=b.keyNames[bo];bm=d[bm]||bm;var bl="";if(bp.ctrlKey){bl+="C-"}if(bp.altKey){bl+="A-"}if(f&&bp.metaKey||(!bn||bp.shiftKey)&&bm.length<2){return}else{if(bp.shiftKey){bl+="S-"}}if(bm.length==1){bm=bm.toLowerCase()}bl+=bm;if(bl.length>1){bl="<"+bl+">"}return bl}function bh(bl,bn){var bm=bi(bn);if(!bm){return}b.signal(bl,"vim-keypress",bm);if(b.Vim.handleKey(bl,bm,"user")){b.e_stop(bn)}}function bj(bl,bo){var bn=bo.charCode||bo.keyCode;if(bo.ctrlKey||bo.metaKey||bo.altKey){return}var bm=String.fromCharCode(bn);b.signal(bl,"vim-keypress",bm);if(b.Vim.handleKey(bl,bm,"user")){b.e_stop(bo)}}if(bk){bg.setOption("keyMap","vim");bg.setOption("disableInput",true);bg.setOption("showCursorWhenSelecting",false);b.signal(bg,"vim-mode-change",{mode:"normal"});bg.on("cursorActivity",U);D(bg);b.on(bg.getInputField(),"paste",P(bg));bg.on("keypress",bj);bg.on("keydown",bh)}else{if(bg.state.vim){bg.setOption("keyMap","default");bg.setOption("disableInput",false);bg.off("cursorActivity",U);b.off(bg.getInputField(),"paste",P(bg));bg.state.vim=null;bg.off("keypress",bj);bg.off("keydown",bh)}}});function P(bg){var bh=bg.state.vim;if(!bh.onPasteFn){bh.onPasteFn=function(){if(!bh.insertMode){bg.setCursor(A(bg.getCursor(),0,1));q.enterInsertMode(bg,{},bh)}}}return bh.onPasteFn}var aK=/[\d]/;var aj=[(/\w/),(/[^\w\s]/)],a5=[(/\S/)];function ai(bj,bh){var bi=[];for(var bg=bj;bg<bj+bh;bg++){bi.push(String.fromCharCode(bg))}return bi}var aa=ai(65,26);var af=ai(97,26);var Q=ai(48,10);var au=[].concat(aa,af,Q,["<",">"]);var m=[].concat(aa,af,Q,["-",'"',".",":","/"]);function h(bg,bh){return bh>=bg.firstLine()&&bh<=bg.lastLine()}function B(bg){return(/^[a-z]$/).test(bg)}function I(bg){return"()[]{}".indexOf(bg)!=-1}function Z(bg){return aK.test(bg)}function x(bg){return(/^[A-Z]$/).test(bg)}function N(bg){return(/^\s*$/).test(bg)}function G(bi,bg){for(var bh=0;bh<bg.length;bh++){if(bg[bh]==bi){return true}}return false}var al={};function az(bh,bg,bi){if(bg===undefined){throw Error("defaultValue is required")}if(!bi){bi="string"}al[bh]={type:bi,defaultValue:bg};ax(bh,bg)}function ax(bg,bi){var bh=al[bg];if(!bh){throw Error("Unknown option: "+bg)}if(bh.type=="boolean"){if(bi&&bi!==true){throw Error("Invalid argument: "+bg+"="+bi)}else{if(bi!==false){bi=true}}}bh.value=bh.type=="boolean"?!!bi:bi}function p(bg){var bh=al[bg];if(!bh){throw Error("Unknown option: "+bg)}return bh.value}var ah=function(){var bk=100;var bm=-1;var bj=0;var bi=0;var bh=new Array(bk);function bl(bn,bp,bq){var br=bm%bk;var bs=bh[br];function bo(bv){var bu=++bm%bk;var bw=bh[bu];if(bw){bw.clear()}bh[bu]=bn.setBookmark(bv)}if(bs){var bt=bs.find();if(bt&&!be(bt,bp)){bo(bp)}}else{bo(bp)}bo(bq);bj=bm;bi=bm-bk+1;if(bi<0){bi=0}}function bg(bn,br){bm+=br;if(bm>bj){bm=bj}else{if(bm<bi){bm=bi}}var bs=bh[(bk+bm)%bk];if(bs&&!bs.find()){var bq=br>0?1:-1;var bp;var bo=bn.getCursor();do{bm+=bq;bs=bh[(bk+bm)%bk];if(bs&&(bp=bs.find())&&!be(bo,bp)){break}}while(bm<bj&&bm>bi)}return bs}return{cachedCursor:undefined,add:bl,move:bg}};var j=function(bg){if(bg){return{changes:bg.changes,expectCursorActivityForChange:bg.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function an(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=j()}an.prototype={exitMacroRecordMode:function(){var bg=r.macroModeState;if(bg.onRecordingDone){bg.onRecordingDone()}bg.onRecordingDone=undefined;bg.isRecording=false},enterMacroRecordMode:function(bg,bi){var bh=r.registerController.getRegister(bi);if(bh){bh.clear();this.latestRegister=bi;if(bg.openDialog){this.onRecordingDone=bg.openDialog("(recording)["+bi+"]",null,{bottom:true})}this.isRecording=true}}};function D(bg){if(!bg.state.vim){bg.state.vim={inputState:new ap(),lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,awaitingEscapeSecondCharacter:false}}return bg.state.vim}var r;function w(){r={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:ah(),macroModeState:new an,lastChararacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new ab({}),searchHistoryController:new aP({}),exCommandHistoryController:new aP({})};for(var bg in al){var bh=al[bg];bh.value=bh.defaultValue}}var bb;var aD={buildKeyMap:function(){},getRegisterController:function(){return r.registerController},resetVimGlobalState_:w,getVimGlobalState_:function(){return r},maybeInitVimState_:D,InsertModeKey:a2,map:function(bh,bi,bg){n.map(bh,bi,bg)},setOption:ax,getOption:p,defineOption:az,defineEx:function(bg,bi,bh){if(bg.indexOf(bi)!==0){throw new Error('(Vim.defineEx) "'+bi+'" is not a prefix of "'+bg+'", command not registered')}aQ[bg]=bh;n.commandMap_[bi]={name:bg,shortName:bi,type:"api"}},handleKey:function(bm,bn,bl){var bi=D(bm);function bo(){var bq=r.macroModeState;if(bq.isRecording){if(bn=="q"){bq.exitMacroRecordMode();k(bm);return true}if(bl!="mapping"){F(bq,bn)}}}function bp(){if(bn=="<Esc>"){k(bm);if(bi.visualMode){aG(bm)}else{if(bi.insertMode){t(bm)}}return true}}function bk(){if(!bi.visualMode&&!bi.insertMode&&!be(bm.getCursor("head"),bm.getCursor("anchor"))){bi.visualMode=true;bi.visualLine=false;b.signal(bm,"vim-mode-change",{mode:"visual"});bm.on("mousedown",aG)}}function bg(br){var bq;while(br){bq=(/<\w+-.+?>|<\w+>|./).exec(br);bn=bq[0];br=br.substring(bq.index+bn.length);b.Vim.handleKey(bm,bn,"mapping")}}function bj(){if(bp()){return true}var bs=bi.inputState.keyBuffer=bi.inputState.keyBuffer+bn;var bt=bn.length==1;var bq=aV.matchCommand(bs,a,bi.inputState,"insert");while(bs.length>1&&bq.type!="full"){var bs=bi.inputState.keyBuffer=bs.slice(1);var bu=aV.matchCommand(bs,a,bi.inputState,"insert");if(bu.type!="none"){bq=bu}}if(bq.type=="none"){k(bm);return false}else{if(bq.type=="partial"){if(bb){window.clearTimeout(bb)}bb=window.setTimeout(function(){if(bi.insertMode&&bi.inputState.keyBuffer){k(bm)}},p("insertModeEscKeysTimeout"));return !bt}}if(bb){window.clearTimeout(bb)}if(bt){var br=bm.getCursor();bm.replaceRange("",A(br,0,-(bs.length-1)),br,"+input")}k(bm);var bv=bq.command;if(bv.type=="keyToKey"){bg(bv.toKeys)}else{aV.processCommand(bm,bi,bv)}return !bt}function bh(){if(bo()||bp()){return true}bk();var bs=bi.inputState.keyBuffer=bi.inputState.keyBuffer+bn;if(/^[1-9]\d*$/.test(bs)){return true}var bu=/^(\d*)(.*)$/.exec(bs);var br=bi.visualMode?"visual":"normal";var bq=aV.matchCommand(bu[2]||bu[1],a,bi.inputState,br);if(bq.type=="none"){k(bm);return false}else{if(bq.type=="partial"){return true}}bi.inputState.keyBuffer="";var bt=bq.command;var bu=/^(\d*)(.*)$/.exec(bs);if(bu[1]&&bu[1]!="0"){bi.inputState.pushRepeatDigit(bu[1])}if(bt.type=="keyToKey"){bg(bt.toKeys)}else{aV.processCommand(bm,bi,bt)}return true}if(bi.insertMode){return bj()}else{return bh()}},handleEx:function(bg,bh){n.processCommand(bg,bh)}};function ap(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}ap.prototype.pushRepeatDigit=function(bg){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(bg)}else{this.motionRepeat=this.motionRepeat.concat(bg)}};ap.prototype.getRepeat=function(){var bg=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){bg=1;if(this.prefixRepeat.length>0){bg*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){bg*=parseInt(this.motionRepeat.join(""),10)}}return bg};function k(bg,bh){bg.state.vim.inputState=new ap();b.signal(bg,"vim-command-done",bh)}function a6(bi,bh,bg){this.clear();this.keyBuffer=[bi||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!bh;this.blockwise=!!bg}a6.prototype={setText:function(bi,bh,bg){this.keyBuffer=[bi||""];this.linewise=!!bh;this.blockwise=!!bg},pushText:function(bh,bg){if(bg){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(bh)},pushInsertModeChanges:function(bg){this.insertModeChanges.push(j(bg))},pushSearchQuery:function(bg){this.searchQueries.push(bg)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function ab(bg){this.registers=bg;this.unnamedRegister=bg['"']=new a6();bg["."]=new a6();bg[":"]=new a6();bg["/"]=new a6()}ab.prototype={pushText:function(bk,bh,bm,bl,bi){if(bl&&bm.charAt(0)=="\n"){bm=bm.slice(1)+"\n"}if(bl&&bm.charAt(bm.length-1)!=="\n"){bm+="\n"}var bj=this.isValidRegister(bk)?this.getRegister(bk):null;if(!bj){switch(bh){case"yank":this.registers["0"]=new a6(bm,bl,bi);break;case"delete":case"change":if(bm.indexOf("\n")==-1){this.registers["-"]=new a6(bm,bl)}else{this.shiftNumericRegisters_();this.registers["1"]=new a6(bm,bl)}break}this.unnamedRegister.setText(bm,bl,bi);return}var bg=x(bk);if(bg){bj.pushText(bm,bl)}else{bj.setText(bm,bl,bi)}this.unnamedRegister.setText(bj.toString(),bl)},getRegister:function(bg){if(!this.isValidRegister(bg)){return this.unnamedRegister}bg=bg.toLowerCase();if(!this.registers[bg]){this.registers[bg]=new a6()}return this.registers[bg]},isValidRegister:function(bg){return bg&&G(bg,m)},shiftNumericRegisters_:function(){for(var bg=9;bg>=2;bg--){this.registers[bg]=this.getRegister(""+(bg-1))}}};function aP(){this.historyBuffer=[];this.iterator;this.initialPrefix=null}aP.prototype={nextMatch:function(bh,bg){var bm=this.historyBuffer;var bj=bg?-1:1;if(this.initialPrefix===null){this.initialPrefix=bh}for(var bl=this.iterator+bj;bg?bl>=0:bl<bm.length;bl+=bj){var bk=bm[bl];for(var bi=0;bi<=bk.length;bi++){if(this.initialPrefix==bk.substring(0,bi)){this.iterator=bl;return bk}}}if(bl>=bm.length){this.iterator=bm.length;return this.initialPrefix}if(bl<0){return bh}},pushInput:function(bg){var bh=this.historyBuffer.indexOf(bg);if(bh>-1){this.historyBuffer.splice(bh,1)}if(bg.length){this.historyBuffer.push(bg)}},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var aV={matchCommand:function(bl,bn,bg,bj){var bm=a3(bl,bn,bj,bg);if(!bm.full&&!bm.partial){return{type:"none"}}else{if(!bm.full&&bm.partial){return{type:"partial"}}}var bk;for(var bi=0;bi<bm.full.length;bi++){var bh=bm.full[bi];if(!bk||bh.context==bj){bk=bh}}if(bk.keys.slice(-11)=="<character>"){bg.selectedCharacter=L(bl)}return{type:"full",command:bk}},processCommand:function(bg,bh,bi){bh.inputState.repeatOverride=bi.repeatOverride;switch(bi.type){case"motion":this.processMotion(bg,bh,bi);break;case"operator":this.processOperator(bg,bh,bi);break;case"operatorMotion":this.processOperatorMotion(bg,bh,bi);break;case"action":this.processAction(bg,bh,bi);break;case"search":this.processSearch(bg,bh,bi);break;case"ex":case"keyToEx":this.processEx(bg,bh,bi);break;default:break}},processMotion:function(bg,bh,bi){bh.inputState.motion=bi.motion;bh.inputState.motionArgs=a1(bi.motionArgs);this.evalInput(bg,bh)},processOperator:function(bh,bi,bj){var bg=bi.inputState;if(bg.operator){if(bg.operator==bj.operator){bg.motion="expandToLine";bg.motionArgs={linewise:true};this.evalInput(bh,bi);return}else{k(bh)}}bg.operator=bj.operator;bg.operatorArgs=a1(bj.operatorArgs);if(bi.visualMode){this.evalInput(bh,bi)}},processOperatorMotion:function(bg,bj,bk){var bi=bj.visualMode;var bh=a1(bk.operatorMotionArgs);if(bh){if(bi&&bh.visualLine){bj.visualLine=true}}this.processOperator(bg,bj,bk);if(!bi){this.processMotion(bg,bj,bk)}},processAction:function(bh,bj,bm){var bg=bj.inputState;var bl=bg.getRepeat();var bk=!!bl;var bi=a1(bm.actionArgs)||{};if(bg.selectedCharacter){bi.selectedCharacter=bg.selectedCharacter}if(bm.operator){this.processOperator(bh,bj,bm)}if(bm.motion){this.processMotion(bh,bj,bm)}if(bm.motion||bm.operator){this.evalInput(bh,bj)}bi.repeat=bl||1;bi.repeatIsExplicit=bk;bi.registerName=bg.registerName;k(bh);bj.lastMotion=null;if(bm.isEdit){this.recordLastEdit(bj,bg,bm)}q[bm.action](bh,bi,bj)},processSearch:function(bv,bo,bn){if(!bv.getSearchCursor){return}var bq=bn.searchArgs.forward;var bl=bn.searchArgs.wholeWordOnly;aw(bv).setReversed(!bq);var br=(bq)?"/":"?";var bt=aw(bv).getQuery();var bi=bv.getScrollInfo();function bm(by,bw,bx){r.searchHistoryController.pushInput(by);r.searchHistoryController.reset();try{bd(bv,by,bw,bx)}catch(bz){a4(bv,"Invalid regex: "+by);return}aV.processMotion(bv,bo,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:bn.searchArgs.toJumplist}})}function bu(bw){bv.scrollTo(bi.left,bi.top);bm(bw,true,true);var bx=r.macroModeState;if(bx.isRecording){J(bx,bw)}}function bk(bA,bz,bB){var by=b.keyName(bA),bw;if(by=="Up"||by=="Down"){bw=by=="Up"?true:false;bz=r.searchHistoryController.nextMatch(bz,bw)||"";bB(bz)}else{if(by!="Left"&&by!="Right"&&by!="Ctrl"&&by!="Alt"&&by!="Shift"){r.searchHistoryController.reset()}}var bx;try{bx=bd(bv,bz,true,true)}catch(bA){}if(bx){bv.scrollIntoView(bf(bv,!bq,bx),30)}else{aA(bv);bv.scrollTo(bi.left,bi.top)}}function bh(by,bx,bz){var bw=b.keyName(by);if(bw=="Esc"||bw=="Ctrl-C"||bw=="Ctrl-["){r.searchHistoryController.pushInput(bx);r.searchHistoryController.reset();bd(bv,bt);aA(bv);bv.scrollTo(bi.left,bi.top);b.e_stop(by);bz();bv.focus()}}switch(bn.searchArgs.querySrc){case"prompt":var bp=r.macroModeState;if(bp.isPlaying){var bs=bp.replaySearchQueries.shift();bm(bs,true,false)}else{aN(bv,{onClose:bu,prefix:br,desc:K,onKeyUp:bk,onKeyDown:bh})}break;case"wordUnderCursor":var bj=at(bv,false,true,false,true);var bg=true;if(!bj){bj=at(bv,false,true,false,false);bg=false}if(!bj){return}var bs=bv.getLine(bj.start.line).substring(bj.start.ch,bj.end.ch);if(bg&&bl){bs="\\b"+bs+"\\b"}else{bs=i(bs)}r.jumpList.cachedCursor=bv.getCursor();bv.setCursor(bj.start);bm(bs,true,false);break}},processEx:function(bg,bh,bk){function bj(bl){r.exCommandHistoryController.pushInput(bl);r.exCommandHistoryController.reset();n.processCommand(bg,bl)}function bi(bo,bm,bp){var bn=b.keyName(bo),bl;if(bn=="Esc"||bn=="Ctrl-C"||bn=="Ctrl-["){r.exCommandHistoryController.pushInput(bm);r.exCommandHistoryController.reset();b.e_stop(bo);bp();bg.focus()}if(bn=="Up"||bn=="Down"){bl=bn=="Up"?true:false;bm=r.exCommandHistoryController.nextMatch(bm,bl)||"";bp(bm)}else{if(bn!="Left"&&bn!="Right"&&bn!="Ctrl"&&bn!="Alt"&&bn!="Shift"){r.exCommandHistoryController.reset()}}}if(bk.type=="keyToEx"){n.processCommand(bg,bk.exArgs.input)}else{if(bh.visualMode){aN(bg,{onClose:bj,prefix:":",value:"'<,'>",onKeyDown:bi})}else{aN(bg,{onClose:bj,prefix:":",onKeyDown:bi})}}},evalInput:function(bp,bG){var bv=bG.inputState;var bD=bv.motion;var bw=bv.motionArgs||{};var bq=bv.operator;var bM=bv.operatorArgs||{};var bx=bv.registerName;var bh=z(bp.getCursor("head"));var bE=z(bp.getCursor("anchor"));var bn=z(bh);var bu=z(bn);var bH;var br;if(bq){this.recordLastEdit(bG,bv)}if(bv.repeatOverride!==undefined){br=bv.repeatOverride}else{br=bv.getRepeat()}if(br>0&&bw.explicitRepeat){bw.repeatIsExplicit=true}else{if(bw.noRepeat||(!bw.explicitRepeat&&br===0)){br=1;bw.repeatIsExplicit=false}}if(bv.selectedCharacter){bw.selectedCharacter=bM.selectedCharacter=bv.selectedCharacter}bw.repeat=br;k(bp);if(bD){var bF=aO[bD](bp,bw,bG);bG.lastMotion=aO[bD];if(!bF){return}if(bw.toJumplist){var bL=r.jumpList;var bs=bL.cachedCursor;if(bs){aZ(bp,bs,bF);delete bL.cachedCursor}else{aZ(bp,bu,bF)}}if(bF instanceof Array){bn=bF[0];bH=bF[1]}else{bH=bF}if(!bH){bH=c(bn.line,bn.ch)}if(bG.visualMode){var bl=0;if(aC(bE,bh)&&(be(bE,bH)||aC(bH,bE))){bE.ch+=1;bl=-1}else{if(aC(bh,bE)&&(be(bE,bH)||aC(bE,bH))){bE.ch-=1;bl=1}}if(!bG.visualBlock&&!(bF instanceof Array)){bH.ch+=bl}if(bG.lastHPos!=Infinity){bG.lastHPos=bH.ch}bh=bH;bE=(bF instanceof Array)?bn:bE;if(bG.visualLine){if(aC(bE,bh)){bE.ch=0;var bg=bp.lastLine();if(bh.line>bg){bh.line=bg}bh.ch=aI(bp,bh.line)}else{bh.ch=0;bE.ch=aI(bp,bE.line)}}else{if(bG.visualBlock){bE=C(bp,bh)}}if(!bG.visualBlock){bp.setSelection(bE,bh)}aF(bp,bG,"<",aC(bE,bh)?bE:bh);aF(bp,bG,">",aC(bE,bh)?bh:bE)}else{if(!bq){bH=T(bp,bH);bp.setCursor(bH.line,bH.ch)}}}if(bq){var bA=false;bG.lastMotion=null;var bt=bG.lastSelection;bM.repeat=br;if(bG.visualMode){bn=bE;bH=bh;bw.inclusive=true;bM.shouldMoveCursor=false}if(bH&&aC(bH,bn)){var bK=bn;bn=bH;bH=bK;bA=true}else{if(!bH){bH=z(bn)}}if(bw.inclusive&&!bG.visualMode){bH.ch++}if(bM.selOffset){bH.line=bn.line+bM.selOffset.line;if(bM.selOffset.line){bH.ch=bM.selOffset.ch}else{bH.ch=bn.ch+bM.selOffset.ch}if(bt&&bt.visualBlock){var bo=bt.visualBlock;var bC=bo.width;var bB=bo.height;bH=c(bn.line+bB,bn.ch+bC);var bi=[];for(var bI=bn.line;bI<bH.line;bI++){var bm=c(bI,bn.ch);var bj=c(bI,bH.ch);var bz={anchor:bm,head:bj};bi.push(bz)}bp.setSelections(bi);var bJ=true}}else{if(bG.visualMode){var by=c();by.line=bH.line-bn.line;if(by.line){by.ch=bH.ch}else{by.ch=bH.ch-bn.ch}bM.selOffset=by}}var bk=bw.linewise||(bG.visualMode&&bG.visualLine)||bM.linewise;if(bk){aX(bp,bn,bH)}else{if(bw.forward){ae(bp,bn,bH)}}bM.registerName=bx;bM.linewise=bk;if(!bG.visualBlock&&!bJ){bp.setSelection(bn,bH)}H[bq](bp,bM,bG,bn,bH,bu);if(bG.visualMode){aG(bp)}}},recordLastEdit:function(bh,bg,bi){var bj=r.macroModeState;if(bj.isPlaying){return}bh.lastEditInputState=bg;bh.lastEditActionCommand=bi;bj.lastInsertModeChanges.changes=[];bj.lastInsertModeChanges.expectCursorActivityForChange=false}};var aO={moveToTopLine:function(bg,bi){var bh=aW(bg).top+bi.repeat-1;return c(bh,aM(bg.getLine(bh)))},moveToMiddleLine:function(bg){var bi=aW(bg);var bh=Math.floor((bi.top+bi.bottom)*0.5);return c(bh,aM(bg.getLine(bh)))},moveToBottomLine:function(bg,bi){var bh=aW(bg).bottom-bi.repeat+1;return c(bh,aM(bg.getLine(bh)))},expandToLine:function(bg,bh){var bi=bg.getCursor();return c(bi.line+bh.repeat-1,Infinity)},findNext:function(bg,bh){var bk=aw(bg);var bj=bk.getQuery();if(!bj){return}var bi=!bh.forward;bi=(bk.isReversed())?!bi:bi;ay(bg,bj);return bf(bg,bi,bj,bh.repeat)},goToMark:function(bg,bi,bh){var bk=bh.marks[bi.selectedCharacter];if(bk){var bj=bk.find();return bi.linewise?{line:bj.line,ch:aM(bg.getLine(bj.line))}:bj}return null},moveToOtherHighlightedEnd:function(bh,bk,bj){var bi=bh.listSelections();var bm=bh.getCursor("head");var bg=bi[0].anchor;var bl=be(bi[0].head,bm)?bi.length-1:0;if(bk.sameLine&&bj.visualBlock){bg=c(bm.line,bi[bl].anchor.ch);bm=c(bi[bl].head.line,bm.ch)}else{bg=bi[bl].anchor}bh.setCursor(bm);return([bm,bg])},jumpToMark:function(bn,bj,bk){var bi=bn.getCursor();for(var bl=0;bl<bj.repeat;bl++){var bp=bi;for(var bo in bk.marks){if(!B(bo)){continue}var bh=bk.marks[bo].find();var bg=(bj.forward)?aC(bh,bp):aC(bp,bh);if(bg){continue}if(bj.linewise&&(bh.line==bp.line)){continue}var bm=be(bp,bi);var bq=(bj.forward)?aH(bp,bh,bi):aH(bi,bh,bp);if(bm||bq){bi=bh}}}if(bj.linewise){bi=c(bi.line,aM(bn.getLine(bi.line)))}return bi},moveByCharacters:function(bg,bh){var bk=bg.getCursor();var bj=bh.repeat;var bi=bh.forward?bk.ch+bj:bk.ch-bj;return c(bk.line,bi)},moveByLines:function(bl,bh,bi){var bn=bl.getCursor();var bj=bn.ch;switch(bi.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:bj=bi.lastHPos;break;default:bi.lastHPos=bj}var bg=bh.repeat+(bh.repeatOffset||0);var bo=bh.forward?bn.line+bg:bn.line-bg;var bk=bl.firstLine();var bm=bl.lastLine();if((bo<bk&&bn.line==bk)||(bo>bm&&bn.line==bm)){return}if(bh.toFirstChar){bj=aM(bl.getLine(bo));bi.lastHPos=bj}bi.lastHSPos=bl.charCoords(c(bo,bj),"div").left;return c(bo,bj)},moveByDisplayLines:function(bn,bi,bj){var bo=bn.getCursor();switch(bj.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:bj.lastHSPos=bn.charCoords(bo,"div").left}var bg=bi.repeat;var bm=bn.findPosV(bo,(bi.forward?bg:-bg),"line",bj.lastHSPos);if(bm.hitSide){if(bi.forward){var bh=bn.charCoords(bm,"div");var bk={top:bh.top+8,left:bj.lastHSPos};var bm=bn.coordsChar(bk,"div")}else{var bl=bn.charCoords(c(bn.firstLine(),0),"div");bl.left=bj.lastHSPos;bm=bn.coordsChar(bl,"div")}}bj.lastHPos=bm.ch;return bm},moveByPage:function(bh,bi){var bg=bh.getCursor();var bj=bi.repeat;return bh.findPosV(bg,(bi.forward?bj:-bj),"page")},moveByParagraph:function(bg,bi){var bh=bg.getCursor().line;var bk=bi.repeat;var bl=bi.forward?1:-1;for(var bj=0;bj<bk;bj++){if((!bi.forward&&bh===bg.firstLine())||(bi.forward&&bh==bg.lastLine())){break}bh+=bl;while(bh!==bg.firstLine()&&bh!=bg.lastLine()&&bg.getLine(bh)){bh+=bl}}return c(bh,0)},moveByScroll:function(bg,bj,bh){var bn=bg.getScrollInfo();var bl=null;var bk=bj.repeat;if(!bk){bk=bn.clientHeight/(2*bg.defaultTextHeight())}var bm=bg.charCoords(bg.getCursor(),"local");bj.repeat=bk;var bl=aO.moveByDisplayLines(bg,bj,bh);if(!bl){return null}var bi=bg.charCoords(bl,"local");bg.scrollTo(null,bn.top+bi.top-bm.top);return bl},moveByWords:function(bg,bh){return aq(bg,bh.repeat,!!bh.forward,!!bh.wordEnd,!!bh.bigWord)},moveTillCharacter:function(bh,bi){var bk=bi.repeat;var bj=a8(bh,bk,bi.forward,bi.selectedCharacter);var bg=bi.forward?-1:1;ar(bg,bi);if(!bj){return null}bj.ch+=bg;return bj},moveToCharacter:function(bg,bh){var bi=bh.repeat;ar(0,bh);return a8(bg,bi,bh.forward,bh.selectedCharacter)||bg.getCursor()},moveToSymbol:function(bg,bh){var bi=bh.repeat;return a9(bg,bi,bh.forward,bh.selectedCharacter)||bg.getCursor()},moveToColumn:function(bg,bi,bh){var bj=bi.repeat;bh.lastHPos=bj-1;bh.lastHSPos=bg.charCoords(bg.getCursor(),"div").left;return ac(bg,bj)},moveToEol:function(bg,bk,bj){var bl=bg.getCursor();bj.lastHPos=Infinity;var bi=c(bl.line+bk.repeat-1,Infinity);var bh=bg.clipPos(bi);bh.ch--;bj.lastHSPos=bg.charCoords(bh,"div").left;return bi},moveToFirstNonWhiteSpaceCharacter:function(bg){var bh=bg.getCursor();return c(bh.line,aM(bg.getLine(bh.line)))},moveToMatchedSymbol:function(bh){var bn=bh.getCursor();var bj=bn.line;var bl=bn.ch;var bi=bh.getLine(bj);var bm;do{bm=bi.charAt(bl++);if(bm&&I(bm)){var bk=bh.getTokenTypeAt(c(bj,bl));if(bk!=="string"&&bk!=="comment"){break}}}while(bm);if(bm){var bg=bh.findMatchingBracket(c(bj,bl));return bg.to}else{return bn}},moveToStartOfLine:function(bg){var bh=bg.getCursor();return c(bh.line,0)},moveToLineOrEdgeOfDocument:function(bg,bh){var bi=bh.forward?bg.lastLine():bg.firstLine();if(bh.repeatIsExplicit){bi=bh.repeat-bg.getOption("firstLineNumber")}return c(bi,aM(bg.getLine(bi)))},textObjectManipulation:function(bh,bj){var bi={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var bm={"'":true,'"':true};var bl=bj.selectedCharacter;if(bl=="b"){bl="("}else{if(bl=="B"){bl="{"}}var bg=!bj.textObjectInner;var bk;if(bi[bl]){bk=o(bh,bl,bg)}else{if(bm[bl]){bk=aE(bh,bl,bg)}else{if(bl==="W"){bk=at(bh,bg,true,true)}else{if(bl==="w"){bk=at(bh,bg,true,false)}else{return null}}}}return[bk.start,bk.end]},repeatLastCharacterSearch:function(bi,bk){var bh=r.lastChararacterSearch;var bm=bk.repeat;var bj=bk.forward===bh.forward;var bg=(bh.increment?1:0)*(bj?-1:1);bi.moveH(-bg,"char");bk.inclusive=bj?true:false;var bl=a8(bi,bm,bj,bh.selectedCharacter);if(!bl){bi.moveH(bg,"char");return bi.getCursor()}bl.ch+=bg;return bl}};var H={change:function(bp,bx,bt){var bj=bp.listSelections();var bk=bj[0],bh=bj[bj.length-1];var bo=aC(bk.anchor,bk.head)?bk.anchor:bk.head;var bv=aC(bh.anchor,bh.head)?bh.head:bh.anchor;var bq=bp.getSelection();var bw=bt.visualBlock;if(bt.lastSelection&&!bt.visualMode){bw=bt.lastSelection.visualBlock?true:bw}var bi=r.macroModeState.lastInsertModeChanges;bi.inVisualBlock=bw;var bs=new Array(bj.length).join("1").split("1");var bg=bt.marks[">"]?bt.marks[">"].find():bp.getCursor("head");r.registerController.pushText(bx.registerName,"change",bq,bx.linewise);if(bx.linewise){if(bw){var bu=bo.line;while(bu<=bv.line){var br=aI(bp,bu);var bl=c(bu,br);var bm=c(bu,bo.ch);bu++;bp.replaceRange("",bm,bl)}}else{bs="\n";if(bv.line==bo.line&&bv.line==bp.lastLine()){bs=""}bp.replaceRange(bs,bo,bv);bp.indentLine(bo.line,"smart");bo.ch=null;bp.setCursor(bo)}}else{var bq=bp.getRange(bo,bv);if(!N(bq)){var bn=(/\s+$/).exec(bq);if(bn){bv=A(bv,0,-bn[0].length)}}if(bw){bp.replaceSelections(bs)}else{bp.setCursor(bo);bp.replaceRange("",bo,bv)}}bt.marks[">"]=bp.setBookmark(bg);q.enterInsertMode(bp,{},bp.state.vim)},"delete":function(bs,bl,bn){var bj=bs.listSelections();var bi=bj[0],bm=bj[bj.length-1];var bp=aC(bi.anchor,bi.head)?bi.anchor:bi.head;var bt=aC(bm.anchor,bm.head)?bm.head:bm.anchor;var bv,br;var bq=bn.visualBlock;if(bn.visualMode){bv=bn.marks[">"].find();br=bn.marks["<"].find()}else{if(bn.lastSelection){bv=bn.lastSelection.curStartMark.find();br=bn.lastSelection.curEndMark.find();bq=bn.lastSelection.visualBlock}}var bu=bs.getSelection();r.registerController.pushText(bl.registerName,"delete",bu,bl.linewise,bq);var bk=new Array(bj.length).join("1").split("1");if(bl.linewise&&bt.line==bs.lastLine()&&bp.line==bt.line){if(bt.line==0){bp.ch=0}else{var bo=z(bt);bp.line--;bp.ch=aI(bs,bp.line);bt=bo}bs.replaceRange("",bp,bt)}else{bs.replaceSelections(bk)}if(bv){var bh=bs.setBookmark(br);var bg=bs.setBookmark(bv);if(bn.visualMode){bn.marks["<"]=bh;bn.marks[">"]=bg}else{bn.lastSelection.curStartMark=bh;bn.lastSelection.curEndMark=bg}}if(bl.linewise){bs.setCursor(aO.moveToFirstNonWhiteSpaceCharacter(bs))}else{bs.setCursor(bp)}},indent:function(bn,bi,bk,bm,bo){var bp=bm.line;var bh=bo.line;var bg=(bk.visualMode)?bi.repeat:1;if(bi.linewise){bh--}for(var bl=bp;bl<=bh;bl++){for(var bj=0;bj<bg;bj++){bn.indentLine(bl,bi.indentRight)}}bn.setCursor(bm);bn.setCursor(aO.moveToFirstNonWhiteSpaceCharacter(bn))},swapcase:function(bt,bj,bq,bs,bk,bn){var bh=bt.getSelections();var bg=bt.listSelections();var bi=[];for(var bl=0;bl<bh.length;bl++){var bo=bh[bl];var bv="";for(var bm=0;bm<bo.length;bm++){var bp=bo.charAt(bm);bv+=x(bp)?bp.toLowerCase():bp.toUpperCase()}bi.push(bv)}bt.replaceSelections(bi);var br=bg[0].anchor;var bu=bg[0].head;if(!bj.shouldMoveCursor){bt.setCursor(aC(br,bu)?br:bu)}},yank:function(bh,bl,bk,bj,bg,bi){var bm=bh.getSelection();r.registerController.pushText(bl.registerName,"yank",bm,bl.linewise,bk.visualBlock);bh.setCursor(bi)}};var q={jumpListWalk:function(bg,bi,bj){if(bj.visualMode){return}var bl=bi.repeat;var bk=bi.forward;var bh=r.jumpList;var bn=bh.move(bg,bk?bl:-bl);var bm=bn?bn.find():undefined;bm=bm?bm:bg.getCursor();bg.setCursor(bm)},scroll:function(bo,bi,bk){if(bk.visualMode){return}var bg=bi.repeat||1;var bn=bo.defaultTextHeight();var bm=bo.getScrollInfo().top;var bp=bn*bg;var bl=bi.forward?bm+bp:bm-bp;var bq=z(bo.getCursor());var bj=bo.charCoords(bq,"local");if(bi.forward){if(bl>bj.top){bq.line+=(bl-bj.top)/bn;bq.line=Math.ceil(bq.line);bo.setCursor(bq);bj=bo.charCoords(bq,"local");bo.scrollTo(null,bj.top)}else{bo.scrollTo(null,bl)}}else{var bh=bl+bo.getScrollInfo().clientHeight;if(bh<bj.bottom){bq.line-=(bj.bottom-bh)/bn;bq.line=Math.floor(bq.line);bo.setCursor(bq);bj=bo.charCoords(bq,"local");bo.scrollTo(null,bj.bottom-bo.getScrollInfo().clientHeight)}else{bo.scrollTo(null,bl)}}},scrollToCursor:function(bh,bi){var bl=bh.getCursor().line;var bj=bh.charCoords(c(bl,0),"local");var bg=bh.getScrollInfo().clientHeight;var bm=bj.top;var bk=bj.bottom-bm;switch(bi.position){case"center":bm=bm-(bg/2)+bk;break;case"bottom":bm=bm-bg+bk*1.4;break;case"top":bm=bm+bk*0.4;break}bh.scrollTo(null,bm)},replayMacro:function(bg,bh,bi){var bj=bh.selectedCharacter;var bk=bh.repeat;var bl=r.macroModeState;if(bj=="@"){bj=bl.latestRegister}while(bk--){E(bg,bi,bl,bj)}},enterMacroRecordMode:function(bg,bh){var bj=r.macroModeState;var bi=bh.selectedCharacter;bj.enterMacroRecordMode(bg,bi)},enterInsertMode:function(bg,bh,bi){if(bg.getOption("readOnly")){return}bi.insertMode=true;bi.insertModeRepeat=bh&&bh.repeat||1;var bk=(bh)?bh.insertAt:null;if(bi.visualMode){var bj=aR(bg,bi);var bl=bj[0];var bm=bj[1]}if(bk=="eol"){var bn=bg.getCursor();bn=c(bn.line,aI(bg,bn.line));bg.setCursor(bn)}else{if(bk=="charAfter"){bg.setCursor(A(bg.getCursor(),0,1))}else{if(bk=="firstNonBlank"){if(bi.visualMode&&!bi.visualBlock){if(bm.line<bl.line){bg.setCursor(bm)}else{bl=c(bl.line,0);bg.setCursor(bl)}bg.setCursor(aO.moveToFirstNonWhiteSpaceCharacter(bg))}else{if(bi.visualBlock){bm=c(bm.line,bl.ch);bg.setCursor(bl);C(bg,bm)}else{bg.setCursor(aO.moveToFirstNonWhiteSpaceCharacter(bg))}}}else{if(bk=="endOfSelectedArea"){if(bi.visualBlock){bl=c(bl.line,bm.ch);bg.setCursor(bl);C(bg,bm)}else{if(bm.line<bl.line){bm=c(bl.line,0);bg.setCursor(bm)}}}else{if(bk=="inplace"){if(bi.visualMode){return}}}}}}bg.setOption("keyMap","vim-insert");bg.setOption("disableInput",false);if(bh&&bh.replace){bg.toggleOverwrite(true);bg.setOption("keyMap","vim-replace");b.signal(bg,"vim-mode-change",{mode:"replace"})}else{bg.setOption("keyMap","vim-insert");b.signal(bg,"vim-mode-change",{mode:"insert"})}if(!r.macroModeState.isPlaying){bg.on("change",a0);b.on(bg.getInputField(),"keydown",R)}if(bi.visualMode){aG(bg)}},toggleVisualMode:function(bh,bi,bj){var bm=bi.repeat;var bg=bh.getCursor();var bl;var bk=bh.listSelections();if(!bj.visualMode){bh.on("mousedown",aG);bj.visualMode=true;bj.visualLine=!!bi.linewise;bj.visualBlock=!!bi.blockwise;if(bj.visualLine){bg.ch=0;bl=T(bh,c(bg.line+bm-1,aI(bh,bg.line)),true)}else{bl=T(bh,c(bg.line,bg.ch+bm),true)}bh.setSelection(bg,bl);b.signal(bh,"vim-mode-change",{mode:"visual",subMode:bj.visualLine?"linewise":""})}else{bg=bh.getCursor("anchor");bl=bh.getCursor("head");if(bj.visualLine){if(bi.blockwise){bj.visualBlock=true;C(bh,bl);b.signal(bh,"vim-mode-change",{mode:"visual",subMode:"blockwise"})}else{if(!bi.linewise){b.signal(bh,"vim-mode-change",{mode:"visual"})}else{aG(bh)}}bj.visualLine=false}else{if(bj.visualBlock){if(bi.linewise){bj.visualLine=true;bg=c(bk[0].anchor.line,0);bl=c(bk[bk.length-1].anchor.line,aI(bh,bk[bk.length-1].anchor.line));bh.setSelection(bg,bl);b.signal(bh,"vim-mode-change",{mode:"visual",subMode:"linewise"})}else{if(!bi.blockwise){if(bl!=bk[0].head){bg=bk[0].anchor}else{bg=bk[bk.length-1].anchor}bh.setSelection(bg,bl);b.signal(bh,"vim-mode-change",{mode:"visual"})}else{aG(bh)}}bj.visualBlock=false}else{if(bi.linewise){bj.visualLine=true;bg.ch=aC(bg,bl)?0:aI(bh,bg.line);bl.ch=aC(bg,bl)?aI(bh,bl.line):0;bh.setSelection(bg,bl);b.signal(bh,"vim-mode-change",{mode:"visual",subMode:"linewise"})}else{if(bi.blockwise){bj.visualBlock=true;C(bh,bl);b.signal(bh,"vim-mode-change",{mode:"visual",subMode:"blockwise"})}else{aG(bh)}}}}}aF(bh,bj,"<",aC(bg,bl)?bg:bl);aF(bh,bj,">",aC(bg,bl)?bl:bg)},reselectLastSelection:function(bm,bi,bh){var bj=bh.marks["<"].find();var bn=bh.marks[">"].find();var bg=bh.lastSelection;if(bg){var bl=bg.curStartMark.find();var bo=bg.curEndMark.find();var bk=bg.visualBlock;aY(bm,bh,bj,bn);if(bk){bm.setCursor(bl);bl=C(bm,bo)}else{bm.setSelection(bl,bo);bl=bm.getCursor("anchor");bo=bm.getCursor("head")}if(bh.visualMode){aF(bm,bh,"<",aC(bl,bo)?bl:bo);aF(bm,bh,">",aC(bl,bo)?bo:bl)}bh.visualMode=true;if(bg.visualLine){bh.visualLine=true;bh.visualBlock=false}else{if(bg.visualBlock){bh.visualLine=false;bh.visualBlock=true}else{bh.visualBlock=bh.visualLine=false}}b.signal(bm,"vim-mode-change",{mode:"visual",subMode:bh.visualLine?"linewise":""})}},joinLines:function(bh,bi,bj){var bg,bl;if(bj.visualMode){bg=bh.getCursor("anchor");bl=bh.getCursor("head");bl.ch=aI(bh,bl.line)-1}else{var bk=Math.max(bi.repeat,2);bg=bh.getCursor();bl=T(bh,c(bg.line+bk-1,Infinity))}var bm=0;bh.operation(function(){for(var bp=bg.line;bp<bl.line;bp++){bm=aI(bh,bg.line);var bo=c(bg.line+1,aI(bh,bg.line+1));var bq=bh.getRange(bg,bo);bq=bq.replace(/\n\s*/g," ");bh.replaceRange(bq,bg,bo)}var bn=c(bg.line,bm);bh.setCursor(bn)})},newLineAndEnterInsertMode:function(bg,bh,bi){bi.insertMode=true;var bj=z(bg.getCursor());if(bj.line===bg.firstLine()&&!bh.after){bg.replaceRange("\n",c(bg.firstLine(),0));bg.setCursor(bg.firstLine(),0)}else{bj.line=(bh.after)?bj.line:bj.line-1;bj.ch=aI(bg,bj.line);bg.setCursor(bj);var bk=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bk(bg)}this.enterInsertMode(bg,{repeat:bh.repeat},bi)},paste:function(bu,bt,bB){var bn=z(bu.getCursor());var bh=r.registerController.getRegister(bt.registerName);var bx=bh.toString();if(!bx){return}if(bt.matchIndent){var bo=function(bI){var bH=(bI.split("\t").length-1);var bG=(bI.split(" ").length-1);return bH*bu.options.tabSize+bG*1};var bD=bu.getLine(bu.getCursor().line);var bw=bo(bD.match(/^\s*/)[0]);var bg=bx.replace(/\n$/,"");var bl=bx!==bg;var br=bo(bx.match(/^\s*/)[0]);var bx=bg.replace(/^\s*/gm,function(bG){var bH=bw+(bo(bG)-br);if(bH<0){return""}else{if(bu.options.indentWithTabs){var bI=Math.floor(bH/bu.options.tabSize);return Array(bI+1).join("\t")}else{return Array(bH+1).join(" ")}}});bx+=bl?"\n":""}if(bt.repeat>1){var bx=Array(bt.repeat+1).join(bx)}var bq=bh.linewise;var bs=bh.blockwise;if(bq){if(bB.visualMode){bx=bB.visualLine?bx.slice(0,-1):"\n"+bx.slice(0,bx.length-1)+"\n"}else{if(bt.after){bx="\n"+bx.slice(0,bx.length-1);bn.ch=aI(bu,bn.line)}else{bn.ch=0}}}else{if(bs){bx=bx.split("\n");for(var bC=0;bC<bx.length;bC++){bx[bC]=(bx[bC]=="")?" ":bx[bC]}}bn.ch+=bt.after?1:0}var bk;var by;if(bB.visualMode){bB.lastPastedText=bx;var bj;var bF=aR(bu,bB);var bz=bF[0];var bi=bF[1];var bA=bu.getSelection();var bp=bu.listSelections();var bm=new Array(bp.length).join("1").split("1");if(bB.lastSelection){bj=bB.lastSelection.curEndMark.find()}r.registerController.unnamedRegister.setText(bA);if(bs){bu.replaceSelections(bm);bi=c(bz.line+bx.length-1,bz.ch);bu.setCursor(bz);C(bu,bi);bu.replaceSelections(bx);bk=bz}else{if(bB.visualBlock){bu.replaceSelections(bm);bu.setCursor(bz);bu.replaceRange(bx,bz,bz);bk=bz}else{bu.replaceRange(bx,bz,bi);bk=bu.posFromIndex(bu.indexFromPos(bz)+bx.length-1)}}if(bj){bB.lastSelection.curEndMark=bu.setBookmark(bj)}if(bq){bk.ch=0}}else{if(bs){bu.setCursor(bn);for(var bC=0;bC<bx.length;bC++){var bv=bn.line+bC;if(bv>bu.lastLine()){bu.replaceRange("\n",c(bv,0))}var bE=aI(bu,bv);if(bE<bn.ch){aJ(bu,bv,bn.ch)}}bu.setCursor(bn);C(bu,c(bn.line+bx.length-1,bn.ch));bu.replaceSelections(bx);bk=bn}else{bu.replaceRange(bx,bn);if(bq&&bt.after){bk=c(bn.line+1,aM(bu.getLine(bn.line+1)))}else{if(bq&&!bt.after){bk=c(bn.line,aM(bu.getLine(bn.line)))}else{if(!bq&&bt.after){by=bu.indexFromPos(bn);bk=bu.posFromIndex(by+bx.length-1)}else{by=bu.indexFromPos(bn);bk=bu.posFromIndex(by+bx.length)}}}}}bu.setCursor(bk);if(bB.visualMode){aG(bu)}},undo:function(bg,bh){bg.operation(function(){am(bg,b.commands.undo,bh.repeat)();bg.setCursor(bg.getCursor("anchor"))})},redo:function(bg,bh){am(bg,b.commands.redo,bh.repeat)()},setRegister:function(bi,bg,bh){bh.inputState.registerName=bg.selectedCharacter},setMark:function(bg,bh,bi){var bj=bh.selectedCharacter;aF(bg,bi,bj,bg.getCursor())},replace:function(bo,bi,bk){var bj=bi.selectedCharacter;var bn=bo.getCursor();var bm;var bp;var bh=bo.listSelections();if(bk.visualMode){bn=bo.getCursor("start");bp=bo.getCursor("end")}else{var bq=bo.getLine(bn.line);bm=bn.ch+bi.repeat;if(bm>bq.length){bm=bq.length}bp=c(bn.line,bm)}if(bj=="\n"){if(!bk.visualMode){bo.replaceRange("",bn,bp)}(b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent)(bo)}else{var bg=bo.getRange(bn,bp);bg=bg.replace(/[^\n]/g,bj);if(bk.visualBlock){var bl=new Array(bo.options.tabSize+1).join(" ");bg=bo.getSelection();bg=bg.replace(/\t/g,bl).replace(/[^\n]/g,bj).split("\n");bo.replaceSelections(bg)}else{bo.replaceRange(bg,bn,bp)}if(bk.visualMode){bn=aC(bh[0].anchor,bh[0].head)?bh[0].anchor:bh[0].head;bo.setCursor(bn);aG(bo)}else{bo.setCursor(A(bp,0,-1))}}},incrementNumberToken:function(bq,bh){var br=bq.getCursor();var bm=bq.getLine(br.line);var bt=/-?\d+/g;var bl;var bg;var bk;var bs;var bi;while((bl=bt.exec(bm))!==null){bi=bl[0];bg=bl.index;bk=bg+bi.length;if(br.ch<bk){break}}if(!bh.backtrack&&(bk<=br.ch)){return}if(bi){var bp=bh.increase?1:-1;var bj=parseInt(bi)+(bp*bh.repeat);var bo=c(br.line,bg);var bn=c(br.line,bk);bs=bj.toString();bq.replaceRange(bs,bo,bn)}else{return}bq.setCursor(c(br.line,bg+bs.length-1))},repeatLastEdit:function(bh,bi,bj){var bg=bj.lastEditInputState;if(!bg){return}var bk=bi.repeat;if(bk&&bi.repeatIsExplicit){bj.lastEditInputState.repeatOverride=bk}else{bk=bj.lastEditInputState.repeatOverride||bk}v(bh,bj,bk,false)},changeCase:function(bg,bi,bj){var bk=aR(bg,bj)[0];var bn=bg.getSelection();var bh;var bm;if(bj.lastSelection){bh=bj.lastSelection.curEndMark.find();bm=bj.lastSelection.visualBlock}var bl=bi.toLower;bn=bl?bn.toLowerCase():bn.toUpperCase();bg.replaceSelections(bj.visualBlock||bm?bn.split("\n"):[bn]);if(bh){bj.lastSelection.curEndMark=bg.setBookmark(bh)}bg.setCursor(bk);if(bj.visualMode){aG(bg)}},exitInsertMode:t};function T(bh,bl,bj){var bi=Math.min(Math.max(bh.firstLine(),bl.line),bh.lastLine());var bg=aI(bh,bi)-1;bg=(bj)?bg+1:bg;var bk=Math.min(Math.max(0,bl.ch),bg);return c(bi,bk)}function a1(bh){var bg={};for(var bi in bh){if(bh.hasOwnProperty(bi)){bg[bi]=bh[bi]}}return bg}function A(bh,bg,bi){return c(bh.line+bg,bh.ch+bi)}function a3(bo,bm,bg,bk){var bj,bn=[],bl=[];for(var bi=0;bi<bm.length;bi++){var bh=bm[bi];if(bg=="insert"&&bh.context!="insert"||bh.context&&bh.context!=bg||bk.operator&&bh.type=="action"||!(bj=M(bo,bh.keys))){continue}if(bj=="partial"){bn.push(bh)}if(bj=="full"){bl.push(bh)}}return{partial:bn.length&&bn,full:bl.length&&bl}}function M(bj,bg){if(bg.slice(-11)=="<character>"){var bh=bg.length-11;var bk=bj.slice(0,bh);var bi=bg.slice(0,bh);return bk==bi&&bj.length>bh?"full":bi.indexOf(bk)==0?"partial":false}else{return bj==bg?"full":bg.indexOf(bj)==0?"partial":false}}function L(bi){var bh=/^.*(<[\w\-]+>)$/.exec(bi);var bg=bh?bh[1]:bi.slice(-1);if(bg.length>1){switch(bg){case"<CR>":bg="\n";break;case"<Space>":bg=" ";break;default:break}}return bg}function am(bg,bh,bi){return function(){for(var bj=0;bj<bi;bj++){bh(bg)}}}function z(bg){return c(bg.line,bg.ch)}function be(bh,bg){return bh.ch==bg.ch&&bh.line==bg.line}function aC(bh,bg){if(bh.line<bg.line){return true}if(bh.line==bg.line&&bh.ch<bg.ch){return true}return false}function aH(bj,bi,bh){var bk=aC(bj,bi);var bg=aC(bi,bh);return bk&&bg}function aI(bg,bh){return bg.getLine(bh).length}function l(bg){return bg.split("").reverse().join("")}function aT(bg){if(bg.trim){return bg.trim()}return bg.replace(/^\s+|\s+$/g,"")}function i(bg){return bg.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function aJ(bg,bk,bj){var bi=aI(bg,bk);var bh=new Array(bj-bi+1).join(" ");bg.setCursor(c(bk,bi));bg.replaceRange(bh,bg.getCursor())}function C(br,bh){var bl=[],bi=br.listSelections();var bp=bi[0].anchor,bg=bi[bi.length-1].anchor;var bm,bk,bw,bu;var bv=br.getCursor("head");var bo=z(bh);bm=bp.line;bk=bg.line;if(bh.line<bv.line){bw="up"}else{if(bh.line>bv.line){bw="down"}else{if(bh.ch!=bv.ch){bw=bh.ch>bv.ch?"right":"left"}bu=br.getCursor("anchor")}}var bx=s(bi,bv);bh=br.clipPos(bh);var bs=s(bi,bh)<0?false:true;var by=!be(bo,bh);var bj=function(){if(by){if(bv.ch>=bu.ch){bu.ch++}}else{if(bv.ch==aI(br,bv.line)){if(be(bi[bx].anchor,bi[bx].head)&&bi.length>1){if(bw=="up"){if(bs||bx>0){bm=bp.line;bk=bh.line;bu=bi[bx-1].anchor}}else{if(bs||bx==0){bk=bg.line;bm=bh.line;bu=bi[bx+1].anchor}}if(bh.ch>=bu.ch){bu.ch--}}}}};switch(bw){case"up":bm=bs?bp.line:bh.line;bk=bs?bh.line:bg.line;bu=bg;bj();break;case"down":bm=bs?bh.line:bp.line;bk=bs?bg.line:bh.line;bu=bp;bj();break;case"left":if((bh.ch<=bu.ch)&&(bv.ch>bu.ch)){bu.ch++;bh.ch--}break;case"right":if((bu.ch<=bh.ch)&&(bv.ch<bu.ch)){bu.ch--;bh.ch++}break;default:bm=bu.line;bk=bh.line}while(bm<=bk){var bq={line:bm,ch:bu.ch};var bn={line:bm,ch:bh.ch};var bt={anchor:bq,head:bn};bl.push(bt);if(be(bn,bh)){bx=bl.indexOf(bt)}bm++}bh.ch=bl[0].head.ch;bu.ch=bl[0].anchor.ch;if(be(bh,bl[0].head)){bu.line=bl[bl.length-1].anchor.line}else{bu.line=bl[0].anchor.line}br.setSelections(bl,bx);return bu}function s(bh,bl,bg){var bm=-1;for(var bi=0;bi<bh.length;bi++){var bj=be(bh[bi].anchor,bl);var bk=be(bh[bi].head,bl);if(bg=="head"){bm=bk?bi:bm}else{if(bg=="anchor"){bm=bj?bi:bm}else{bm=(bj||bk)?bi:bm}}}return bm}function aR(bh,bj){var bi=bj.lastSelection;var bg=function(){var bm=bh.listSelections();var bp=bm[0];var bl=bm[bm.length-1];var bn=aC(bp.anchor,bp.head)?bp.anchor:bp.head;var bo=aC(bl.anchor,bl.head)?bl.head:bl.anchor;return[bn,bo]};var bk=function(){var bv=bh.getCursor();var bw=bh.getCursor();var bq=bi.visualBlock;if(bq){var bn=bq.width;var bx=bq.height;bw=c(bv.line+bx,bv.ch+bn);var bo=[];for(var br=bv.line;br<bw.line;br++){var bs=c(br,bv.ch);var bu=c(br,bw.ch);var bt={anchor:bs,head:bu};bo.push(bt)}bh.setSelections(bo)}else{var bm=bi.curStartMark.find();var bp=bi.curEndMark.find();var by=bp.line-bm.line;var bl=bp.ch-bm.ch;bw={line:bw.line+by,ch:by?bw.ch:bl+bw.ch};if(bi.visualLine){bv=c(bv.line,0);bw=c(bw.line,aI(bh,bw.line))}bh.setSelection(bv,bw)}return[bv,bw]};if(!bj.visualMode){return bk()}else{return bg()}}function aY(bm,bk,bl,bn){if(!bl||!bn){bl=bk.marks["<"].find()||bm.getCursor("anchor");bn=bk.marks[">"].find()||bm.getCursor("head")}if(bk.lastPastedText){bn=bm.posFromIndex(bm.indexFromPos(bl)+bk.lastPastedText.length);bk.lastPastedText=null}var bg=bm.listSelections();var bi=s(bg,bl,"head")>-1;if(bk.visualBlock){var bo=Math.abs(bl.line-bn.line)+1;var bh=Math.abs(bl.ch-bn.ch);var bj={height:bo,width:bh}}bk.lastSelection={curStartMark:bm.setBookmark(bi?bn:bl),curEndMark:bm.setBookmark(bi?bl:bn),visualMode:bk.visualMode,visualLine:bk.visualLine,visualBlock:bj}}function aG(bg){bg.off("mousedown",aG);var bh=bg.state.vim;var bi=bg.getCursor("anchor");var bj=bg.getCursor("head");if(bh.visualBlock&&(aC(bi,bj))){bj.ch--}aY(bg,bh);bh.visualMode=false;bh.visualLine=false;bh.visualBlock=false;if(!be(bi,bj)){bg.setCursor(T(bg,bj))}b.signal(bg,"vim-mode-change",{mode:"normal"});if(bh.fakeCursor){bh.fakeCursor.clear()}}function ae(bh,bg,bl){var bk=bh.getRange(bg,bl);if(/\n\s*$/.test(bk)){var bj=bk.split("\n");bj.pop();var bi;for(var bi=bj.pop();bj.length>0&&bi&&N(bi);bi=bj.pop()){bl.line--;bl.ch=0}if(bi){bl.line--;bl.ch=aI(bh,bl.line)}else{bl.ch=0}}}function aX(bh,bg,bi){bg.ch=0;bi.ch=0;bi.line++}function aM(bh){if(!bh){return 0}var bg=bh.search(/\S/);return bg==-1?bh.length:bg}function at(bp,bl,bz,bh,bA){var bj=bp.getCursor();var bs=bp.getLine(bj.line);var bv=bj.ch;var bu=bs.substring(bv);var bw;if(bA){bw=bu.search(/\w/)}else{bw=bu.search(/\S/)}if(bw==-1){return null}bv+=bw;bu=bs.substring(bv);var by=bs.substring(0,bv);var bB;if(bh){bB=/^\S+/}else{if((/\w/).test(bs.charAt(bv))){bB=/^\w+/}else{bB=/^[^\w\s]+/}}var bm=bB.exec(bu);var bt=bv;var bi=bv+bm[0].length;var bk=l(by);var bq=bB.exec(bk);if(bq){bt-=bq[0].length}if(bl){var br=bs.substring(bi);var bg=br.match(/^\s*/)[0].length;if(bg>0){bi+=bg}else{var bo=bk.length-bt;var bn=bk.substring(bo);var bx=bn.match(/^\s*/)[0].length;bt-=bx}}return{start:c(bj.line,bt),end:c(bj.line,bi)}}function aZ(bg,bh,bi){if(!be(bh,bi)){r.jumpList.add(bg,bh,bi)}}function ar(bg,bh){r.lastChararacterSearch.increment=bg;r.lastChararacterSearch.forward=bh.forward;r.lastChararacterSearch.selectedCharacter=bh.selectedCharacter}var O={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var aL={bracket:{isComplete:function(bg){if(bg.nextCh===bg.symb){bg.depth++;if(bg.depth>=1){return true}}else{if(bg.nextCh===bg.reverseSymb){bg.depth--}}return false}},section:{init:function(bg){bg.curMoveThrough=true;bg.symb=(bg.forward?"]":"[")===bg.symb?"{":"}"},isComplete:function(bg){return bg.index===0&&bg.nextCh===bg.symb}},comment:{isComplete:function(bh){var bg=bh.lastCh==="*"&&bh.nextCh==="/";bh.lastCh=bh.nextCh;return bg}},method:{init:function(bg){bg.symb=(bg.symb==="m"?"{":"}");bg.reverseSymb=bg.symb==="{"?"}":"{"},isComplete:function(bg){if(bg.nextCh===bg.symb){return true}return false}},preprocess:{init:function(bg){bg.index=0},isComplete:function(bh){if(bh.nextCh==="#"){var bg=bh.lineText.match(/#(\w+)/)[1];if(bg==="endif"){if(bh.forward&&bh.depth===0){return true}bh.depth++}else{if(bg==="if"){if(!bh.forward&&bh.depth===0){return true}bh.depth--}}if(bg==="else"&&bh.depth===0){return true}}return false}}};function a9(bp,bh,bk,bi){var bs=z(bp.getCursor());var bq=bk?1:-1;var bj=bk?bp.lineCount():-1;var bo=bs.ch;var bu=bs.line;var bn=bp.getLine(bu);var bg={lineText:bn,nextCh:bn.charAt(bo),lastCh:null,index:bo,symb:bi,reverseSymb:(bk?{")":"(","}":"{"}:{"(":")","{":"}"})[bi],forward:bk,depth:0,curMoveThrough:false};var bl=O[bi];if(!bl){return bs}var bt=aL[bl].init;var br=aL[bl].isComplete;if(bt){bt(bg)}while(bu!==bj&&bh){bg.index+=bq;bg.nextCh=bg.lineText.charAt(bg.index);if(!bg.nextCh){bu+=bq;bg.lineText=bp.getLine(bu)||"";if(bq>0){bg.index=0}else{var bm=bg.lineText.length;bg.index=(bm>0)?(bm-1):0}bg.nextCh=bg.lineText.charAt(bg.index)}if(br(bg)){bs.line=bu;bs.ch=bg.index;bh--}}if(bg.nextCh||bg.curMoveThrough){return c(bu,bg.index)}return bs}function bc(bq,br,bj,bo,bp){var bk=br.line;var bn=br.ch;var bu=bq.getLine(bk);var bh=bj?1:-1;var bl=bo?a5:aj;if(bp&&bu==""){bk+=bh;bu=bq.getLine(bk);if(!h(bq,bk)){return null}bn=(bj)?0:bu.length}while(true){if(bp&&bu==""){return{from:0,to:0,line:bk}}var bm=(bh>0)?bu.length:-1;var bt=bm,bs=bm;while(bn!=bm){var bg=false;for(var bi=0;bi<bl.length&&!bg;++bi){if(bl[bi].test(bu.charAt(bn))){bt=bn;while(bn!=bm&&bl[bi].test(bu.charAt(bn))){bn+=bh}bs=bn;bg=bt!=bs;if(bt==br.ch&&bk==br.line&&bs==bt+bh){continue}else{return{from:Math.min(bt,bs+1),to:Math.max(bt,bs),line:bk}}}}if(!bg){bn+=bh}}bk+=bh;if(!h(bq,bk)){return null}bu=bq.getLine(bk);bn=(bh>0)?0:bu.length}throw new Error("The impossible happened.")}function aq(bq,bh,bl,bu,bo){var bs=bq.getCursor();var bm=z(bs);var bn=[];if(bl&&!bu||!bl&&bu){bh++}var bp=!(bl&&bu);for(var bj=0;bj<bh;bj++){var bg=bc(bq,bs,bl,bo,bp);if(!bg){var bi=aI(bq,bq.lastLine());bn.push(bl?{line:bq.lastLine(),from:bi,to:bi}:{line:0,from:0,to:0});break}bn.push(bg);bs=c(bg.line,bl?(bg.to-1):bg.from)}var bk=bn.length!=bh;var br=bn[0];var bt=bn.pop();if(bl&&!bu){if(!bk&&(br.from!=bm.ch||br.line!=bm.line)){bt=bn.pop()}return c(bt.line,bt.from)}else{if(bl&&bu){return c(bt.line,bt.to-1)}else{if(!bl&&bu){if(!bk&&(br.to!=bm.ch||br.line!=bm.line)){bt=bn.pop()}return c(bt.line,bt.to)}else{return c(bt.line,bt.from)}}}}function a8(bl,bh,bj,bk){var bn=bl.getCursor();var bg=bn.ch;var bm;for(var bi=0;bi<bh;bi++){var bo=bl.getLine(bn.line);bm=aU(bg,bo,bk,bj,true);if(bm==-1){return null}bg=bm}return c(bl.getCursor().line,bm)}function ac(bg,bi){var bh=bg.getCursor().line;return T(bg,c(bh,bi-1))}function aF(bg,bh,bi,bj){if(!G(bi,au)){return}if(bh.marks[bi]){bh.marks[bi].clear()}bh.marks[bi]=bg.setBookmark(bj)}function aU(bl,bh,bk,bi,bj){var bg;if(bi){bg=bh.indexOf(bk,bl+1);if(bg!=-1&&!bj){bg-=1}}else{bg=bh.lastIndexOf(bk,bl-1);if(bg!=-1&&!bj){bg+=1}}return bg}function o(bp,bi,bo){var bq=bp.getCursor(),bh,bk;var bn=({"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/})[bi];var bj=({"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"})[bi];var bg=bp.getLine(bq.line).charAt(bq.ch);var bl=bg===bj?1:0;bh=bp.scanForBracket(c(bq.line,bq.ch+bl),-1,null,{bracketRegex:bn});bk=bp.scanForBracket(c(bq.line,bq.ch+bl),1,null,{bracketRegex:bn});if(!bh||!bk){return{start:bq,end:bq}}bh=bh.pos;bk=bk.pos;if((bh.line==bk.line&&bh.ch>bk.ch)||(bh.line>bk.line)){var bm=bh;bh=bk;bk=bm}if(bo){bk.ch+=1}else{bh.ch+=1}return{start:bh,end:bk}}function aE(bo,bi,bn){var bp=z(bo.getCursor());var bq=bo.getLine(bp.line);var bm=bq.split("");var bh,bj,bk,bl;var bg=bm.indexOf(bi);if(bp.ch<bg){bp.ch=bg}else{if(bg<bp.ch&&bm[bp.ch]==bi){bj=bp.ch;--bp.ch}}if(bm[bp.ch]==bi&&!bj){bh=bp.ch+1}else{for(bk=bp.ch;bk>-1&&!bh;bk--){if(bm[bk]==bi){bh=bk+1}}}if(bh&&!bj){for(bk=bh,bl=bm.length;bk<bl&&!bj;bk++){if(bm[bk]==bi){bj=bk}}}if(!bh||!bj){return{start:bp,end:bp}}if(bn){--bh;++bj}return{start:c(bp.line,bh),end:c(bp.line,bj)}}az("pcre",true,"boolean");function W(){}W.prototype={getQuery:function(){return r.query},setQuery:function(bg){r.query=bg},getOverlay:function(){return this.searchOverlay},setOverlay:function(bg){this.searchOverlay=bg},isReversed:function(){return r.isReversed},setReversed:function(bg){r.isReversed=bg}};function aw(bg){var bh=bg.state.vim;return bh.searchState_||(bh.searchState_=new W())}function V(bg,bj,bk,bh,bi){if(bg.openDialog){bg.openDialog(bj,bh,{bottom:true,value:bi.value,onKeyDown:bi.onKeyDown,onKeyUp:bi.onKeyUp})}else{bh(prompt(bk,""))}}function u(bi){var bh=ad(bi)||[];if(!bh.length){return[]}var bj=[];if(bh[0]!==0){return}for(var bg=0;bg<bh.length;bg++){if(typeof bh[bg]=="number"){bj.push(bi.substring(bh[bg]+1,bh[bg+1]))}}return bj}function ad(bj){var bh=false;var bi=[];for(var bg=0;bg<bj.length;bg++){var bk=bj.charAt(bg);if(!bh&&bk=="/"){bi.push(bg)}bh=!bh&&(bk=="\\")}return bi}function a7(bn){var bo="|(){";var bk="}";var bl=false;var bh=[];for(var bi=-1;bi<bn.length;bi++){var bm=bn.charAt(bi)||"";var bg=bn.charAt(bi+1)||"";var bj=(bg&&bo.indexOf(bg)!=-1);if(bl){if(bm!=="\\"||!bj){bh.push(bm)}bl=false}else{if(bm==="\\"){bl=true;if(bg&&bk.indexOf(bg)!=-1){bj=true}if(!bj||bg==="\\"){bh.push(bm)}}else{bh.push(bm);if(bj&&bg!=="\\"){bh.push("\\")}}}}return bh.join("")}function ba(bj){var bi=false;var bg=[];for(var bh=-1;bh<bj.length;bh++){var bl=bj.charAt(bh)||"";var bk=bj.charAt(bh+1)||"";if(bi){bg.push(bl);bi=false}else{if(bl==="\\"){bi=true;if((Z(bk)||bk==="$")){bg.push("$")}else{if(bk!=="/"&&bk!=="\\"){bg.push("\\")}}}else{if(bl==="$"){bg.push("$")}bg.push(bl);if(bk==="/"){bg.push("\\")}}}}return bg.join("")}function Y(bi){var bh=new b.StringStream(bi);var bg=[];while(!bh.eol()){while(bh.peek()&&bh.peek()!="\\"){bg.push(bh.next())}if(bh.match("\\/",true)){bg.push("/")}else{if(bh.match("\\\\",true)){bg.push("\\")}else{bg.push(bh.next())}}}return bg.join("")}function ao(bk,bi,bn){var bm=r.registerController.getRegister("/");bm.setText(bk);if(bk instanceof RegExp){return bk}var bl=ad(bk);var bo;var bh;if(!bl.length){bo=bk}else{bo=bk.substring(0,bl[0]);var bg=bk.substring(bl[0]);bh=(bg.indexOf("i")!=-1)}if(!bo){return null}if(!p("pcre")){bo=a7(bo)}if(bn){bi=(/^[^A-Z]*$/).test(bo)}var bj=new RegExp(bo,(bi||bh)?"i":undefined);return bj}function a4(bg,bh){if(bg.openNotification){bg.openNotification('<span style="color: red">'+bh+"</span>",{bottom:true,duration:5000})}else{alert(bh)}}function av(bh,bi){var bg="";if(bh){bg+='<span style="font-family: monospace">'+bh+"</span>"}bg+='<input type="text"/> <span style="color: #888">';if(bi){bg+='<span style="color: #888">';bg+=bi;bg+="</span>"}return bg}var K="(Javascript regexp)";function aN(bh,bi){var bj=(bi.prefix||"")+" "+(bi.desc||"");var bg=av(bi.prefix,bi.desc);V(bh,bg,bj,bi.onClose,bi)}function S(bh,bg){if(bh instanceof RegExp&&bg instanceof RegExp){var bj=["global","multiline","ignoreCase","source"];for(var bi=0;bi<bj.length;bi++){var bk=bj[bi];if(bh[bk]!==bg[bk]){return false}}return true}return false}function bd(bg,bl,bh,bi){if(!bl){return}var bk=aw(bg);var bj=ao(bl,!!bh,!!bi);if(!bj){return}ay(bg,bj);if(S(bj,bk.getQuery())){return bj}bk.setQuery(bj);return bj}function aB(bh){if(bh.source.charAt(0)=="^"){var bg=true}return{token:function(bj){if(bg&&!bj.sol()){bj.skipToEnd();return}var bi=bj.match(bh,false);if(bi){if(bi[0].length==0){bj.next();return"searching"}if(!bj.sol()){bj.backUp(1);if(!bh.exec(bj.next()+bi[0])){bj.next();return null}}bj.match(bh);return"searching"}while(!bj.eol()){bj.next();if(bj.match(bh,false)){break}}},query:bh}}function ay(bg,bi){var bh=aw(bg).getOverlay();if(!bh||bi!=bh.query){if(bh){bg.removeOverlay(bh)}bh=aB(bi);bg.addOverlay(bh);aw(bg).setOverlay(bh)}}function bf(bg,bh,bj,bi){if(bi===undefined){bi=1}return bg.operation(function(){var bn=bg.getCursor();var bm=bg.getSearchCursor(bj,bn);for(var bk=0;bk<bi;bk++){var bl=bm.find(bh);if(bk==0&&bl&&be(bm.from(),bn)){bl=bm.find(bh)}if(!bl){bm=bg.getSearchCursor(bj,(bh)?c(bg.lastLine()):c(bg.firstLine(),0));if(!bm.find(bh)){return}}}return bm.from()})}function aA(bg){bg.removeOverlay(aw(bg).getOverlay());aw(bg).setOverlay(null)}function X(bi,bh,bg){if(typeof bi!="number"){bi=bi.line}if(bh instanceof Array){return G(bi,bh)}else{if(bg){return(bi>=bh&&bi<=bg)}else{return bi==bh}}}function aW(bg){var bj=bg.getScrollInfo();var bi=6;var bm=10;var bl=bg.coordsChar({left:0,top:bi+bj.top},"local");var bh=bj.clientHeight-bm+bj.top;var bk=bg.coordsChar({left:0,top:bh},"local");return{top:bl.line,bottom:bk.line}}var y=[{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"set"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];e.ExCommandDispatcher=function(){this.buildCommandMap_()};e.ExCommandDispatcher.prototype={processCommand:function(br,bq,bh){var bl=br.state.vim;var bi=r.registerController.getRegister(":");var bo=bi.toString();if(bl.visualMode){aG(br)}var bg=new b.StringStream(bq);bi.setText(bq);var bk=bh||{};bk.input=bq;try{this.parseInput_(br,bg,bk)}catch(bp){a4(br,bp);throw bp}var bj;var bn;if(!bk.commandName){if(bk.line!==undefined){bn="move"}}else{bj=this.matchCommand_(bk.commandName);if(bj){bn=bj.name;if(bj.excludeFromCommandHistory){bi.setText(bo)}this.parseCommandArgs_(bg,bk,bj);if(bj.type=="exToKey"){for(var bm=0;bm<bj.toKeys.length;bm++){b.Vim.handleKey(br,bj.toKeys[bm],"mapping")}return}else{if(bj.type=="exToEx"){this.processCommand(br,bj.toInput);return}}}}if(!bn){a4(br,'Not an editor command ":'+bq+'"');return}try{aQ[bn](br,bk);if((!bj||!bj.possiblyAsync)&&bk.callback){bk.callback()}}catch(bp){a4(br,bp);throw bp}},parseInput_:function(bh,bi,bg){bi.eatWhile(":");if(bi.eat("%")){bg.line=bh.firstLine();bg.lineEnd=bh.lastLine()}else{bg.line=this.parseLineSpec_(bh,bi);if(bg.line!==undefined&&bi.eat(",")){bg.lineEnd=this.parseLineSpec_(bh,bi)}}var bj=bi.match(/^(\w+)/);if(bj){bg.commandName=bj[1]}else{bg.commandName=bi.match(/.*/)[0]}return bg},parseLineSpec_:function(bg,bh){var bi=bh.match(/^(\d+)/);if(bi){return parseInt(bi[1],10)-1}switch(bh.next()){case".":return bg.getCursor().line;case"$":return bg.lastLine();case"'":var bj=bg.state.vim.marks[bh.next()];if(bj&&bj.find()){return bj.find().line}throw new Error("Mark not set");default:bh.backUp(1);return undefined}},parseCommandArgs_:function(bh,bk,bj){if(bh.eol()){return}bk.argString=bh.match(/.*/)[0];var bi=bj.argDelimiter||/\s+/;var bg=aT(bk.argString).split(bi);if(bg.length&&bg[0]){bk.args=bg}},matchCommand_:function(bh){for(var bg=bh.length;bg>0;bg--){var bi=bh.substring(0,bg);if(this.commandMap_[bi]){var bj=this.commandMap_[bi];if(bj.name.indexOf(bh)===0){return bj}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var bh=0;bh<y.length;bh++){var bi=y[bh];var bg=bi.shortName||bi.name;this.commandMap_[bg]=bi}},map:function(bh,bk,bg){if(bh!=":"&&bh.charAt(0)==":"){if(bg){throw Error("Mode not supported for ex mappings")}var bj=bh.substring(1);if(bk!=":"&&bk.charAt(0)==":"){this.commandMap_[bj]={name:bj,type:"exToEx",toInput:bk.substring(1),user:true}}else{this.commandMap_[bj]={name:bj,type:"exToKey",toKeys:bk,user:true}}}else{if(bk!=":"&&bk.charAt(0)==":"){var bi={keys:bh,type:"keyToEx",exArgs:{input:bk.substring(1)},user:true};if(bg){bi.context=bg}a.unshift(bi)}else{var bi={keys:bh,type:"keyToKey",toKeys:bk,user:true};if(bg){bi.context=bg}a.unshift(bi)}}},unmap:function(bh,bg){if(bh!=":"&&bh.charAt(0)==":"){if(bg){throw Error("Mode not supported for ex mappings")}var bj=bh.substring(1);if(this.commandMap_[bj]&&this.commandMap_[bj].user){delete this.commandMap_[bj];return}}else{var bk=bh;for(var bi=0;bi<a.length;bi++){if(bk==a[bi].keys&&a[bi].context===bg&&a[bi].user){a.splice(bi,1);return}}}throw Error("No such mapping.")}};var aQ={map:function(bg,bj,bh){var bi=bj.args;if(!bi||bi.length<2){if(bg){a4(bg,"Invalid mapping: "+bj.input)}return}n.map(bi[0],bi[1],bh)},imap:function(bg,bh){this.map(bg,bh,"insert")},nmap:function(bg,bh){this.map(bg,bh,"normal")},vmap:function(bg,bh){this.map(bg,bh,"visual")},unmap:function(bg,bj,bh){var bi=bj.args;if(!bi||bi.length<1){if(bg){a4(bg,"No such mapping: "+bj.input)}return}n.unmap(bi[0],bh)},move:function(bg,bh){aV.processCommand(bg,bg.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:bh.line+1})},set:function(bo,bl){var bi=bl.args;if(!bi||bi.length<1){if(bo){a4(bo,"Invalid mapping: "+bl.input)}return}var bm=bi[0].split("=");var bh=bm[0];var bn=bm[1];var bk=false;if(bh.charAt(bh.length-1)=="?"){if(bn){throw Error("Trailing characters: "+bl.argString)}bh=bh.substring(0,bh.length-1);bk=true}if(bn===undefined&&bh.substring(0,2)=="no"){bh=bh.substring(2);bn=false}var bj=al[bh]&&al[bh].type=="boolean";if(bj&&bn==undefined){bn=true}if(!bj&&!bn||bk){var bg=p(bh);if(bg===true||bg===false){a4(bo," "+(bg?"":"no")+bh)}else{a4(bo,"  "+bh+"="+bg)}}else{ax(bh,bn)}},registers:function(bl,bh){var bn=bh.args;var bk=r.registerController.registers;var bi="----------Registers----------<br><br>";if(!bn){for(var bg in bk){var bo=bk[bg].toString();if(bo.length){bi+='"'+bg+"    "+bo+"<br>"}}}else{var bg;bn=bn.join("");for(var bj=0;bj<bn.length;bj++){bg=bn.charAt(bj);if(!r.registerController.isValidRegister(bg)){continue}var bm=bk[bg]||new a6();bi+='"'+bg+"    "+bm.toString()+"<br>"}}a4(bl,bi)},sort:function(bp,bz){var bq,bj,bh,bi;function bk(){if(bz.argString){var bD=new b.StringStream(bz.argString);if(bD.eat("!")){bq=true}if(bD.eol()){return}if(!bD.eatSpace()){return"Invalid arguments"}var bF=bD.match(/[a-z]+/);if(bF){bF=bF[0];bj=bF.indexOf("i")!=-1;bh=bF.indexOf("u")!=-1;var bC=bF.indexOf("d")!=-1&&1;var bE=bF.indexOf("x")!=-1&&1;var bB=bF.indexOf("o")!=-1&&1;if(bC+bE+bB>1){return"Invalid arguments"}bi=bC&&"decimal"||bE&&"hex"||bB&&"octal"}if(bD.eatSpace()&&bD.match(/\/.*\//)){"patterns not supported"}}}var bl=bk();if(bl){a4(bp,bl+": "+bz.argString);return}var bu=bz.line||bp.firstLine();var by=bz.lineEnd||bz.line||bp.lastLine();if(bu==by){return}var bo=c(bu,0);var bw=c(by,aI(bp,by));var bt=bp.getRange(bo,bw).split("\n");var bm=(bi=="decimal")?/(-?)([\d]+)/:(bi=="hex")?/(-?)(?:0x)?([0-9a-f]+)/i:(bi=="octal")?/([0-7]+)/:null;var bn=(bi=="decimal")?10:(bi=="hex")?16:(bi=="octal")?8:null;var br=[],bv=[];if(bi){for(var bx=0;bx<bt.length;bx++){if(bm.exec(bt[bx])){br.push(bt[bx])}else{bv.push(bt[bx])}}}else{bv=bt}function bA(bC,bB){if(bq){var bD;bD=bC;bC=bB;bB=bD}if(bj){bC=bC.toLowerCase();bB=bB.toLowerCase()}var bF=bi&&bm.exec(bC);var bE=bi&&bm.exec(bB);if(!bF){return bC<bB?-1:1}bF=parseInt((bF[1]+bF[2]).toLowerCase(),bn);bE=parseInt((bE[1]+bE[2]).toLowerCase(),bn);return bF-bE}br.sort(bA);bv.sort(bA);bt=(!bq)?bv.concat(br):br.concat(bv);if(bh){var bs=bt;var bg;bt=[];for(var bx=0;bx<bs.length;bx++){if(bs[bx]!=bg){bt.push(bs[bx])}bg=bs[bx]}}bp.replaceRange(bt.join("\n"),bo,bw)},global:function(bt,bk){var bh=bk.argString;if(!bh){a4(bt,"Regular Expression missing from global");return}var bn=(bk.line!==undefined)?bk.line:bt.firstLine();var bl=bk.lineEnd||bk.line||bt.lastLine();var bs=u(bh);var bv=bh,bj;if(bs.length){bv=bs[0];bj=bs.slice(1,bs.length).join("/")}if(bv){try{bd(bt,bv,true,true)}catch(bq){a4(bt,"Invalid regex: "+bv);return}}var br=aw(bt).getQuery();var bg=[],bp="";for(var bm=bn;bm<=bl;bm++){var bi=br.test(bt.getLine(bm));if(bi){bg.push(bm+1);bp+=bt.getLine(bm)+"<br>"}}if(!bj){a4(bt,bp);return}var bo=0;var bu=function(){if(bo<bg.length){var bw=bg[bo]+bj;n.processCommand(bt,bw,{callback:bu})}bo++};bu()},substitute:function(bn,bv){if(!bn.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.")}var bw=bv.argString;var bq=bw?u(bw):[];var bo,bp="",bg,bh,bl;var bm=false;var bs=false;if(bq.length){bo=bq[0];bp=bq[1];if(bp!==undefined){if(p("pcre")){bp=Y(bp)}else{bp=ba(bp)}r.lastSubstituteReplacePart=bp}bg=bq[2]?bq[2].split(" "):[]}else{if(bw&&bw.length){a4(bn,"Substitutions should be of the form :s/pattern/replace/");return}}if(bg){bh=bg[0];bl=parseInt(bg[1]);if(bh){if(bh.indexOf("c")!=-1){bm=true;bh.replace("c","")}if(bh.indexOf("g")!=-1){bs=true;bh.replace("g","")}bo=bo+"/"+bh}}if(bo){try{bd(bn,bo,true,true)}catch(bu){a4(bn,"Invalid regex: "+bo);return}}bp=bp||r.lastSubstituteReplacePart;if(bp===undefined){a4(bn,"No previous substitute regular expression");return}var bj=aw(bn);var bk=bj.getQuery();var br=(bv.line!==undefined)?bv.line:bn.getCursor().line;var bt=bv.lineEnd||br;if(bl){br=bt;bt=br+bl-1}var bx=T(bn,c(br,0));var bi=bn.getSearchCursor(bk,bx);aS(bn,bm,bs,br,bt,bi,bk,bp,bv.callback)},redo:b.commands.redo,undo:b.commands.undo,write:function(bg){if(b.commands.save){b.commands.save(bg)}else{bg.save()}},nohlsearch:function(bg){aA(bg)},delmarks:function(bq,bl){if(!bl.argString||!aT(bl.argString)){a4(bq,"Argument required");return}var bg=bq.state.vim;var br=new b.StringStream(aT(bl.argString));while(!br.eol()){br.eatSpace();var bo=br.pos;if(!br.match(/[a-zA-Z]/,false)){a4(bq,"Invalid argument: "+bl.argString.substring(bo));return}var bi=br.next();if(br.match("-",true)){if(!br.match(/[a-zA-Z]/,false)){a4(bq,"Invalid argument: "+bl.argString.substring(bo));return}var bj=bi;var bn=br.next();if(B(bj)&&B(bn)||x(bj)&&x(bn)){var bh=bj.charCodeAt(0);var bp=bn.charCodeAt(0);if(bh>=bp){a4(bq,"Invalid argument: "+bl.argString.substring(bo));return}for(var bm=0;bm<=bp-bh;bm++){var bk=String.fromCharCode(bh+bm);delete bg.marks[bk]}}else{a4(bq,"Invalid argument: "+bj+"-");return}}else{delete bg.marks[bi]}}}};var n=new e.ExCommandDispatcher();function aS(bu,bh,bj,bp,bn,bi,br,bl,bv){bu.state.vim.exMode=true;var bm=false;var bt=bi.from();function bq(){bu.operation(function(){while(!bm){bk();bo()}bs()})}function bk(){var bx=bu.getRange(bi.from(),bi.to());var bw=bx.replace(br,bl);bi.replace(bw)}function bo(){var bw;while(bw=bi.findNext()&&X(bi.from(),bp,bn)){if(!bj&&bt&&bi.from().line==bt.line){continue}bu.scrollIntoView(bi.from(),30);bu.setSelection(bi.from(),bi.to());bt=bi.from();bm=false;return}bm=true}function bs(bx){if(bx){bx()}bu.focus();if(bt){bu.setCursor(bt);var bw=bu.state.vim;bw.exMode=false;bw.lastHPos=bw.lastHSPos=bt.ch}if(bv){bv()}}function bg(bz,bw,bA){b.e_stop(bz);var bx=b.keyName(bz);switch(bx){case"Y":bk();bo();break;case"N":bo();break;case"A":var by=bv;bv=undefined;bu.operation(bq);bv=by;break;case"L":bk();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":bs(bA);break}if(bm){bs(bA)}}bo();if(bm){a4(bu,"No matches for "+br.source);return}if(!bh){bq();if(bv){bv()}return}aN(bu,{prefix:"replace with <strong>"+bl+"</strong> (y/n/a/q/l)",onKeyDown:bg})}b.keyMap.vim={nofallthrough:true,style:"fat-cursor"};function t(bo){var bh=bo.state.vim;var bj=r.macroModeState;var bm=r.registerController.getRegister(".");var bg=bj.isPlaying;var bk=bj.lastInsertModeChanges;var bp=[];if(!bg){var bl=bk.inVisualBlock?bh.lastSelection.visualBlock.height:1;var bn=bk.changes;var bp=[];var bi=0;while(bi<bn.length){bp.push(bn[bi]);if(bn[bi] instanceof a2){bi++}else{bi+=bl}}bk.changes=bp;bo.off("change",a0);b.off(bo.getInputField(),"keydown",R)}if(!bg&&bh.insertModeRepeat>1){v(bo,bh,bh.insertModeRepeat-1,true);bh.lastEditInputState.repeatOverride=bh.insertModeRepeat}delete bh.insertModeRepeat;bh.insertMode=false;bo.setCursor(bo.getCursor().line,bo.getCursor().ch-1);bo.setOption("keyMap","vim");bo.setOption("disableInput",true);bo.toggleOverwrite(false);bm.setText(bk.changes.join(""));b.signal(bo,"vim-mode-change",{mode:"normal"});if(bj.isRecording){ag(bj)}}az("insertModeEscKeysTimeout",200,"number");b.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(bg){var bh=b.commands.newlineAndIndentContinueComment||b.commands.newlineAndIndent;bh(bg)},fallthrough:["default"]};b.keyMap["await-second"]={fallthrough:["vim-insert"]};b.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"]};function E(bo,bi,bj,bg){var bq=r.registerController.getRegister(bg);var bh=bq.keyBuffer;var bm=0;bj.isPlaying=true;bj.replaySearchQueries=bq.searchQueries.slice(0);for(var bk=0;bk<bh.length;bk++){var br=bh[bk];var bl,bp;while(br){bl=(/<\w+-.+?>|<\w+>|./).exec(br);bp=bl[0];br=br.substring(bl.index+bp.length);b.Vim.handleKey(bo,bp,"macro");if(bi.insertMode){var bn=bq.insertModeChanges[bm++].changes;r.macroModeState.lastInsertModeChanges.changes=bn;ak(bo,bn,1);t(bo)}}}bj.isPlaying=false}function F(bj,bg){if(bj.isPlaying){return}var bi=bj.latestRegister;var bh=r.registerController.getRegister(bi);if(bh){bh.pushText(bg)}}function ag(bi){if(bi.isPlaying){return}var bh=bi.latestRegister;var bg=r.registerController.getRegister(bh);if(bg){bg.pushInsertModeChanges(bi.lastInsertModeChanges)}}function J(bj,bi){if(bj.isPlaying){return}var bh=bj.latestRegister;var bg=r.registerController.getRegister(bh);if(bg){bg.pushSearchQuery(bi)}}function a0(bh,bg){var bj=r.macroModeState;var bi=bj.lastInsertModeChanges;if(!bj.isPlaying){while(bg){bi.expectCursorActivityForChange=true;if(bg.origin=="+input"||bg.origin=="paste"||bg.origin===undefined){var bk=bg.text.join("\n");bi.changes.push(bk)}bg=bg.next}}}function U(bn){var bg=bn.state.vim;if(bg.insertMode){var bh=r.macroModeState;if(bh.isPlaying){return}var bi=bh.lastInsertModeChanges;if(bi.expectCursorActivityForChange){bi.expectCursorActivityForChange=false}else{bi.changes=[]}}else{if(bn.doc.history.lastSelOrigin=="*mouse"){bg.lastHPos=bn.doc.getCursor().ch;if(bn.somethingSelected()){bg.visualMode=true}}}if(bg.visualMode){var bl,bk;bl=bk=bn.getCursor("head");var bj=bn.getCursor("anchor");var bm=c(bk.line,bl.ch+(aC(bj,bk)?-1:1));if(aC(bm,bl)){var bo=bl;bl=bm;bm=bo}if(bg.fakeCursor){bg.fakeCursor.clear()}bg.fakeCursor=bn.markText(bl,bm,{className:"cm-animate-fat-cursor"})}}function a2(bg){this.keyName=bg}function R(bk){var bj=r.macroModeState;var bi=bj.lastInsertModeChanges;var bh=b.keyName(bk);function bg(){bi.changes.push(new a2(bh));return true}if(bh.indexOf("Delete")!=-1||bh.indexOf("Backspace")!=-1){b.lookupKey(bh,["vim-insert"],bg)}}function v(bo,bj,bh,bg){var bl=r.macroModeState;bl.isPlaying=true;var bp=!!bj.lastEditActionCommand;var bm=bj.inputState;function bi(){if(bp){aV.processAction(bo,bj,bj.lastEditActionCommand)}else{aV.evalInput(bo,bj)}}function bn(br){if(bl.lastInsertModeChanges.changes.length>0){br=!bj.lastEditActionCommand?1:br;var bq=bl.lastInsertModeChanges;ak(bo,bq.changes,br)}}bj.inputState=bj.lastEditInputState;if(bp&&bj.lastEditActionCommand.interlaceInsertRepeat){for(var bk=0;bk<bh;bk++){bi();bn(1)}}else{if(!bg){bi()}bn(bh)}bj.inputState=bm;if(bj.insertMode&&!bg){t(bo)}bl.isPlaying=false}function ak(bq,bp,bh){function bm(bt){if(typeof bt=="string"){b.commands[bt](bq)}else{bt(bq)}return true}var bn=bq.getCursor();var bg=r.macroModeState.lastInsertModeChanges.inVisualBlock;if(bg){var bk=bq.state.vim;var bi=bk.lastSelection.visualBlock;var bs=c(bn.line+bi.height-1,bn.ch);bq.setCursor(bn);C(bq,bs);bh=bq.listSelections().length;bq.setCursor(bn)}for(var bl=0;bl<bh;bl++){for(var bj=0;bj<bp.length;bj++){var bo=bp[bj];if(bo instanceof a2){b.lookupKey(bo.keyName,["vim-insert"],bm)}else{var br=bq.getCursor();bq.replaceRange(bo,br,br)}}if(bg){bn.line++;bq.setCursor(bn)}}}w();return aD};b.Vim=e()});